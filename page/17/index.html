<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/17/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-YzmCMS/YzmCMS v3.6 csrf" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YzmCMS/YzmCMS%20v3.6%20csrf/" class="article-date">
  <time datetime="2022-07-08T06:26:08.745Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YzmCMS-v3-6-csrf"><a href="#YzmCMS-v3-6-csrf" class="headerlink" title="YzmCMS v3.6 csrf"></a>YzmCMS v3.6 csrf</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>YzmCMS v3.6</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>1、文件位置: /application/admin/controller/sql.class.php第10-42行中：</p>
<pre><code>public function init() &#123;  
    if(isset($_POST[&#39;sqlstr&#39;]))&#123;  
        if(!C(&#39;sql_execute&#39;)) showmsg(&#39;根据系统配置，不允许在线执行SQL命令！&#39;, &#39;stop&#39;);  
        $sqlstr = MAGIC_QUOTES_GPC ? stripslashes($_POST[&#39;sqlstr&#39;]) : $_POST[&#39;sqlstr&#39;];  
        $sqlstr = rtrim(trim($sqlstr), &#39;;&#39;);  
        $sqls = $_POST[&#39;action&#39;]==&#39;many&#39; ? explode(&#39;;&#39;, $sqlstr) : array(0 =&gt; $sqlstr);  

        $admin = D(&#39;admin&#39;);  
        foreach($sqls as $sql)&#123;  
10.             if(stristr($sql, &#39;outfile&#39;))&#123;  
11.                 $str = &#39;&lt;span class=&quot;c-red&quot;&gt;ERROR : 检测到非法字符 “outfile”！&lt;/span&gt;&#39;;  
12.                 break;  
13.             &#125;  
14.             if(stristr($sql, &#39;.php&#39;))&#123;  
15.                 $str = &#39;&lt;span class=&quot;c-red&quot;&gt;ERROR : 检测到非法字符 “.php” ！&lt;/span&gt;&#39;;  
16.                 break;  
17.             &#125;  
18.             if(preg_match(&quot;/^drop(.*)database/i&quot;, $sql))&#123;  
19.                 $str = &#39;&lt;span class=&quot;c-red&quot;&gt;ERROR : 不允许删除数据库！&lt;/span&gt;&#39;;  
20.                 break;  
21.             &#125;  
22.             $result = $admin-&gt;query($sql);   
23.             if($result)&#123;  
24.                 $str = &#39;&lt;span style=&quot;color:green&quot;&gt;OK : 执行成功！&lt;/span&gt;&#39;;  
25.                 if(is_object($result) || is_resource($result))&#123;  
26.                     $arr = $admin-&gt;fetch_all($result);  
27.                 &#125;                     
28.             &#125;else&#123;  
29.                 $str = &#39;&lt;span class=&quot;c-red&quot;&gt;ERROR : 执行失败！&lt;/span&gt;&#39;;  
30.                 break;  
31.             &#125;                 
32.         &#125;  
33.     &#125;
</code></pre>
<p>这段函数中对提交的sql参数进行还原处理，然后进行非法字符检测，检测字符是否存在”oufile”、”.php”,匹配是否有删除数据的操作等。</p>
<p>2、如何绕过这种限制？</p>
<p>首页，outfile被禁止，第一时间想到的就是SQL语句利用日志写入文件，但是写入脚本文件”.php”会被检测到非法字符；然后，尝试MySQL中concat函数来连接字符串，拆分’.php’关键词，如<br>CONCAT(&quot;test.&quot;,&quot;php&quot;);最后构造出可以写入文件，绕过非法字符检测的的SQL语句，从而触发代码执行漏洞，控制服务器。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YzmCMS/YzmCMS%20v3.6%20csrf/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YzmCMS/YzmCMS%20v3.6%20csrf/" data-id="cl5c2qz8q00nqy8v14mb24lgc" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-YXcms/（CVE-2018-11003）YXcms 1.4.7跨站请求伪造漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YXcms/%EF%BC%88CVE-2018-11003%EF%BC%89YXcms%201.4.7%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:08.641Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2018-11003）YXcms-1-4-7-跨站请求伪造漏洞"><a href="#（CVE-2018-11003）YXcms-1-4-7-跨站请求伪造漏洞" class="headerlink" title="（CVE-2018-11003）YXcms 1.4.7 跨站请求伪造漏洞"></a>（CVE-2018-11003）YXcms 1.4.7 跨站请求伪造漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>YXcms<br>1.4.7版本中的protected/apps/admin/controller/adminController.php文件存在跨站请求伪造漏洞。远程攻击者可借助index.php?r=admin/admin/admindel利用该漏洞删除管理员账户。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>YXcms 1.4.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>POC:</p>
<p>管理员点击链接</p>
<p><a target="_blank" rel="noopener" href="http://192.168.232.133/evil.html">http://192.168.232.133/evil.html</a></p>
<p>evil.html</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YXcms/%EF%BC%88CVE-2018-11003%EF%BC%89YXcms%201.4.7%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YXcms/%EF%BC%88CVE-2018-11003%EF%BC%89YXcms%201.4.7%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qz6n00nmy8v1ecj76wif" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-YXcms/YXcmsApp 1.4.3任意用户密码重置漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YXcms/YXcmsApp%201.4.3%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:08.639Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YXcms-1-4-3-任意用户密码重置漏洞"><a href="#YXcms-1-4-3-任意用户密码重置漏洞" class="headerlink" title="YXcms 1.4.3 任意用户密码重置漏洞"></a>YXcms 1.4.3 任意用户密码重置漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>2017-03-26 YXcmsApp 1.4.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>从框架上（基于CanPHP的二次开发）看不出来什么缺陷，那就来看看代码逻辑上有什么披露。来到protected/apps/member/controller/indexController.php中是一些关于会员账号的逻辑，其中的getpassword函数是找回密码的功能，其中分为两步：第一步根据用户名或者邮箱向注册的邮件发送重置密码链接；第二步根据重置密码的链接重置用户密码，然后再将新密码发送到对应邮箱。第二步代码如下：</p>
<p><img src="/resource/YXcmsApp1.4.3%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E/media/rId25.jpg"></p>
<p>这里的ENCODE_KEY是在安装时生成的6位密钥，想通过构造$_GET[&#39;code&#39;]来重置其他用户的密码初步是不现实的。</p>
<p>但之后又看到在regist功能中，第176行调用了自定义的set_cookie函数，如下：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YXcms/YXcmsApp%201.4.3%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YXcms/YXcmsApp%201.4.3%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qz6o00npy8v17hga5wz2" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-YXcms/YXCMS 1.4.7储存型xss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YXcms/YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="article-date">
  <time datetime="2022-07-08T06:26:08.636Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YXcms-1-4-7-储存型xss"><a href="#YXcms-1-4-7-储存型xss" class="headerlink" title="YXcms 1.4.7 储存型xss"></a>YXcms 1.4.7 储存型xss</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>YXcms 1.4.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>前台的文件源码protected/apps/default/controller/columnController.php</p>
<pre><code>public function index()
&#123;
    $ename=in($_GET[&#39;col&#39;]);
    if(empty($ename)) throw new Exception(&#39;栏目名不能为空~&#39;, 404);
    $sortinfo=model(&#39;sort&#39;)-&gt;find(&quot;ename=&#39;&#123;$ename&#125;&#39;&quot;,&#39;id,name,ename,path,url,type,deep,method,tplist,keywords,description,extendid&#39;);
    $path=$sortinfo[&#39;path&#39;].&#39;,&#39;.$sortinfo[&#39;id&#39;];
    $deep=$sortinfo[&#39;deep&#39;]+1;
    $this-&gt;col=$ename;
    switch ($sortinfo[&#39;type&#39;]) &#123;
        case 1://文章
            $this-&gt;newslist($sortinfo,$path,$deep);
            break;
        case 2://图集
            $this-&gt;photolist($sortinfo,$path,$deep);
            break;
        case 3://单页
            $this-&gt;page($sortinfo,$path,$deep);
            break;
        case 4://应用

            break;
        case 5://自定义

            break;
        case 6://表单
            $this-&gt;extend($sortinfo,$path,$deep);
            break;
        default:
            throw new Exception(&#39;未知的栏目类型~&#39;, 404);
            break;
    &#125;
&#125;
</code></pre>
<p>后台的文件源码protected/apps/admin/controller/extendfieldController.php</p>
<pre><code>public function mesedit()
&#123;
    $tableid=intval($_GET[&#39;tabid&#39;]);
    if(!$this-&gt;checkConPower(&#39;extend&#39;,$tableid)) $this-&gt;error(&#39;您没有权限管理此独立表内容~&#39;);
    $id=intval($_GET[&#39;id&#39;]);//信息id
    if(empty($tableid) || empty($id) ) $this-&gt;error(&#39;参数错误~&#39;);
    $tableinfo = model(&#39;extend&#39;)-&gt;select(&quot;id=&#39;&#123;$tableid&#125;&#39; OR pid=&#39;&#123;$tableid&#125;&#39;&quot;,&#39;id,tableinfo,name,type,defvalue&#39;,&#39;pid,norder DESC&#39;);
    if(empty($tableinfo)) $this-&gt;error(&#39;自定义表不存在~&#39;);
    if (!$this-&gt;isPost()) &#123;
       $info=model(&#39;extend&#39;)-&gt;Extfind($tableinfo[0][&#39;tableinfo&#39;],&quot;id=&#39;&#123;$id&#125;&#39;&quot;);
       $this-&gt;info=$info;
       $this-&gt;tableid=$tableid;
       $this-&gt;id=$id;
       $this-&gt;tableinfo=$tableinfo;
       $this-&gt;display();
    &#125;else&#123;
       for($i=1;$i&lt;count($tableinfo);$i++)&#123;
        if(is_array($_POST[$tableinfo[$i][&#39;tableinfo&#39;]]))
          $data[$tableinfo[$i][&#39;tableinfo&#39;]]=implode(&#39;,&#39;,$_POST[$tableinfo[$i][&#39;tableinfo&#39;]]);
        else
          $data[$tableinfo[$i][&#39;tableinfo&#39;]]=html_in($_POST[$tableinfo[$i][&#39;tableinfo&#39;]]);
       &#125;
       if(model(&#39;extend&#39;)-&gt;Extup($tableinfo[0][&#39;tableinfo&#39;],&quot;id=&#39;&#123;$id&#125;&#39;&quot;,$data)) $this-&gt;success(&#39;修改成功~&#39;,url(&#39;extendfield/meslist&#39;,array(&#39;id&#39;=&gt;$tableid)));
       else $this-&gt;error(&#39;信息修改失败~&#39;);
     &#125;
&#125;
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YXcms/YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YXcms/YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" data-id="cl5c2qz6o00noy8v101ivayjz" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-YXcms/YXCMS 1.4.7任意文件删除" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YXcms/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/" class="article-date">
  <time datetime="2022-07-08T06:26:08.634Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YXcms-1-4-7-任意文件删除"><a href="#YXcms-1-4-7-任意文件删除" class="headerlink" title="YXcms 1.4.7 任意文件删除"></a>YXcms 1.4.7 任意文件删除</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>YXcms 1.4.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>漏洞文件：protected/apps/admin/controller/photoController.php,在第355行的delpic()函数，可以看到$picname接收POST过来的值，然后$path等于文件开头定义的静态变量<br>static protected $uploadpath=&#39;&#39;;//图片上传路径<br>没有对传入的值进行任何的过滤，使用函数file_exists()判断一下文件是否存在就给unlink执行删除文件了。</p>
<pre><code>public function delpic()
&#123;
    if(empty($_POST[&#39;picname&#39;])) $this-&gt;error(&#39;参数错误~&#39;);
    $picname=$_POST[&#39;picname&#39;];
    $path=$this-&gt;uploadpath;
    if(file_exists($path.$picname))
      @unlink($path.$picname);
    else&#123;echo &#39;图片不存在~&#39;;return;&#125; 
    if(file_exists($path.&#39;thumb_&#39;.$picname))
       @unlink($path.&#39;thumb_&#39;.$picname);
    else &#123;echo &#39;缩略图不存在~&#39;;return;&#125;
    echo &#39;原图以及缩略图删除成功~&#39;;
&#125;
</code></pre>
<h3 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h3><p>需要先登录后台，然后访问之后会显示缩略图不存在</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YXcms/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YXcms/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/" data-id="cl5c2qz6o00nny8v18qkg2gje" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-YXcms/YXCMS 1.4.7任意文件写入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YXcms/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/" class="article-date">
  <time datetime="2022-07-08T06:26:08.631Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YXcms-1-4-7-任意文件写入"><a href="#YXcms-1-4-7-任意文件写入" class="headerlink" title="YXcms 1.4.7 任意文件写入"></a>YXcms 1.4.7 任意文件写入</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>YXcms 1.4.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>漏洞文件protected/apps/admin/controller/setController.php的140行，$tpfile接收到GET传过来的值，如果为空的话就会报非法操作。传过来的URL是admin/set/tpadd&amp;Mname=default，所以$tpfile就是default。</p>
<p>再来下是检测是否有POST的值，接受到POST过来的filename,用trim去掉两边的空格。接收到POST过来的code，用stripcslashes反转义。</p>
<p>$filepath=$templepath.$filename.&#39;.php&#39;这一句是路径和文件的拼接，然后下面检测路径是否存在。</p>
<p>最后没有过滤任何的危险函数就传给file_put_contents函数，写入网站的目录。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YXcms/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YXcms/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/" data-id="cl5c2qz6n00nly8v1gcoj16jv" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-YXcms/YXCMS 1.4.7SQL注入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YXcms/YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/" class="article-date">
  <time datetime="2022-07-08T06:26:08.628Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YXCMS-1-4-7SQL注入"><a href="#YXCMS-1-4-7SQL注入" class="headerlink" title="YXCMS 1.4.7SQL注入"></a>YXCMS 1.4.7SQL注入</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>1.4.7</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>查看漏洞文件protected/apps/admin/controller/fragmentController.php的第63行</p>
<pre><code>public function del()
&#123;
    if(!$this-&gt;isPost())&#123;
        $id=intval($_GET[&#39;id&#39;]);
        if(empty($id)) $this-&gt;error(&#39;您没有选择~&#39;);
        if(model(&#39;fragment&#39;)-&gt;delete(&quot;id=&#39;$id&#39;&quot;))
        echo 1;
        else echo &#39;删除失败~&#39;;
    &#125;else&#123;
        if(empty($_POST[&#39;delid&#39;])) $this-&gt;error(&#39;您没有选择~&#39;);
        $delid=implode(&#39;,&#39;,$_POST[&#39;delid&#39;]);
        if(model(&#39;fragment&#39;)-&gt;delete(&#39;id in (&#39;.$delid.&#39;)&#39;))
        $this-&gt;success(&#39;删除成功&#39;,url(&#39;fragment/index&#39;));
    &#125;
&#125;
</code></pre>
<p>我们跟if(model(&#39;fragment&#39;)-&gt;delete(&quot;id=&#39;$id&#39;&quot;)),它会先到protected/core.php文件里面的model</p>
<pre><code>function model($model)&#123;
    static $objArray = array();
    $className = $model . &#39;Model&#39;;
    if( !is_object($objArray[$className]) )&#123;
        if( !class_exists($className) ) &#123;
            throw new Exception(config(&#39;_APP_NAME&#39;). &#39;/&#39; . $className . &#39;.php 模型类不存在&#39;);
        &#125;
        $objArray[$className] = new $className();
    &#125;
    return $objArray[$className];
&#125;
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YXcms/YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YXcms/YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/" data-id="cl5c2qz6m00nky8v14eo41etp" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Yunyecms/Yunyecms V2.0.2 后台注入漏洞（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.525Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Yunyecms-V2-0-2-后台注入漏洞（二）"><a href="#Yunyecms-V2-0-2-后台注入漏洞（二）" class="headerlink" title="Yunyecms V2.0.2 后台注入漏洞（二）"></a>Yunyecms V2.0.2 后台注入漏洞（二）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>云业CMS内容管理系统是由云业信息科技开发的一款专门用于中小企业网站建设的PHP开源CMS，可用来快速建设一个品牌官网(PC，手机，微信都能访问)，后台功能强大，安全稳定，操作简单。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>yunyecms 2.0.2</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>漏洞出现在在后台文件de<code>***.php中，</code>de<code>***_add</code>函数对GET和POST参数先进行了是否empty判断，最终将传入的几个参数传给了edit_admin_department。</p>
<p><img src="/resource/YunyecmsV2.0.2%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E(%E4%BA%8C)/media/rId24.png"></p>
<p>跟入edit_admin_department，对参数依次进行了处理，但是发现只有<code>$departmentname,$olddepartmentname</code>进行了usafestr安全过滤，漏网的<code>$id</code>拼接到了sql语句中执行。</p>
<p><img src="/resource/YunyecmsV2.0.2%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E(%E4%BA%8C)/media/rId25.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="cl5c2qz5q00njy8v17yg3d532" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Yunyecms/Yunyecms V2.0.2 后台注入漏洞（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.523Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Yunyecms-V2-0-2-后台注入漏洞（一）"><a href="#Yunyecms-V2-0-2-后台注入漏洞（一）" class="headerlink" title="Yunyecms V2.0.2 后台注入漏洞（一）"></a>Yunyecms V2.0.2 后台注入漏洞（一）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>云业CMS内容管理系统是由云业信息科技开发的一款专门用于中小企业网站建设的PHP开源CMS，可用来快速建设一个品牌官网(PC，手机，微信都能访问)，后台功能强大，安全稳定，操作简单。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>yunyecms 2.0.2</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>废话不多说，又经过一番寻找与”提示”，发现core/admin/deparment.php文件，其中id值是通过post直接获取的，然后被edit_admin_department()调用。</p>
<p><img src="/resource/YunyecmsV2.0.2%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E(%E4%B8%80)/media/rId25.png"></p>
<p>去到edit_admin_department()函数定义处，发现过滤语句。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="cl5c2qz5p00niy8v15lph5eel" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Yunyecms/Yunyecms V2.0.2 前台注入漏洞（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.520Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Yunyecms-V2-0-2-前台注入漏洞（二）"><a href="#Yunyecms-V2-0-2-前台注入漏洞（二）" class="headerlink" title="Yunyecms V2.0.2 前台注入漏洞（二）"></a>Yunyecms V2.0.2 前台注入漏洞（二）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>云业CMS内容管理系统是由云业信息科技开发的一款专门用于中小企业网站建设的PHP开源CMS，可用来快速建设一个品牌官网(PC，手机，微信都能访问)，后台功能强大，安全稳定，操作简单。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>yunyecms 2.0.2</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>问题出现在前台<code>me***.php</code>文件中，自定义表单customform中的userid从cookie中获取，截取一段数据包可以看到cookie的userid如下：</p>
<p><img src="/resource/YunyecmsV2.0.2%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E(%E4%BA%8C)/media/rId24.png"></p>
<p>经过了加密处理，根据解密算法<strong>yunyecms_strdecode</strong>可以在corefun.php找到对应的加解密算法</p>
<p><img src="/resource/YunyecmsV2.0.2%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E(%E4%BA%8C)/media/rId25.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Yunyecms/Yunyecms%20V2.0.2%20%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="cl5c2qz5p00nhy8v1efhl8ju9" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/16/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/18/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>