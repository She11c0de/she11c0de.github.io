<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/31/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-Typesetter CMS/Typesetter CMS任意文件上传" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Typesetter%20CMS/Typesetter%20CMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="article-date">
  <time datetime="2022-07-08T06:26:06.128Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Typesetter-CMS任意文件上传"><a href="#Typesetter-CMS任意文件上传" class="headerlink" title="Typesetter CMS任意文件上传"></a>Typesetter CMS任意文件上传</h1><ul>
<li><p>Steps to reproduce<br>  1- As admin go to Content menu and click on Uploaded files<br>  2- Inside the try to upload a .php file, and<br>  3- try to upload a .php file directly, check that it is not possible.<br>  4- Take the same .php file and place it in a .zip and upload it.<br>  5- Extract through functionality and open the .php file<br>  <strong>Obs</strong>: A strange behavior was that, after extracting the PHP file in functionality, it is seen as HTML.</p>
</li>
<li><p>PoC<br>  ==&gt; Executing Commands</p>
<p>  ![poc_01](/resource/Typesetter%20CMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/media/93630451-7595a580-f9c0-11ea-9166-30d2ede2535a.gif)</p>
</li>
</ul>
<p>![test](/resource/Typesetter%20CMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/media/93628723-6d883680-f9bd-11ea-9d89-610565c43878.gif)</p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Typesetter%20CMS/Typesetter%20CMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Typesetter%20CMS/Typesetter%20CMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" data-id="cl5c2qxce00jqy8v10sxo8oki" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Typecho/Typecho 1.1 反序列化漏洞导致前台getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Typecho/Typecho%201.1%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E5%89%8D%E5%8F%B0getshell/" class="article-date">
  <time datetime="2022-07-08T06:26:06.087Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Typecho-1-1-反序列化漏洞导致前台getshell"><a href="#Typecho-1-1-反序列化漏洞导致前台getshell" class="headerlink" title="Typecho 1.1 反序列化漏洞导致前台getshell"></a>Typecho 1.1 反序列化漏洞导致前台getshell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Typecho 1.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>复现环境：PHP5.6+Apache+Windows</p>
<p><img src="/resource/Typecho1.1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E5%89%8D%E5%8F%B0getshell/media/rId25.jpg"></p>
<p><code>Typecho_Cookie::get</code>目的是获取Cookie，可从Cookie或POST中获取</p>
<p><img src="/resource/Typecho1.1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E5%89%8D%E5%8F%B0getshell/media/rId26.jpg"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Typecho/Typecho%201.1%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E5%89%8D%E5%8F%B0getshell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Typecho/Typecho%201.1%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AF%BC%E8%87%B4%E5%89%8D%E5%8F%B0getshell/" data-id="cl5c2qxca00jly8v1fazt71rm" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat对URL特殊字符的处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%E5%AF%B9URL%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2022-07-08T06:26:05.971Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat对URL特殊字符的处理"><a href="#Tomcat对URL特殊字符的处理" class="headerlink" title="Tomcat对URL特殊字符的处理"></a>Tomcat对URL特殊字符的处理</h3><p>这里我们先来调试分析下Tomcat是如何对请求URL中不同的特殊字符作不同的处理的。</p>
<p>经过调试分析，得知Tomcat是在CoyoteAdapter.service()函数上对请求URL进行解析处理的，直接在这里打上断点，此时的函数调用栈如下：</p>
<pre><code>service:452, CoyoteAdapter (org.apache.catalina.connector)
process:1195, AbstractHttp11Processor (org.apache.coyote.http11)
process:654, AbstractProtocol$AbstractConnectionHandler (org.apache.coyote)
run:317, JIoEndpoint$SocketProcessor (org.apache.tomcat.util.net)
runWorker:1142, ThreadPoolExecutor (java.util.concurrent)
run:617, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:745, Thread (java.lang)
</code></pre>
<p>在CoyoteAdapter.service()函数中，会调用postParseRequest()函数来解析URL请求内容：</p>
<p><img src="/resource/Tomcat%E5%AF%B9URL%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86/media/rId21.png"></p>
<p>跟进postParseRequest()函数中，其中先后调用parsePathParameters()和normalize()函数对请求内容进行解析处理：</p>
<p><img src="/resource/Tomcat%E5%AF%B9URL%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86/media/rId22.png"></p>
<p>这里我们先跟进parsePathParameters()函数，先是寻找URL中是否存在<code>;</code>号，找到的话才会进入下面的if代码逻辑：</p>
<p><img src="/resource/Tomcat%E5%AF%B9URL%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86/media/rId23.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%E5%AF%B9URL%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%E5%AF%B9URL%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84%E5%A4%84%E7%90%86/" data-id="cl5c2qxiq00kcy8v1gc8f8rde" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat URL 解析差异性攻击利用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20URL%20%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E6%94%BB%E5%87%BB%E5%88%A9%E7%94%A8/" class="article-date">
  <time datetime="2022-07-08T06:26:05.969Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Tomcat-URL-解析差异性攻击利用"><a href="#Tomcat-URL-解析差异性攻击利用" class="headerlink" title="Tomcat URL 解析差异性攻击利用"></a>Tomcat URL 解析差异性攻击利用</h2><p>看个访问限制绕过的场景。</p>
<p>假设Tomcat上启动的Web目录下存在一个info目录，其中有一个secret.jsp文件，其中包含敏感信息等：</p>
<pre><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Secret&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
username: mi1k7ea&lt;br&gt;
password: 123456&lt;br&gt;
address: china&lt;br&gt;
phone: 13666666666&lt;br&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>新建一个filter包，其中新建一个testFilter类，实现Filter接口类：</p>
<pre><code>package filter;

import javax.servlet.*;
import javax.servlet.http.*;
import java.io.IOException;

public class testFilter implements Filter &#123;
    @Override
    public void init(FilterConfig filterConfig) throws ServletException &#123;

    &#125;

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;
        HttpServletRequest httpServletRequest = (HttpServletRequest)servletRequest;
        HttpServletResponse httpServletResponse = (HttpServletResponse)servletResponse;

        String url = httpServletRequest.getRequestURI();

        if (url.startsWith(&quot;/urltest/info&quot;)) &#123;
            httpServletResponse.getWriter().write(&quot;No Permission.&quot;);
            return;
        &#125;

        filterChain.doFilter(servletRequest, servletResponse);
    &#125;

    @Override
    public void destroy() &#123;

    &#125;
&#125;
</code></pre>
<p>这个Filter作用是：只要访问/urltest/info目录下的资源，都需要进行权限判断，否则直接放行。可以看到，这里调用getRequestURI()函数来获取请求中的URL目录路径，然后调用startsWith()函数判断是否是访问的敏感目录，若是则返回无权限的响应。当然这里写得非常简单，只做演示用。</p>
<p>编辑web.xml，添加testFilter设置：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;
         version=&quot;4.0&quot;&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;testFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;filter.testFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;testFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;
</code></pre>
<p>运行之后，访问<code>http://localhost:8080/urltest/info/secret.jsp</code>，会显示无权限：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20URL%20%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E6%94%BB%E5%87%BB%E5%88%A9%E7%94%A8/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20URL%20%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E6%94%BB%E5%87%BB%E5%88%A9%E7%94%A8/" data-id="cl5c2qxio00k6y8v1at270ts9" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat getServletPath()的处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getServletPath()%E7%9A%84%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2022-07-08T06:26:05.967Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat-getServletPath-的处理"><a href="#Tomcat-getServletPath-的处理" class="headerlink" title="Tomcat getServletPath()的处理"></a>Tomcat getServletPath()的处理</h3><p>在getServletPath()函数中是调用了Request.getServletPath()函数的：</p>
<p><img src="/resource/TomcatgetServletPath()%E7%9A%84%E5%A4%84%E7%90%86/media/rId21.png"></p>
<p>跟进去，看到是直接返回前面Tomcat已经处理过后的提取处理的Servlet路径，注意这里是获取MappingData类对象中的wrapperPath属性值：</p>
<p><img src="/resource/TomcatgetServletPath()%E7%9A%84%E5%A4%84%E7%90%86/media/rId22.png"></p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getServletPath()%E7%9A%84%E5%A4%84%E7%90%86/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getServletPath()%E7%9A%84%E5%A4%84%E7%90%86/" data-id="cl5c2qxip00kay8v1gbzg7bv0" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat getRequestURL()的处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getRequestURL()%E7%9A%84%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2022-07-08T06:26:05.965Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat-getRequestURL-的处理"><a href="#Tomcat-getRequestURL-的处理" class="headerlink" title="Tomcat getRequestURL()的处理"></a>Tomcat getRequestURL()的处理</h3><p>在getRequestURL()函数中是调用了Request.getRequestURL()函数的：</p>
<p><img src="/resource/TomcatgetRequestURL()%E7%9A%84%E5%A4%84%E7%90%86/media/rId21.png"></p>
<p>跟进该函数，在提取了协议类型、host和port之后，调用了getRequestURI()函数获取URL请求的路径，然后直接拼接进URL直接返回而不做包括URL解码的任何处理：</p>
<p><img src="/resource/TomcatgetRequestURL()%E7%9A%84%E5%A4%84%E7%90%86/media/rId22.png"></p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getRequestURL()%E7%9A%84%E5%A4%84%E7%90%86/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getRequestURL()%E7%9A%84%E5%A4%84%E7%90%86/" data-id="cl5c2qxiq00kby8v18egy1fq5" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat getRequestURI()的处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getRequestURI()%E7%9A%84%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2022-07-08T06:26:05.962Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat-getRequestURI-的处理"><a href="#Tomcat-getRequestURI-的处理" class="headerlink" title="Tomcat getRequestURI()的处理"></a>Tomcat getRequestURI()的处理</h3><p>我们直接在index.jsp中调用getRequestURI()函数的地方打上断点调试即可。</p>
<p>这里是直接调用Request.requestURI()函数然后直接返回其字符串值：</p>
<p><img src="/resource/TomcatgetRequestURI()%E7%9A%84%E5%A4%84%E7%90%86/media/rId21.png"></p>
<p>跟进Request.requestURI()函数，这里是直接返回请求的URL内容，没有做任何处理以及URL解码：</p>
<p><img src="/resource/TomcatgetRequestURI()%E7%9A%84%E5%A4%84%E7%90%86/media/rId22.png">Tomcat</p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getRequestURI()%E7%9A%84%E5%A4%84%E7%90%86/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getRequestURI()%E7%9A%84%E5%A4%84%E7%90%86/" data-id="cl5c2qxip00k8y8v1eehjeblc" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat getPathInfo()的处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getPathInfo()%E7%9A%84%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2022-07-08T06:26:05.957Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat-getPathInfo-的处理"><a href="#Tomcat-getPathInfo-的处理" class="headerlink" title="Tomcat getPathInfo()的处理"></a>Tomcat getPathInfo()的处理</h3><p>和getServletPath()函数的处理是一样的，同样是返回前面经过Tomcat解析处理后的MappingData类对象中其中一个属性值，这里是获取的pathInfo属性值并直接返回：</p>
<p><img src="/resource/TomcatgetPathInfo()%E7%9A%84%E5%A4%84%E7%90%86/media/rId21.png"></p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getPathInfo()%E7%9A%84%E5%A4%84%E7%90%86/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getPathInfo()%E7%9A%84%E5%A4%84%E7%90%86/" data-id="cl5c2qxip00k9y8v12sqxewvd" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/调试分析/Tomcat getContextPath()的处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getContextPath()%E7%9A%84%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2022-07-08T06:26:05.954Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat-getContextPath-的处理"><a href="#Tomcat-getContextPath-的处理" class="headerlink" title="Tomcat getContextPath()的处理"></a>Tomcat getContextPath()的处理</h3><p>在getContextPath()函数中，调用了Request.getContextPath()函数：</p>
<p><img src="/resource/TomcatgetContextPath()%E7%9A%84%E5%A4%84%E7%90%86/media/rId21.png"></p>
<p>跟进该函数，先是调用getServletContext().getContextPath()来获取当前Servlet上下文路径以及调用getRequestURI()函数获取当前请求的目录路径：</p>
<p><img src="/resource/TomcatgetContextPath()%E7%9A%84%E5%A4%84%E7%90%86/media/rId22.png"></p>
<p>往下的这段循环是处理uri变量值中如果存在多个连续的<code>/</code>则删除掉：</p>
<p><img src="/resource/TomcatgetContextPath()%E7%9A%84%E5%A4%84%E7%90%86/media/rId23.png"></p>
<p>再往下，获取下一个<code>/</code>符号的位置，然后根据该位置索引对uri变量值进行工程名的切分提取：</p>
<p><img src="/resource/TomcatgetContextPath()%E7%9A%84%E5%A4%84%E7%90%86/media/rId24.png"></p>
<p>接着，就是对刚刚切分得到的candidate变量进行和Tomcat一样的特殊字符处理过程，先调用removePathParameters()处理<code>;</code>和<code>.</code>，然后进行URL解码，再调用normalize()函数进行标准化处理，处理过后比较处理完的candidate变量值和之前获取的规范上下文路径是否一致，不一致的话就循环继续前面的操作直至一致为止：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getContextPath()%E7%9A%84%E5%A4%84%E7%90%86/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90/Tomcat%20getContextPath()%E7%9A%84%E5%A4%84%E7%90%86/" data-id="cl5c2qxio00k7y8v14az936td" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Tomcat URL解析差异性导致的安全问题/URL差异性/Tomcat 特殊字符的URL解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/URL%E5%B7%AE%E5%BC%82%E6%80%A7/Tomcat%20%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84URL%E8%A7%A3%E6%9E%90/" class="article-date">
  <time datetime="2022-07-08T06:26:05.921Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Tomcat-特殊字符的URL解析"><a href="#Tomcat-特殊字符的URL解析" class="headerlink" title="Tomcat 特殊字符的URL解析"></a>Tomcat 特殊字符的URL解析</h3><p>新建一个Java Web项目，index.jsp如下：</p>
<pre><code>&lt;%
out.println(&quot;getRequestURL(): &quot; + request.getRequestURL() + &quot;&lt;br&gt;&quot;);
out.println(&quot;getRequestURI(): &quot; + request.getRequestURI() + &quot;&lt;br&gt;&quot;);
out.println(&quot;getContextPath(): &quot; + request.getContextPath() + &quot;&lt;br&gt;&quot;);
out.println(&quot;getServletPath(): &quot; + request.getServletPath() + &quot;&lt;br&gt;&quot;);
out.println(&quot;getPathInfo(): &quot; + request.getPathInfo() + &quot;&lt;br&gt;&quot;);
%&gt;
</code></pre>
<h4 id="正常访问"><a href="#正常访问" class="headerlink" title="正常访问"></a>正常访问</h4><p>Tomcat运行之后，正常访问<code>http://localhost:8080/urltest/index.jsp</code>，页面输出如下：</p>
<p><img src="/resource/Tomcat%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84URL%E8%A7%A3%E6%9E%90/media/rId22.png"></p>
<h4 id="插入-访问"><a href="#插入-访问" class="headerlink" title="插入 ./ 访问"></a>插入 ./ 访问</h4><p>尝试插入多个<code>./</code>访问即<code>http://localhost:8080/urltest/./././index.jsp</code>，页面输出如下：</p>
<p><img src="/resource/Tomcat%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84URL%E8%A7%A3%E6%9E%90/media/rId24.png"></p>
<p>可以看到，插入多个<code>./</code>也能正常访问。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/URL%E5%B7%AE%E5%BC%82%E6%80%A7/Tomcat%20%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84URL%E8%A7%A3%E6%9E%90/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Tomcat%20URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/URL%E5%B7%AE%E5%BC%82%E6%80%A7/Tomcat%20%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E7%9A%84URL%E8%A7%A3%E6%9E%90/" data-id="cl5c2qxio00k5y8v1hyqo6h2v" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/30/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="page-number" href="/page/30/">30</a><span class="page-number current">31</span><a class="page-number" href="/page/32/">32</a><a class="page-number" href="/page/33/">33</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/32/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>